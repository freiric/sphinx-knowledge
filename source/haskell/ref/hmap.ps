%!PS-Adobe-2.0
%%Creator: dvips(k) 5.86 Copyright 1999 Radical Eye Software
%%Title: paper.dvi
%%Pages: 12
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Helvetica-Bold Helvetica Times-Bold Times-Roman
%%+ Times-Italic Symbol Courier Courier-Bold
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips paper.dvi -o hmap.ps -t letter
%DVIPSParameters: dpi=1200, compressed
%DVIPSSource:  TeX output 2002.12.06:1640
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/dir 0 def/dyy{/dir 0 def}B/dyt{/dir 1 def}B/dty{/dir 2 def}B/dtt{/dir 3
def}B/p{dir 2 eq{-90 rotate show 90 rotate}{dir 3 eq{-90 rotate show 90
rotate}{show}ifelse}ifelse}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0
N/Ry 0 N/V{}B/RV/v{/Ry X/Rx X V}B statusdict begin/product where{pop
false[(Display)(NeXT)(LaserWriter 16/600)]{A length product length le{A
length product exch 0 exch getinterval eq{pop true exit}if}{pop}ifelse}
forall}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{
BDot}imagemask grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat
{BDot}imagemask grestore}}ifelse B/QV{gsave newpath transform round exch
round exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0
rlineto fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B
/M{S p delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}
B/g{0 M}B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p
-3 w}B/n{p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{
0 S rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "1 July 1998",
%   filename = "8r.enc",
%   email = "tex-fonts@@tug.org",
%   docstring = "Encoding for TrueType or Type 1 fonts
%                to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both 
% ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type/integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics/Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{
dup sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1
roll mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def
dup[exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}
if}forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}
def end

%%EndProcSet
TeXDict begin 40258431 52099146 1000 1200 1200 (paper.dvi)
@start /Fa 134[74 2[74 83 46 65 65 1[83 83 83 120 46
74 1[46 83 83 46 74 83 74 1[83 12[92 3[101 8[120 25[55
45[{TeXBase1Encoding ReEncodeFont}24 166.044 /Times-Italic
rf /Fb 134[110 4[110 110 2[110 110 2[110 4[110 110 110
110 110 110 110 12[110 4[110 79[{TeXBase1Encoding ReEncodeFont}15
182.648 /Courier-Bold rf
%DVIPSBitmapFont: Fc cmr10 9 3
/Fc 3 62 df<ED01E015031507ED0F80151FED3F00157E5D4A5A4A5A4A5A140F4A5A5D14
3F4AC7FC14FEA2495A13035C13075C130F5C131F5C133F5C137FA249C8FCA25A5BA21203
5BA21207A25B120FA3485AA5485AA5127FA25BA612FFB3A6127FA67FA2123FA56C7EA56C
7EA312077FA21203A27F1201A27F7EA26D7EA2133F80131F80130F801307801303801301
6D7EA2147F6E7E141F816E7E14076E7E6E7E6E7E157E81ED1F80150FED07E01503150123
9672EF3A>40 D<127012F8127C7E123F6C7E6C7E6C7E6C7E6C7E6C7E7F137F7F806D7E6D
7EA26D7E801303801301801300808081143F81A26E7EA281140FA2811407A281A2140381
A36E7EA56E1380A516C0A2157FA616E0B3A616C0A615FFA21680A54A1300A54A5AA35D14
07A25DA2140F5DA2141F5DA24A5AA25D147F92C7FC5C5C13015C13035C13075C495AA249
5A495A91C8FC5B13FE5B485A485A485A485A485A48C9FC123E5A5A1270239678EF3A>I<
007FBE12C0BF12E0A4003F1DC0D2FCB3A6003FBE12C0BF12E0A46C1DC0632478B674>61
D E
%EndDVIPSBitmapFont
/Fd 143[120 2[120 5[120 5[120 97[{TeXBase1Encoding ReEncodeFont}4
199.253 /Courier-Bold rf /Fe 134[91 91 1[91 102 61 71
81 102 102 91 102 152 51 102 1[51 102 91 61 81 102 81
102 91 9[183 1[132 122 102 132 2[142 5[71 1[142 2[132
132 1[132 1[91 5[91 91 91 91 91 91 91 91 91 2[46 61 42[102
2[{TeXBase1Encoding ReEncodeFont}47 182.648 /Times-Bold
rf /Ff 130[76 76 76 76 76 76 76 76 76 76 76 76 76 76
76 76 76 76 76 76 76 76 76 76 76 76 76 76 76 76 76 1[76
76 76 76 2[76 76 76 76 76 76 76 76 76 76 76 76 1[76 76
76 76 76 76 76 76 76 76 76 1[76 76 76 76 76 76 76 76
4[76 76 76 76 76 76 76 76 76 76 76 76 2[76 1[76 34[{
.85 ExtendFont TeXBase1Encoding ReEncodeFont}80 149.44
/Courier rf
%DVIPSBitmapFont: Fh cmsy10 9 2
/Fh 2 18 df<EDFFC0020F13FC023F13FF91B612C0010315F0010F15FC49814981498290
B87E488348834883A24883A24883A24883A2481880A4BA12C0AA6C1880A46C1800A26C5F
A26C5FA26C5FA26C5F6C5F6C5F6D5E6D93C7FC6D5D6D5D010315F0010015C0023F91C8FC
020F13FC020013C03A3A78C14B>15 D<007FBE12C0BF12E0A37E6C1D80D2FCB3A6007FBE
12C0BF12E0A46C1DC0D2FCB3A6003FBE1280481DE0BFFCA36C1DC0634278C574>17
D E
%EndDVIPSBitmapFont
/Fi 105[75 28[66 66 100 66 75 42 58 58 75 75 75 75 108
42 66 42 42 75 75 42 66 75 66 75 75 9[124 1[108 83 75
91 1[91 108 100 124 83 1[66 50 108 108 91 91 108 100
91 91 6[50 75 75 75 75 75 75 75 75 75 75 1[37 50 37 2[50
50 50 36[75 2[{TeXBase1Encoding ReEncodeFont}64 149.44
/Times-Italic rf /Fj 171[71 7[71 2[39 4[84 16[58 2[58
3[29 4[39 39[{.167 SlantFont TeXBase1Encoding ReEncodeFont}8
116.231 /Times-Roman rf /Fk 134[58 1[84 58 58 32 45 39
58 58 58 58 90 32 58 1[32 58 58 39 52 58 52 58 52 11[84
71 65 2[65 84 84 103 71 1[45 6[78 1[84 7[58 58 58 58
58 58 58 58 58 58 32 29 39 29 7[58 33[65 2[{
TeXBase1Encoding ReEncodeFont}50 116.231 /Times-Roman
rf /Fl 134[75 1[108 1[83 50 58 66 2[75 83 124 42 2[42
83 75 50 66 83 66 83 75 13[83 2[91 2[141 100 6[100 10[50
12[50 45[{TeXBase1Encoding ReEncodeFont}26 149.44 /Times-Bold
rf /Fm 75[50 11[50 16[149 75 1[66 66 24[66 75 75 108
75 75 42 58 50 75 75 75 75 116 42 75 42 42 75 75 50 66
75 66 75 66 3[50 1[50 91 108 108 141 108 108 91 83 100
1[83 108 108 133 91 108 58 50 108 108 83 91 108 100 100
108 1[66 3[42 42 75 75 75 75 75 75 75 75 75 75 42 37
50 37 2[50 50 50 1[124 3[50 29[83 83 2[{TeXBase1Encoding ReEncodeFont}
83 149.44 /Times-Roman rf /Fn 134[100 1[144 100 111 66
78 88 1[111 100 111 166 55 111 66 55 111 100 66 88 111
88 111 100 12[133 111 144 155 1[155 1[188 1[155 1[78
1[155 2[144 144 1[144 7[100 100 100 100 100 100 100 100
100 100 2[66 41[111 111 2[{TeXBase1Encoding ReEncodeFont}48
199.253 /Times-Bold rf /Fo 137[75 1[42 75 50 2[83 83
124 2[33 33 83 83 42 83 83 75 83 83 10[100 108 2[108
4[124 9[108 1[100 20[42 44[{TeXBase1Encoding ReEncodeFont}24
149.439 /Helvetica rf /Fp 87[60 46[90 4[50 90 3[100 100
149 40 2[40 2[50 100 3[100 13[120 129 1[120 3[100 1[90
74[{TeXBase1Encoding ReEncodeFont}17 179.326 /Helvetica
rf /Fq 138[164 90 150 105 1[164 164 164 239 75 2[75 1[164
90 150 1[150 1[150 7[179 5[179 2[179 8[209 2[194 1[194
194 6[90 58[{TeXBase1Encoding ReEncodeFont}23 268.989
/Helvetica-Bold rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 1200dpi
TeXDict begin
%%BeginPaperSize: Letter
letter
%%EndPaperSize

%%EndSetup
%%Page: 1 1
1 0 bop 2419 494 a Fq(Scrap)74 b(Y)-27 b(our)76 b(Boilerplate:)561
793 y(A)f(Practical)d(Design)j(P)-8 b(attern)73 b(f)-5
b(or)74 b(Generic)g(Pr)-5 b(ogramming)1496 1403 y Fp(Ralf)50
b(L)1985 1400 y(\250)1965 1403 y(ammel)1037 1602 y Fo(Vr)r(ije)41
b(Univ)l(ersiteit,)g(Amsterdam)4985 1403 y Fp(Simon)49
b(P)-9 b(e)l(yton)48 b(Jones)4749 1602 y Fo(Microsoft)41
b(Research,)f(Cambr)r(idge)-300 2707 y Fn(Abstract)-300
2876 y Fm(W)-12 b(e)33 b(describe)g(a)f(design)g(pattern)g(for)g
(writing)e(programs)i(that)g(tra)m(v)n(erse)g(data)-300
3042 y(structures)41 b(b)m(uilt)f(from)i(rich)f(mutually-recursi)l(v)n
(e)f(data)i(types.)60 b(Such)42 b(pro-)-300 3208 y(grams)63
b(often)f(ha)m(v)n(e)h(a)g(great)g(deal)g(of)f(\223boilerplate\224)g
(code)h(that)f(simply)-300 3374 y(w)o(alks)39 b(the)g(structure,)h
(hiding)e(a)i(small)g(amount)f(of)g(\223real\224)i(code)e(that)g(con-)
-300 3540 y(stitutes)d(the)h(reason)g(for)g(the)g(tra)m(v)n(ersal.)-300
3707 y(Our)31 b(technique)h(allo)l(ws)f(most)h(of)g(this)f(boilerplate)
f(to)h(be)h(written)f(once)h(and)-300 3873 y(for)58 b(all,)63
b(or)58 b(e)l(v)n(en)g(generated)g(mechanically)-10 b(,)64
b(lea)m(ving)57 b(the)h(programmer)-300 4039 y(free)50
b(to)g(concentrate)g(on)g(the)f(important)g(part)g(of)h(the)g
(algorithm.)83 b(These)-300 4205 y(generic)57 b(programs)g(are)h(much)f
(more)g(adapti)l(v)n(e)g(when)g(f)o(aced)g(with)f(data)-300
4371 y(structure)40 b(e)l(v)m(olution)g(because)i(the)n(y)f(contain)f
(man)n(y)h(fe)l(wer)h(lines)f(of)g(type-)-300 4537 y(speci\002c)d
(code.)-300 4705 y(Our)48 b(approach)h(is)f(simple)g(to)g(understand,)j
(reasonably)d(ef)l(\002cient,)k(and)d(it)-300 4871 y(handles)28
b(all)g(the)h(data)f(types)g(found)g(in)g(con)-6 b(v)n(entional)26
b(functional)h(program-)-300 5037 y(ming)32 b(languages.)45
b(It)32 b(mak)o(es)i(essential)e(use)h(of)g(rank-2)f(polymorphism,)g
(an)-300 5203 y(e)n(xtension)k(found)h(in)g(some)h(implementations)e
(of)h(Hask)o(ell.)47 b(Further)36 b(it)h(re-)-300 5369
y(lies)g(on)g(a)g(simple)g(type-safe)g(cast)h(operator)-8
b(.)-300 5773 y Fn(Categories)50 b(and)f(Subject)i(Descriptors)-300
6008 y Fm(D.3.1)k([)p Fl(Pr)m(ogramming)g(Languages)p
Fm(]:)79 b(F)n(ormal)55 b(De\002nitions)d(and)j(The-)-300
6174 y(ory;)36 b(D.2.13)h([)p Fl(Softwar)m(e)g(Engineering)p
Fm(]:)45 b(Reusable)38 b(Softw)o(are)-300 6578 y Fn(General)51
b(T)-18 b(erms)-300 6812 y Fm(Design,)37 b(Languages)-300
7217 y Fn(K)-5 b(eyw)n(ords)-300 7451 y Fm(Generic)37
b(programming,)g(tra)m(v)n(ersal,)g(rank-2)f(types,)h(type)g(cast)-300
7856 y Fn(1)199 b(Intr)l(oduction)-300 8090 y Fm(Suppose)51
b(you)f(ha)m(v)n(e)h(to)g(write)f(a)i(function)d(that)h(tra)m(v)n
(erses)h(a)h(rich,)i(recur)m(-)-300 8256 y(si)l(v)n(e)d(data)h
(structure)f(representing)f(a)i(compan)n(y')-8 b(s)51
b(or)m(g)o(anisational)f(struc-)-300 8422 y(ture,)59
b(and)c(increases)h(the)e(salary)h(of)g(e)l(v)n(ery)f(person)h(in)f
(the)h(structure)f(by)-300 8588 y(10\045.)48 b(The)38
b(interesting)d(bit)i(of)g(this)g(algorithm)f(is)h(performing)f(the)h
(salary-)-300 8754 y(increase)k(\227)g(b)m(ut)e(the)h(code)h(for)e(the)
h(function)f(is)h(probably)e(dominated)i(by)-300 8920
y(\223boilerplate\224)48 b(code)g(that)g(recurses)i(o)n(v)n(er)d(the)i
(data)g(structure)e(to)h(\002nd)g(the)-297 10007 y Fk(Permission)39
b(to)f(mak)o(e)g(digital)h(or)f(hard)g(copies)g(of)g(all)h(or)f(part)g
(of)g(this)h(w)o(ork)f(for)f(personal)h(or)-297 10140
y(classroom)33 b(use)f(is)g(granted)g(without)i(fee)d(pro)n(vided)h
(that)h(copies)f(are)f(not)i(made)f(or)g(distrib)n(uted)-297
10273 y(for)26 b(pro\002t)h(or)f(commercial)g(adv)m(antage)g(and)h
(that)g(copies)f(bear)g(this)i(notice)e(and)h(the)f(full)h(citation)
-297 10406 y(on)k(the)g(\002rst)g(page.)42 b(T)-9 b(o)31
b(cop)o(y)f(otherwise,)i(to)f(republish,)i(to)e(post)h(on)f(serv)n(ers)
g(or)f(to)i(redistrib)n(ute)-297 10538 y(to)d(lists,)i(requires)d
(prior)h(speci\002c)g(permission)h(and/or)f(a)f(fee.)-297
10671 y Fj(TLDI'03,)j Fk(January)d(18,)i(2003,)f(Ne)m(w)g(Orleans,)f
(Louisiana,)i(USA.)-297 10804 y(Cop)o(yright)f(2003)h(A)-5
b(CM)29 b(1-58113-649-8/03/0001)i(...$5.00)4098 2707
y Fm(speci\002ed)40 b(department)e(as)i(spelled)f(out)g(in)f(Section)h
(2.)53 b(This)39 b(is)g(not)f(an)i(un-)4098 2873 y(usual)e(situation.)
47 b(On)38 b(the)g(contrary)-10 b(,)38 b(performing)f(queries)h(or)g
(transforma-)4098 3039 y(tions)45 b(o)n(v)n(er)h(rich)g(data)g
(structures,)j(no)l(w)o(adays)d(often)f(arising)h(from)g(XML)4098
3205 y(schemata,)39 b(is)e(becoming)g(increasingly)e(important.)4098
3405 y(Boilerplate)f(code)j(is)e(tiresome)h(to)g(write,)g(and)g(easy)g
(to)g(get)f(wrong.)46 b(More-)4098 3571 y(o)n(v)n(er)-6
b(,)42 b(it)f(is)g(vulnerable)g(to)g(change.)59 b(If)41
b(the)h(schema)g(describing)f(the)g(com-)4098 3737 y(pan)n(y')-8
b(s)43 b(or)m(g)o(anisation)g(changes,)j(then)e(so)f(does)i(e)l(v)n
(ery)f(algorithm)e(that)h(re-)4098 3903 y(curses)g(o)n(v)n(er)e(that)g
(structure.)60 b(In)41 b(small)h(programs)g(which)f(w)o(alk)g(o)n(v)n
(er)g(one)4098 4069 y(or)48 b(tw)o(o)f(data)h(types,)i(each)f(with)e
(half)h(a)g(dozen)g(constructors,)i(this)d(is)h(not)4098
4235 y(much)54 b(of)f(a)h(problem.)96 b(In)53 b(lar)m(ge)h(programs,)k
(with)52 b(dozens)i(of)g(mutually)4098 4401 y(recursi)l(v)n(e)36
b(data)h(types,)g(some)g(with)e(dozens)i(of)f(constructors,)g(the)g
(mainte-)4098 4567 y(nance)i(b)m(urden)e(can)i(become)g(hea)m(vy)-10
b(.)4098 4799 y Fi(Generic)31 b(pr)-7 b(o)o(gr)n(amming)28
b Fm(techniques)i(aim)h(to)f(eliminate)g(boilerplate)f(code.)4098
4965 y(There)57 b(is)f(a)h(lar)m(ge)g(literature,)j(as)d(we)f(discuss)h
(in)e(Section)h(9,)61 b(b)m(ut)56 b(much)4098 5131 y(of)45
b(it)g(is)h(rather)f(theoretical,)i(requires)e(signi\002cant)g
(language)g(e)n(xtensions,)4098 5297 y(or)54 b(addresses)h(only)d
(\223purely-generic\224)i(algorithms.)95 b(In)54 b(this)f(paper)-6
b(,)59 b(we)4098 5463 y(present)g(a)g(simple)f(b)m(ut)g(po)l(werful)g
(design)g(pattern)g(for)g(writing)f(generic)4098 5630
y(algorithms)42 b(in)h(the)g(strongly-typed)d(lazy)k(functional)e
(language)h(Hask)o(ell.)4098 5796 y(Our)37 b(technique)f(has)i(the)f
(follo)l(wing)d(properties:)4272 5991 y Fh(\017)83 b
Fm(It)42 b(mak)o(es)h(the)f(application)f(program)g(adapti)l(v)n(e)h
(in)g(the)g(f)o(ace)h(of)f(data)4430 6157 y(type)51 b(\(or)g(schema\))i
(e)l(v)m(olution.)87 b(As)52 b(the)f(data)g(types)h(change,)j(only)4430
6323 y(tw)o(o)e(functions)g(ha)m(v)n(e)h(to)f(be)i(modi\002ed,)j(and)c
(those)g(functions)f(can)4430 6489 y(easily)37 b(be)h(generated)f
(because)h(the)n(y)f(are)g(not)g(application-speci\002c.)4272
6705 y Fh(\017)83 b Fm(It)61 b(is)f(simple)h Fi(and)k
Fm(general.)117 b(It)61 b(copes)g(with)f(arbitrary)g(data-type)4430
6871 y(structure)73 b(without)g(fuss,)83 b(including)73
b(parameterised,)84 b(mutually-)4430 7037 y(recursi)l(v)n(e,)50
b(and)d(nested)g(types.)75 b(It)47 b(also)f(subsumes)i(other)e(styles)h
(of)4430 7203 y(generic)37 b(programming)f(such)h(as)h(term)g(re)l
(writing)d(strate)n(gies.)4272 7419 y Fh(\017)83 b Fm(It)37
b(requires)h(tw)o(o)e(e)n(xtensions)h(to)g(the)h(Hask)o(ell)f(type)g
(system,)i(namely)4430 7585 y(\(a\))64 b(rank-2)g(types)f(and)h(\(b\))g
(a)h(form)e(of)h(type-coercion)f(operator)-8 b(.)4430
7751 y(Ho)l(we)l(v)n(er)35 b(these)g(e)n(xtensions)f(are)h(relati)l(v)n
(ely)f(modest,)i(and)e(are)i(inde-)4430 7917 y(pendently)28
b(useful;)i(the)n(y)f(ha)m(v)n(e)g(both)f(been)h(a)m(v)l(ailable)g(in)g
(tw)o(o)e(popular)4430 8083 y(implementations)36 b(of)h(Hask)o(ell,)f
(GHC)h(and)g(Hugs,)h(for)e(some)i(time.)4098 8278 y(Our)54
b(contrib)m(ution)c(is)k(one)g(of)g(synthesis:)79 b(we)54
b(put)g(together)f(some)h(rela-)4098 8444 y(ti)l(v)n(ely)40
b(well-understood)f(ideas)j(\(type-safe)f(cast,)j(one-layer)d(maps\))h
(in)f(an)4098 8610 y(inno)n(v)l(ati)l(v)n(e)48 b(w)o(ay)-10
b(,)54 b(to)c(solv)n(e)g(a)g(practical)g(problem)g(of)g(increasing)f
(impor)m(-)4098 8776 y(tance.)70 b(The)45 b(paper)g(should)e(be)i(of)f
(direct)g(interest)g(to)g(programmers,)j(and)4098 8942
y(library)34 b(designers,)h(b)m(ut)f(also)h(to)f(language)h(designers)f
(because)j(of)d(the)h(fur)m(-)4098 9108 y(ther)i(e)l(vidence)g(for)g
(the)g(usefulness)g(of)g(rank-2)f(polymorphic)f(types.)4098
9341 y(The)j(code)f(for)g(all)g(the)g(e)n(xamples)g(is)g(a)m(v)l
(ailable)g(online)f(at:)4727 9536 y Ff
(http://www.cs.vu.nl/Strafunski/gmap/)4098 9731 y Fm(The)65
b(distrib)m(ution)c(comes)k(with)e(generati)l(v)n(e)h(tool)f(support)g
(to)h(generate)4098 9897 y(all)50 b(datatype-speci\002c)h(boilerplate)d
(code.)87 b(Our)51 b(benchmarks)f(sho)l(w)h(that)4098
10063 y(it)60 b(is)g(possible)g(to)g(get)g(the)g(run-time)g
(performance)h(of)f(typical)f(generic)4098 10229 y(programs)44
b(reasonably)f(close)h(to)g(the)f(hand-coded)g(boilerplate-intensi)l(v)
n(e)4098 10395 y(counterparts)36 b(\(Section)g(10\).)p
eop
%%Page: 2 2
2 1 bop -300 166 a Fn(2)199 b(The)50 b(pr)l(oblem)-300
400 y Fm(W)-12 b(e)50 b(be)n(gin)e(by)h(characterising)f(the)h(problem)
f(we)i(are)g(addressing.)81 b(Con-)-300 566 y(sider)33
b(the)g(follo)l(wing)d(data)j(types)g(that)f(describe)h(the)g(or)m(g)o
(anisational)f(struc-)-300 732 y(ture)45 b(of)g(a)h(compan)n(y)-10
b(.)70 b(A)46 b(compan)n(y)f(is)g(di)l(vided)f(into)g(departments)h
(which)-300 898 y(in)51 b(turn)g(ha)m(v)n(e)h(a)h(manager)-6
b(,)56 b(and)c(consists)g(of)f(a)i(collection)d(of)i(sub-units.)-300
1064 y(A)40 b(unit)f(is)g(either)h(a)g(single)f(emplo)o(yee)h(or)f(a)i
(department.)54 b(Both)38 b(managers)-300 1230 y(and)f(ordinary)f
(emplo)o(yees)h(are)h(persons)f(recei)l(ving)f(a)i(salary)-10
b(.)47 b(That)37 b(is:)-148 1450 y Ff(data)77 b(Company)154
b(=)77 b(C)f([Dept])-148 1616 y(data)h(Dept)382 b(=)77
b(D)f(Name)h(Manager)h([SubUnit])-148 1782 y(data)f(SubUnit)154
b(=)77 b(PU)f(Employee)i(|)f(DU)f(Dept)-148 1948 y(data)h(Employee)h(=)
f(E)f(Person)i(Salary)-148 2115 y(data)f(Person)230 b(=)77
b(P)f(Name)h(Address)-148 2281 y(data)g(Salary)230 b(=)77
b(S)f(Float)-148 2447 y(type)h(Manager)154 b(=)77 b(Employee)-148
2613 y(type)g(Name)382 b(=)77 b(String)-148 2779 y(type)g(Address)154
b(=)77 b(String)-300 2999 y Fm(Here)38 b(is)f(a)g(small)h(compan)n(y)f
(represented)g(by)g(such)g(a)h(data)f(structure:)-148
3194 y Ff(genCom)78 b(::)f(Company)-148 3360 y(genCom)h(=)e(C)h([D)f
("Research")j(ralf)e([PU)g(joost,)g(PU)g(marlow],)767
3526 y(D)f("Strategy")j(blair)e([]])-148 3746 y(ralf,)h(joost,)f
(marlow,)h(blair)f(::)g(Employee)-148 3912 y(ralf)230
b(=)76 b(E)h(\(P)f("Ralf")230 b("Amsterdam"\))79 b(\(S)e(8000\))-148
4078 y(joost)154 b(=)76 b(E)h(\(P)f("Joost")154 b("Amsterdam"\))79
b(\(S)e(1000\))-148 4244 y(marlow)h(=)e(E)h(\(P)f("Marlow")i
("Cambridge"\))h(\(S)e(2000\))-148 4410 y(blair)154 b(=)76
b(E)h(\(P)f("Blair")154 b("London"\))307 b(\(S)77 b(100000\))-300
4630 y Fm(The)f(adv)n(ent)g(of)f(XML)h(has)g(made)h(schemata)g(lik)o(e)
e(this)g(much)h(more)-300 4796 y(widespread,)64 b(and)58
b(man)n(y)h(tools)e(e)n(xist)h(for)g(translating)e(XML)j(schemata)-300
4962 y(into)73 b(data)h(type)f(de\002nitions)g(in)g(v)l(arious)g
(languages;)92 b(in)73 b(the)h(case)i(of)-300 5128 y(Hask)o(ell,)47
b(HaXML)e(includes)f(such)h(a)h(tool)e([35)o(].)70 b(There)45
b(are)h(often)e(man)n(y)-300 5294 y(data)49 b(types)f(in)-6
b(v)m(olv)n(ed,)50 b(sometimes)f(with)e(man)n(y)i(constructors,)h(and)f
(their)-300 5460 y(structure)36 b(tends)h(to)g(change)g(o)n(v)n(er)g
(time.)-300 5693 y(No)l(w)29 b(suppose)g(we)h(w)o(ant)e(to)h(increase)h
(the)f(salary)g(of)g(e)l(v)n(eryone)g(in)g(the)g(com-)-300
5859 y(pan)n(y)j(by)h(a)g(speci\002ed)h(percentage.)45
b(That)33 b(is,)h(we)g(must)e(write)h(the)f(function:)-148
6054 y Ff(increase)78 b(::)f(Float)g(->)g(Company)h(->)e(Company)-300
6249 y Fm(So)45 b(that)g Ff(\(increase)78 b(0.1)f(genCom\))46
b Fm(will)e(be)h(just)g(lik)o(e)f Ff(genCom)i Fm(e)n(xcept)-300
6415 y(that)41 b(e)l(v)n(eryone')-8 b(s)41 b(salary)h(is)f(increased)h
(by)f(10\045.)60 b(It)41 b(is)g(perfectly)g(straight-)-300
6581 y(forw)o(ard)36 b(to)g(write)h(this)f(function)g(in)g(Hask)o(ell:)
-148 6776 y Ff(increase)78 b(k)f(\(C)f(ds\))h(=)g(C)f(\(map)h(\(incD)g
(k\))g(ds\))-148 6996 y(incD)g(::)g(Float)g(->)g(Dept)g(->)g(Dept)-148
7162 y(incD)g(k)g(\(D)g(nm)f(mgr)h(us\))g(=)-71 7328
y(D)f(nm)h(\(incE)g(k)f(mgr\))h(\(map)h(\(incU)f(k\))f(us\))-148
7548 y(incU)h(::)g(Float)g(->)g(SubUnit)h(->)e(SubUnit)-148
7714 y(incU)h(k)g(\(PU)g(e\))f(=)h(PU)f(\(incE)i(k)e(e\))-148
7880 y(incU)h(k)g(\(DU)g(d\))f(=)h(DU)f(\(incD)i(k)e(d\))-148
8100 y(incE)h(::)g(Float)g(->)g(Employee)h(->)f(Employee)-148
8266 y(incE)g(k)g(\(E)g(p)f(s\))h(=)f(E)g(p)h(\(incS)g(k)g(s\))-148
8486 y(incS)g(::)g(Float)g(->)g(Salary)h(->)e(Salary)-148
8652 y(incS)h(k)g(\(S)g(s\))f(=)h(S)f(\(s)h(*)f(\(1+k\)\))-300
8872 y Fm(Looking)34 b(at)i(this)e(code,)j(it)e(should)f(be)i(apparent)
f(what)g(we)h(mean)g(by)f(\223boil-)-300 9038 y(erplate\224.)73
b(Almost)45 b(all)h(the)f(code)i(consists)e(of)h(a)g(routine)e(tra)m(v)
n(ersal)i(of)f(the)-300 9204 y(tree.)100 b(The)56 b(only)e(interesting)
f(bit)h(is)h Ff(incS)h Fm(which)e(actually)h(increases)h(a)-300
9370 y Ff(Salary)p Fm(.)84 b(As)49 b(the)g(size)g(of)g(the)g(data)g
(type)f(increases,)54 b(the)48 b(ratio)h(of)f(inter)m(-)-300
9536 y(esting)39 b(code)i(to)e(boilerplate)g(decreases.)57
b(W)-12 b(orse,)41 b(this)f(sort)f(of)h(boilerplate)-300
9702 y(needs)i(to)e(be)i(produced)f(for)f(each)i(ne)l(w)g(piece)g(of)f
(tra)m(v)n(ersal)g(functionality)-10 b(.)-300 9868 y(F)n(or)40
b(e)n(xample,)h(a)g(function)d(that)i(\002nds)g(the)g(salary)g(of)g(a)h
(named)g(indi)l(vidual)-300 10035 y(w)o(ould)35 b(require)i(a)h(ne)l(w)
f(sw)o(athe)g(of)g(boilerplate.)-300 10400 y Fn(3)199
b(Our)50 b(solution)-300 10634 y Fm(Our)58 b(goal,)64
b(then,)g(is)58 b(to)g(write)g Ff(increase)i Fm(without)c(the)j
(accompan)n(ying)-300 10800 y(boilerplate)50 b(code.)91
b(T)-12 b(o)51 b(gi)l(v)n(e)h(an)g(idea)g(of)f(what)g(is)h(to)f(come,)
57 b(here)52 b(is)f(the)4098 166 y(code)38 b(for)e Ff(increase)p
Fm(:)4250 361 y Ff(increase)78 b(::)f(Float)g(->)g(Company)h(->)e
(Company)4250 527 y(increase)i(k)f(=)f(everywhere)j(\(mkT)e(\(incS)g
(k\)\))4098 722 y Fm(And)37 b(that)f(is)h(it!)45 b(This)37
b(code)h(is)f(formed)g(from)g(four)f(distinct)g(ingredients:)4272
917 y Fh(\017)83 b Fm(The)66 b(function)e Ff(incS)i Fm(\(gi)l(v)n(en)f
(in)f(Section)h(2\))g(is)h(the)f(\223interesting)4430
1083 y(part\224)44 b(of)g(the)f(algorithm.)66 b(It)43
b(performs)h(the)g(arithmetic)f(to)g(increase)4430 1249
y(a)38 b Ff(Salary)p Fm(.)4272 1465 y Fh(\017)83 b Fm(The)49
b(function)e Ff(mkT)j Fm(mak)o(es)f(a)g Fi(type)g(e)m(xtension)f
Fm(of)h Ff(incS)h Fm(\(read)e Ff(mkT)4430 1631 y Fm(as)e(\223mak)o(e)f
(a)h(transformation\224\),)f(so)g(that)g(it)f(can)i(be)f(applied)f(to)g
(an)n(y)4430 1797 y(node)50 b(in)g(the)g(tree,)k(not)49
b(just)h Ff(Salary)h Fm(nodes.)86 b(The)51 b(type-e)n(xtended)4430
1963 y(function,)42 b Ff(mkT)77 b(\(incS)g(k\))p Fm(,)45
b(beha)m(v)n(es)d(lik)o(e)f Ff(incS)i Fm(when)f(applied)g(to)4430
2130 y(a)48 b Ff(Salary)h Fm(and)f(lik)o(e)e(the)h(identity)f(function)
f(when)j(applied)e(to)h(an)n(y)4430 2296 y(other)37 b(type.)46
b(W)-12 b(e)37 b(discuss)g(type)g(e)n(xtension)f(in)h(Section)f(3.1.)
4272 2511 y Fh(\017)83 b Fm(The)49 b(function)e Ff(everywhere)j
Fm(is)e(a)h Fi(g)o(eneric)g(tr)n(aver)o(sal)e(combinator)4430
2677 y Fm(that)52 b(applies)g(its)g(ar)m(gument)h(function)e(to)h(e)l
(v)n(ery)h(node)f(in)g(the)h(tree.)4430 2844 y(In)66
b(this)g(case,)75 b(the)67 b(function)e(is)h(the)g(type-e)n(xtended)f
Ff(incS)j Fm(func-)4430 3010 y(tion,)35 b(which)f(will)g(increase)i
(the)f(v)l(alue)g(of)g Ff(Salary)i Fm(nodes)e(and)g(lea)m(v)n(e)4430
3176 y(all)57 b(others)g(unchanged.)108 b(W)-12 b(e)58
b(discuss)g(generic)f(tra)m(v)n(ersal)g(in)g(Sec-)4430
3342 y(tions)36 b(3.2)h(and)g(3.3.)4272 3557 y Fh(\017)83
b Fm(Both)53 b Ff(mkT)i Fm(and)f Ff(everywhere)i Fm(are)f(o)n(v)n
(erloaded)e(functions,)k(in)c(the)4430 3724 y(Hask)o(ell)60
b(sense,)69 b(o)n(v)n(er)60 b(the)h(classes)h Ff(Typeable)h
Fm(and)e Ff(Term)i Fm(\(to)d(be)4430 3890 y(introduced)51
b(shortly\).)91 b(F)n(or)53 b(each)g(data)g(type)g(in)-6
b(v)m(olv)n(ed)50 b(\()p Ff(Company)p Fm(,)4430 4056
y Ff(Dept)p Fm(,)j Ff(Person)p Fm(,)g(etc.\))81 b(the)49
b(programmer)f(must)h(therefore)f(gi)l(v)n(e)g(an)4430
4222 y Ff(instance)c Fm(declaration)d(for)g(the)g(tw)o(o)g(classes.)61
b(Ho)l(we)l(v)n(er)42 b(these)g(in-)4430 4388 y(stances)47
b(are,)i(as)e(we)g(shall)e(see)i(in)f(Sections)g(3.2)g(and)g(8,)j(e)n
(xtremely)4430 4554 y(simple)40 b(\227)h(in)e(f)o(act,)i(the)n(y)e(are)
i(\223pure)f(boilerplate\224)f(\227)h(and)g(the)n(y)g(can)4430
4720 y(easily)51 b(be)g(generated)g(mechanically)-10
b(.)88 b(The)52 b(softw)o(are)e(distrib)m(ution)4430
4886 y(that)37 b(comes)h(with)e(the)h(paper)g(includes)g(a)g(tool)f(to)
h(do)g(just)f(that.)4098 5081 y(The)i(follo)l(wing)d(sections)h(\002ll)
h(in)g(the)g(details)f(of)h(this)f(sk)o(etch.)4098 5340
y Fe(3.1)183 b(T)-14 b(ype)46 b(extension)4098 5574 y
Fm(The)38 b(\002rst)g(step)f(is)h(to)f(e)n(xtend)g(a)h(function,)f
(such)h(as)g Ff(incS)p Fm(,)h(that)e(w)o(orks)g(o)n(v)n(er)4098
5740 y(a)56 b(single)f(type)c Fi(t)10 b Fm(,)61 b(to)55
b(a)i(function)d(that)h(w)o(orks)f(o)n(v)n(er)h(man)n(y)h(types,)k(b)m
(ut)55 b(is)4098 5906 y(the)45 b(identity)d(at)j(all)g(types)f(b)m(ut)c
Fi(t)10 b Fm(.)70 b(The)45 b(fundamental)f(b)m(uilding-brick)d(is)k(a)
4098 6072 y(type-safe)c Ff(cast)h Fm(operator)f(the)g(type)g(of)g
(which)f(in)-6 b(v)m(olv)n(es)40 b(a)i(Hask)o(ell)e(class)4098
6238 y Ff(Typeable)f Fm(of)e(types)g(that)f(can)i(be)f(subject)g(to)g
(a)h(cast:)4250 6434 y Ff(--)77 b(An)g(abstract)h(class)4250
6600 y(class)g(Typeable)4250 6833 y(--)f(A)f(type-safe)j(cast)e
(operator)4250 6999 y(cast)g(::)g(\(Typeable)h(a,)f(Typeable)h(b\))e
(=>)h(a)g(->)f(Maybe)h(b)4098 7232 y Fm(This)42 b Ff(cast)h
Fm(function)d(tak)o(es)i(an)g(ar)m(gument)g Ff(x)g Fm(of)g(type)f
Ff(a)p Fm(.)62 b(It)41 b(mak)o(es)i(a)f(run-)4098 7398
y(time)36 b(test)g(that)g(compares)h(the)f(types)g Ff(a)h
Fm(and)f Ff(b)p Fm(;)g(if)g(the)n(y)g(are)h(the)f(same)h(type,)4098
7564 y Ff(cast)31 b Fm(returns)f Ff(Just)77 b(x)p Fm(;)33
b(if)d(not,)h(it)f(returns)f Ff(Nothing)p Fm(.)6921 7510
y Fk(1)7034 7564 y Fm(F)n(or)g(e)n(xample,)k(here)4098
7731 y(is)k(an)g(interacti)l(v)n(e)g Ff(GHCi)h Fm(session:)4250
7926 y Ff(Prelude>)78 b(\(cast)g('a'\))f(::)f(Maybe)i(Char)4250
8092 y(Just)f('a')4250 8258 y(Prelude>)h(\(cast)g('a'\))f(::)f(Maybe)i
(Bool)4250 8424 y(Nothing)4250 8590 y(Prelude>)g(\(cast)g(True\))f(::)g
(Maybe)g(Bool)4250 8756 y(Just)g(True)4098 8951 y Fm(The)44
b(type)f(signature)f(in)h(the)g(abo)n(v)n(e)g(samples)h(gi)l(v)n(es)f
Ff(cast)h Fm(its)f(result)f(con-)4098 9117 y(te)n(xt,)32
b Ff(Typeable)78 b(b)p Fm(,)33 b(so)e(it)f(kno)l(ws)h(what)g(the)g
(result)f(type)g(must)h(be;)i(without)4098 9283 y(that,)53
b(it)c(cannot)g(do)g(the)h(type)f(test.)84 b(Because)51
b(the)f(type)f(class)h Ff(Typeable)4098 9449 y Fm(constrains)65
b(the)h(types)f(in)-6 b(v)m(olv)n(ed,)72 b Ff(cast)67
b Fm(is)f(not)f(completely)g(polymor)m(-)4098 9615 y(phic:)48
b(both)37 b(ar)m(gument)h(and)h(result)f(types)g(must)g(be)h(instances)
f(of)g(the)g(class)4098 9781 y Ff(Typeable)p Fm(.)4098
10014 y(T)-12 b(ype-safe)55 b(cast)h(can)f(be)g(inte)n(grated)e(with)h
(functional)e(programming)i(in)4098 10180 y(v)l(arious)60
b(w)o(ays,)67 b(preferably)60 b(by)h(a)g(language)g(e)n(xtension.)116
b(In)60 b(f)o(act,)67 b(it)60 b(is)p 4098 10291 1601
7 v 4301 10414 a Fk(1)4367 10468 y Fm(In)35 b(man)n(y)h(languages)f(a)h
(\223cast\224)h(operator)d(performs)h(a)h Fi(r)-6 b(epr)g(esentation)
4098 10634 y(c)n(hang)o(e)58 b Fm(as)i(well)e(as)i Fi(type)f(c)n(hang)o
(e)p Fm(.)111 b(Here,)66 b Ff(cast)60 b Fm(is)f(operationally)d(the)
4098 10800 y(identity)35 b(function;)g(it)h(only)h(mak)o(es)g(a)h(type)
f(change.)p eop
%%Page: 3 3
3 2 bop -300 166 a Fm(well-kno)l(wn)50 b(folk)h(lore)g(in)h(the)f(Hask)
o(ell)h(community)e(that)i(much)g(of)f(the)-300 332 y(functionality)44
b(of)j Ff(cast)i Fm(can)f(be)f(programmed)h(in)e(standard)h(Hask)o
(ell.)77 b(In)-300 498 y(Section)50 b(8,)k(we)d(pro)n(vide)d(a)j
(corresponding)e(Hask)o(ell-encoding)f(that)i(can)-300
664 y(be)42 b(re)n(g)o(arded)g(as)h(a)g(reference)g(implementation)d
(for)i(type-safe)g(cast.)61 b(This)-300 830 y(will)37
b(clarify)g(that)g(a)h(corresponding)e(e)n(xtension)h(turns)g(out)g(to)
g(be)h(a)g(modest)-300 996 y(one.)76 b(F)n(or)47 b(the)g(coming)f
(sections)h(we)h(will)d(simply)i(assume)h(that)e Ff(cast)i
Fm(is)-300 1162 y(a)m(v)l(ailable,)37 b(and)h(that)e(e)l(v)n(ery)h
(type)g(is)g(an)h(instance)f(of)f Ff(Typeable)p Fm(.)-300
1395 y(Gi)l(v)n(en)h Ff(cast)p Fm(,)h(we)g(can)g(write)e
Ff(mkT)p Fm(,)i(which)f(we)h(met)f(in)g(Section)f(3:)-148
1590 y Ff(mkT)77 b(::)g(\(Typeable)h(a,)f(Typeable)h(b\))157
1756 y(=>)f(\(b)g(->)f(b\))h(->)f(a)h(->)g(a)-148 1922
y(mkT)g(f)g(=)f(case)h(cast)g(f)g(of)615 2088 y(Just)g(g)152
b(->)77 b(g)615 2254 y(Nothing)g(->)g(id)-300 2449 y
Fm(That)42 b(is,)i Ff(mkT)77 b(f)f(x)43 b Fm(applies)f
Ff(f)h Fm(to)e Ff(x)i Fm(if)f Ff(x)p Fm(')-8 b(s)42 b(type)g(is)g(the)g
(same)i(as)f Ff(f)p Fm(')-8 b(s)42 b(ar)m(gu-)-300 2615
y(ment)49 b(type,)j(and)e(otherwise)e(applies)h(the)g(identity)e
(function)h(to)g Ff(x)p Fm(.)84 b(Here)-300 2781 y(are)38
b(some)g(e)n(xamples:)-148 2976 y Ff(Prelude>)78 b(\(mkT)f(not\))g
(True)-148 3142 y(False)-148 3308 y(Prelude>)h(\(mkT)f(not\))g('a')-148
3474 y('a')-300 3670 y Fm(\223)p Ff(mkT)p Fm(\224)41
b(is)f(short)f(for)g(\223mak)o(e)i(a)f(transformation\224,)g(because)h
(it)e(constructs)g(a)-300 3836 y(generic)e(transformation)e(function.)
45 b(W)-12 b(e)38 b(can)g(use)f Ff(mkT)h Fm(to)f(lift)f
Ff(incS)p Fm(,)i(thus:)-148 4031 y Ff(inc)77 b(::)g(Typeable)h(a)e(=>)h
(Float)g(->)g(a)f(->)h(a)-148 4197 y(inc)g(k)g(=)f(mkT)h(\(incS)g(k\))
-300 4392 y Fm(So)33 b Ff(inc)i Fm(is)e(applicable)g(to)g(an)n(y)g
(type)g(that)g(is)g(an)h(instance)f(of)h Ff(Typeable)h
Fm(b)m(ut)-300 4558 y(we)50 b(ultimately)d(aim)j(at)f(a)h(function)e
(that)h(applies)f Ff(inc)j Fm(to)d Fi(all)h(nodes)g Fm(in)g(a)-300
4724 y(tree.)e(This)37 b(necessitates)h(generic)f(tra)m(v)n(ersal.)-300
5248 y Fe(3.2)183 b(One-lay)n(er)46 b(tra)-5 b(v)n(ersal)-300
5482 y Fm(Our)32 b(approach)g(to)f(tra)m(v)n(ersal)h(has)g(tw)o(o)f
(steps:)43 b(for)32 b(each)h(data)f(type)f(we)i(write)-300
5648 y(a)38 b(single)f(function,)g Ff(gmapT)p Fm(,)i(that)e(tra)m(v)n
(erses)h(v)l(alues)g(of)f(that)g(type;)g(then)h(we)-300
5815 y(b)m(uild)d(a)j(v)l(ariety)e(of)h(recursi)l(v)n(e)g(tra)m(v)n
(ersals)f(from)h Ff(gmapT)p Fm(.)h(In)f(the)g(conte)n(xt)f(of)-300
5981 y(Hask)o(ell,)h(we)g(o)n(v)n(erload)f Ff(gmapT)j
Fm(using)d(a)h(type)g(class,)h Ff(Term)p Fm(:)-224 6176
y Ff(class)77 b(Typeable)h(a)f(=>)f(Term)i(a)e(where)-71
6342 y(gmapT)h(::)g(\(forall)g(b.)g(Term)g(b)f(=>)h(b)f(->)h(b\))g(->)f
(a)h(->)f(a)-300 6537 y Fm(The)45 b(intended)d(beha)m(viour)h(is)h
(this:)58 b Ff(gmapT)46 b Fm(tak)o(es)d(a)i(generic)f(transforma-)-300
6703 y(tion)39 b(\(such)h(as)g Ff(inc)77 b(k)p Fm(\))41
b(and)f(applies)f(it)h(to)f(all)h(the)g Fi(immediate)f
Fm(children)g(of)-300 6869 y(the)k(v)l(alue.)63 b(It)42
b(is)h(easiest)g(to)f(understand)g(this)f(idea)i(by)g(e)n(xample.)63
b(Here)43 b(is)-300 7035 y(the)37 b Ff(instance)i Fm(declaration)d(for)
h Ff(Employee)p Fm(:)-224 7230 y Ff(instance)78 b(Term)f(Employee)h
(where)-71 7396 y(gmapT)f(f)f(\(E)h(per)g(sal\))g(=)f(E)h(\(f)f(per\))h
(\(f)g(sal\))-300 7591 y Fm(Here)46 b(we)f(see)h(clearly)f(that)g
Ff(gmapT)h Fm(simply)e(applies)h Ff(f)h Fm(to)e(the)h(immediate)-300
7757 y(children)36 b(of)h Ff(E)p Fm(,)h(namely)f Ff(per)h
Fm(and)f Ff(sal)p Fm(,)i(and)e(reb)m(uilds)f(a)h(ne)l(w)h
Ff(E)g Fm(node.)-300 7990 y(There)81 b(are)f(tw)o(o)f(things)f(w)o
(orth)h(mentioning)f(re)n(g)o(arding)g(the)i(type)g(of)-300
8156 y Ff(gmapT)d Fm(and)e(its)g(hosting)f(class)i Ff(Term)p
Fm(.)163 b(Firstly)-10 b(,)84 b Ff(gmapT)77 b Fm(has)f(a)g(non-)-300
8322 y(standard)40 b(type:)53 b(its)40 b(\002rst)g(ar)m(gument)h(is)f
(a)i Fi(polymorphic)d Fm(function,)h(of)h(type)-300 8488
y Ff(forall)77 b(b.)g(Term)g(b)g(=>)f(b)h(->)f(b)p Fm(.)92
b(Wh)o(y?)e(Because)54 b(it)d(is)h(applied)f(to)-300
8654 y(both)33 b Ff(per)i Fm(and)e Ff(sal)i Fm(in)e(the)h
Ff(instance)i Fm(declaration,)e(and)g(those)f(tw)o(o)g(\002elds)-300
8820 y(ha)m(v)n(e)53 b(dif)l(ferent)f(types.)93 b(Hask)o(ell)52
b(98)g(w)o(ould)f(reject)i(the)g(type)f(of)h Ff(gmapT)p
Fm(,)-300 8986 y(b)m(ut)c(rank-2)g(types)h(lik)o(e)e(these)j(ha)m(v)n
(e)f(become)h(quite)d(well-established)h(in)-300 9152
y(the)56 b(Hask)o(ell)f(community)-10 b(.)101 b(W)-12
b(e)57 b(elaborate)e(in)h(Section)f(9.1.)102 b(Secondly)-10
b(,)-300 9318 y(note)52 b(the)g(recursion)f(in)h(the)g(class)h
(declaration)f(of)g Ff(Term)p Fm(.)92 b(The)53 b(member)-300
9484 y(signature)36 b(for)h Ff(gmapT)h Fm(refers)g(to)e
Ff(Term)j Fm(via)e(a)g(class)h(constraint.)-300 9717
y(Ob)n(viously)-10 b(,)35 b(we)h(can)h(pro)n(vide)e(a)h(simple)g
(schematic)h(de\002nition)d(for)i Ff(gmapT)-300 9883
y Fm(for)h(arbitrary)e(terms)j Ff(C)76 b(t1)h(...)g(tn)p
Fm(:)-71 10078 y Ff(gmapT)g(f)f(\(C)h(t1)g(...)f(tn\))h(=)g(C)f(\(f)h
(t1\))g(...)g(\(f)f(tn\))-300 10273 y Fm(When)53 b(the)g(node)f(has)i
(no)e(children,)k Ff(gmapT)e Fm(has)g(no)e(ef)l(fect.)95
b(Hence)53 b(the)-300 10439 y Ff(Term)38 b Fm(instance)f(for)g
Ff(Bool)h Fm(looks)e(lik)o(e)g(this:)-148 10634 y Ff(instance)78
b(Term)f(Bool)g(where)5 10800 y(gmapT)g(f)g(x)f(=)g(x)4098
166 y Fm(The)53 b(important)e(thing)f(to)i(notice)g(is)g(that)g
Ff(gmapT)i Fm(only)d(applies)h Ff(f)h Fm(to)e(the)4098
332 y Fi(immediate)36 b Fm(children)f(of)i(the)g(node)f(as)i(opposed)e
(to)g(an)n(y)h(kind)f(of)g(recursi)l(v)n(e)4098 498 y(tra)m(v)n(ersal.)
78 b(Here,)51 b(for)c(e)n(xample,)k(is)d(the)f Ff(Term)i
Fm(instance)f(for)f(lists,)j(which)4098 664 y(follo)l(ws)36
b(e)n(xactly)h(the)g(same)h(pattern)e(as)i(the)f(instance)g(for)g
Ff(Employee)p Fm(:)4250 859 y Ff(instance)78 b(Term)f(a)g(=>)f(Term)i
([a])e(where)4403 1025 y(gmapT)h(f)g([])381 b(=)76 b([])4403
1191 y(gmapT)h(f)g(\(x:xs\))g(=)f(f)h(x)f(:)h(f)f(xs)4098
1386 y Fm(Notice)55 b(the)h(\223)p Ff(f)77 b(xs)p Fm(\224)57
b(for)e(the)h(tail)f(\227)i(not)e(\223)p Ff(gmapT)77
b(f)g(xs)p Fm(\224;)65 b Ff(gmapT)58 b Fm(tra-)4098 1553
y(v)n(erses)38 b(one)f(layer)g(only)-10 b(,)37 b(unlik)o(e)e(the)i
(common)g(recursi)l(v)n(e)g Ff(map)h Fm(function.)4098
1831 y Fe(3.3)183 b(Recursi)n(v)n(e)46 b(tra)-5 b(v)n(ersal)4098
2066 y Fm(Ev)n(en)38 b(though)e Ff(gmapT)k Fm(has)e(this)f(one-layer)m
(-only)f(beha)m(viour)-6 b(,)38 b(we)g(can)h(syn-)4098
2232 y(thesise)g(a)h(v)l(ariety)f(of)g(recursi)l(v)n(e)g(tra)m(v)n
(ersals)g(from)g(it.)52 b(Indeed,)40 b(as)g(we)g(shall)4098
2398 y(see,)56 b(it)51 b(is)g(precisely)g(its)g(one-layer)g(beha)m
(viour)f(that)h(mak)o(es)h(this)f(v)l(ariety)4098 2564
y(easy)38 b(to)f(capture.)4098 2796 y(F)n(or)f(e)n(xample,)i(the)f
Ff(everywhere)i Fm(combinator)d(applies)h(a)g(transformation)4098
2962 y(to)g(e)l(v)n(ery)g(node)g(in)f(a)i(tree:)4250
3157 y Ff(--)77 b(Apply)g(a)g(transformation)i(everywhere,)g(bottom-up)
4250 3323 y(everywhere)g(::)d(Term)h(a)5089 3489 y(=>)f(\(forall)i(b.)f
(Term)g(b)f(=>)h(b)f(->)h(b\))5089 3655 y(->)f(a)h(->)f(a)4250
3821 y(everywhere)j(f)d(x)h(=)f(f)g(\(gmapT)i(\(everywhere)h(f\))d(x\))
4098 4017 y Fm(W)-12 b(e)41 b(can)h(read)f(this)f(function)f(as)i
(follo)l(ws:)52 b(\002rst)40 b(apply)g Ff(everywhere)79
b(f)41 b Fm(to)4098 4183 y(all)35 b(the)g(children)f(of)g
Ff(x)p Fm(,)j(and)e(then)f(apply)g Ff(f)i Fm(to)e(the)h(result.)45
b(The)36 b(recursion)e(is)4098 4349 y(in)j(the)g(de\002nition)e(of)i
Ff(everywhere)p Fm(,)j(not)c(in)h(the)g(de\002nition)e(of)i
Ff(gmapT)p Fm(.)7872 4294 y Fk(2)4098 4581 y Fm(The)65
b(beautiful)e(thing)f(about)i(b)m(uilding)d(a)k(recursi)l(v)n(e)f(tra)m
(v)n(ersal)g(strate)n(gy)4098 4747 y(out)f(of)g(non-recursi)l(v)n(e)g
Ff(gmapT)i Fm(is)f(that)f(we)h(can)g(b)m(uild)e(man)n(y)i(dif)l(ferent)
4098 4913 y(strate)n(gies)h(using)f(a)i(single)f(de\002nition)f(of)h
Ff(gmapT)p Fm(.)i(As)f(we)g(ha)m(v)n(e)f(seen,)4098 5079
y Ff(everywhere)c Fm(w)o(orks)c(bottom-up,)k(because)f
Ff(f)e Fm(is)g(applied)g(after)g Ff(gmapT)4098 5245 y
Fm(has)38 b(processed)f(the)g(children.)46 b(It)36 b(is)h(equally)g
(easy)g(to)g(do)g(top-do)l(wn:)4250 5440 y Ff(--)77 b(Apply)g(a)g
(transformation)i(everywhere,)g(top-down)4250 5606 y(everywhere')g(::)e
(Term)g(a)5165 5772 y(=>)g(\(forall)g(b.)g(Term)g(b)f(=>)h(b)g(->)f
(b\))5165 5939 y(->)h(a)f(->)h(a)4250 6105 y(everywhere')i(f)d(x)h(=)f
(gmapT)i(\(everywhere')g(f\))f(\(f)g(x\))4098 6300 y
Fm(In)37 b(the)h(rest)f(of)h(this)e(paper)i(we)g(will)e(see)j(man)n(y)e
(dif)l(ferent)g(recursi)l(v)n(e)h(strate-)4098 6466 y(gies,)f(each)i
(of)d(which)h(tak)o(es)g(a)h(line)e(or)h(tw)o(o)f(to)h(de\002ne.)4098
6698 y(This)h(e)n(xtremely)f(ele)n(g)o(ant)h(w)o(ay)g(of)f(b)m(uilding)
f(a)i Fi(r)-6 b(ecur)o(sive)39 b Fm(tra)m(v)n(ersal)f(in)f(tw)o(o)4098
6864 y(steps)60 b(\227)h(\002rst)g(de\002ne)f(a)h Fi(one-layer)j
Fm(map,)j(and)60 b(then)g(tie)g(the)g(recursi)l(v)n(e)4098
7030 y(knot)53 b(separately)h(\227)h(is)f(well-kno)l(wn)f(folk)g(lore)h
(in)g(the)g(functional)e(pro-)4098 7196 y(gramming)c(community)-10
b(,)51 b(e.g.,)i(when)48 b(dealing)g(with)f(ana-)i(and)g(catamor)m(-)
4098 7362 y(phisms)42 b(for)f(re)n(gular)h(data)g(types)g(such)g(as)h
(lists)e([22].)61 b(F)n(or)42 b(lack)g(of)g(better)m(-)4098
7528 y(established)53 b(terminology)e(we)i(call)h(it)e(\223)p
Fi(the)i(non-r)-6 b(ecur)o(sive)53 b(map)g(tric)m(k)s
Fm(\224,)4098 7694 y(and)37 b(re)l(vie)l(w)h(it)e(in)h(Section)f(9.2.)
4098 7973 y Fe(3.4)183 b(Another)45 b(example)4098 8207
y Fm(Lest)40 b(we)f(get)g(\002xated)g(on)f Ff(increase)j
Fm(here)f(is)f(another)f(e)n(xample)h(that)g(uses)4098
8374 y(the)44 b(same)h(design)e(pattern.)67 b(Let)44
b(us)g(write)f(a)i(function)d(that)i(\003attens)f(out)h(a)4098
8540 y(named)52 b(department)g Fi(d)8 b Fm(;)58 b(that)51
b(is,)k(it)c(tak)o(es)h(all)f Fi(d)8 b Fm(')-8 b(s)51
b(sub-units)f(and)i(mak)o(es)4098 8706 y(them)37 b(part)g(of)g
Fi(d)8 b Fm(')-8 b(s)36 b(parent)h(department:)4174 8901
y Ff(flatten)78 b(::)f(Name)g(->)f(Company)i(->)f(Company)4174
9067 y(flatten)h(d)e(=)h(everywhere)h(\(mkT)f(\(flatD)h(d\)\))4174
9310 y(flatD)f(::)g(Name)g(->)g(Dept)g(->)g(Dept)4174
9476 y(flatD)g(d)g(\(D)g(n)f(m)g(us\))4327 9642 y(=)g(D)g(n)h(m)f
(\(concatMap)j(unwrap)e(us\))4250 9808 y(where)4479 9974
y(unwrap)h(::)e(SubUnit)i(->)f([SubUnit])4479 10140 y(unwrap)h(\(DU)e
(\(D)h(d')g(m)f(us\)\))h(|)g(d==d')g(=)f(PU)h(m)f(:)h(us)4479
10306 y(unwrap)h(u)1829 b(=)76 b([u])p 4098 10457 1601
7 v 4301 10580 a Fk(2)4367 10634 y Fm(In)37 b(\223point-free\224)f
(notation:)4098 10800 y Ff(everywhere)78 b(f)f(=)f(f)h(.)f(gmapT)h
(\(everywhere)i(f\))p eop
%%Page: 4 4
4 3 bop -300 166 a Fm(The)47 b(function)e Ff(flatD)i
Fm(does)g(the)f(interesting)f(w)o(ork)g(on)h(a)h(department:)64
b(it)-300 332 y(looks)34 b(at)g(each)i(of)e(its)g(sub-units,)g
Ff(u)p Fm(,)i(applies)e Ff(unwrap)i Fm(to)e(get)g(a)i(list)d(of)h
(units)-300 498 y(\(usually)28 b(the)g(singleton)g(list)g
Ff([u])p Fm(\),)j(and)e(concatenates)h(the)f(results.)3236
444 y Fk(3)3345 498 y Fm(When)-300 664 y Ff(unwrap)44
b Fm(sees)f(the)f(tar)m(get)g(department)g(\()p Ff(d)76
b(==)h(d')p Fm(\))42 b(it)g(returns)f(all)h(its)g(sub-)-300
830 y(units.)71 b(The)47 b(manager)f Ff(m)g Fm(is)g(not)f(\002red,)j(b)
m(ut)d(is)h(turned)f(into)f(a)j(plain)e(w)o(ork-)-300
996 y(ing)37 b(unit,)f Ff(PU)77 b(m)38 b Fm(\(presumably)f(subject)g
(to)g(drastic)g(subsequent)g(salary)g(de-)-300 1162 y(crease\).)-300
1395 y(Ag)o(ain,)74 b(this)65 b(is)h Fi(all)g Fm(the)g(code)h(for)f
(the)g(task.)134 b(The)67 b(one-line)e(function)-300
1561 y Ff(flatten)45 b Fm(uses)f(e)n(xactly)e(the)h(same)i(combinators)
d Ff(everywhere)j Fm(and)e Ff(mkT)-300 1727 y Fm(as)d(before)g(to)f
(\223lift\224)g Ff(flatD)i Fm(into)e(a)h(function)e(that)h(is)h
(applied)f(e)l(v)n(erywhere)-300 1893 y(in)e(the)g(tree.)-300
2125 y(Furthermore,)53 b(if)d(the)h(data)f(types)g(change)h(\226)f(for)
g(e)n(xample,)55 b(a)c(ne)l(w)f(form)-300 2291 y(of)36
b Ff(SubUnit)i Fm(is)f(added)f(\226)h(then)f(the)g(per)m(-data-type)g
(boilerplate)e(code)j(must)-300 2457 y(be)59 b(re-generated,)64
b(b)m(ut)57 b(the)i(code)g(for)e Ff(increase)k Fm(and)d
Ff(flatten)i Fm(is)f(un-)-300 2623 y(changed.)68 b(Of)44
b(course,)i(if)e(the)g(number)g(of)g(\002elds)g(in)g(a)g
Ff(Dept)i Fm(or)e Ff(SubUnit)-300 2790 y Fm(changed,)67
b(then)60 b Ff(flatD)h Fm(w)o(ould)e(ha)m(v)n(e)i(to)f(change)h(too,)k
(because)d Ff(flatD)-300 2956 y Fm(mentions)34 b(the)g
Ff(DU)i Fm(and)e Ff(D)h Fm(constructors)f(e)n(xplicitly)-10
b(.)43 b(But)34 b(that)g(is)g(not)g(unrea-)-300 3122
y(sonable;)j(if)f(a)i Ff(Dept)p Fm(')-8 b(s)38 b(units)e(were)i(split)e
(into)g(tw)o(o)g(lists,)h(say)-10 b(,)38 b(one)g(for)e(peo-)-300
3288 y(ple)48 b(and)g(one)f(for)h(sub-departments,)i(the)d(algorithm)g
(really)g(w)o(ould)f(ha)m(v)n(e)-300 3454 y(to)37 b(change.)-300
3889 y Fe(3.5)183 b(Summary)-300 4123 y Fm(W)-12 b(e)55
b(ha)m(v)n(e)e(no)l(w)h(completed)g(an)g(initial)e(description)g(of)h
(our)h(ne)l(w)g(design)-300 4289 y(pattern.)49 b(T)-12
b(o)39 b(summarise,)h(an)e(application)f(is)h(b)m(uilt)f(from)h(three)h
(chunks)f(of)-300 4455 y(code:)-300 4651 y Fl(Pr)m(ogrammer)-6
b(-written:)85 b Fm(a)41 b(short)f(piece)h(of)f(code)h(for)f(the)g
(particular)f(ap-)32 4817 y(plication.)j(This)28 b(typically)f
(consists)g(of)h(\(a\))h(a)g(code)f(snippet)g(to)f(do)h(the)32
4983 y(real)34 b(w)o(ork)e(\(e.g.,)j Ff(incS)p Fm(\))f(and)f(\(b\))g
(the)g(application)e(of)i(some)h(strate)n(gy)32 5149
y(combinators)53 b(that)g(lift)g(that)g(function)f(to)h(the)h(full)e
(data)i(type,)k(and)32 5315 y(specify)37 b(the)g(tra)m(v)n(ersal)g
(scheme.)-300 5531 y Fl(Mechanically-generated:)82 b
Fm(for)42 b(each)g(data)g(type,)h(tw)o(o)d Ff(instance)k
Fm(dec-)32 5697 y(larations,)34 b(one)h(for)e(class)i
Ff(Typeable)i Fm(and)d(one)g(for)g(class)h Ff(Term)p
Fm(.)47 b(The)32 5863 y(former)33 b(requires)f(a)h(\002x)n(ed)f(amount)
g(of)h(code)g(per)f(data)h(type)f(\(see)h(Sec-)32 6029
y(tion)47 b(8\).)79 b(The)48 b(latter)g(requires)f(one)i(line)e(of)h
(code)g(per)g(constructor)-6 b(,)32 6195 y(as)45 b(we)f(ha)m(v)n(e)g
(seen.)68 b(Because)45 b(the)f(tw)o(o)f(kinds)g(of)h
Ff(instance)i Fm(decla-)32 6361 y(rations)h(tak)o(e)g(a)h(v)n(ery)f
(simple,)j(re)n(gular)d(form,)j(the)n(y)d(can)h(readily)f(be)32
6527 y(generated)37 b(mechanically)-10 b(.)-300 6743
y Fl(Library:)82 b Fm(a)106 b(\002x)n(ed)e(library)g(of)h(combinators,)
121 b(such)105 b(as)h Ff(mkT)f Fm(and)32 6909 y Ff(everywhere)p
Fm(.)49 b(The)37 b(programmer)f(can)h(readily)f(e)n(xtend)g(this)g
(library)32 7075 y(with)g(ne)l(w)i(forms)f(of)g(tra)m(v)n(ersal.)-300
7270 y(One)e(w)o(ay)g(to)g(generate)g(the)g Ff(instance)i
Fm(declarations)e(is)g(to)g(use)g(the)g(DrIFT)-300 7436
y(pre-processor)55 b([38)o(].)102 b(Furthermore,)60 b(deri)l(v)l(able)
55 b(type)g(classes)i([11)o(])f(\(al-)-300 7602 y(most\))43
b(can)h(do)f(the)h(job,)h(or)e(T)-10 b(emplate)43 b(Hask)o(ell)g([30)o
(].)66 b(The)44 b(softw)o(are)f(dis-)-300 7768 y(trib)m(ution)i(that)h
(comes)j(with)d(the)i(paper)f(includes)g(a)h(customised)f(v)n(ersion)
-300 7934 y(of)30 b(DrIFT)-11 b(.)30 b(Ho)l(we)l(v)n(er)-6
b(,)32 b(mechanical)f(support)e(is)h(not)f(absolutely)g(necessary:)-300
8100 y(writing)34 b(this)h(boilerplate)f(code)i(by)f(hand)h(is)g(not)f
(onerous)g(and)h(it)f(still)f(pays)-300 8266 y(of)l(f)j(because)h(it)f
(is)g(a)g(one-of)l(f)g(task.)-300 8499 y(The)30 b(rest)f(of)g(the)g
(paper)h(consists)f(of)g(an)g(elaboration)f(and)i(generalisation)e(of)
-300 8665 y(the)37 b(ideas)h(we)g(ha)m(v)n(e)f(presented.)47
b(The)38 b(e)n(xamples)g(we)g(ha)m(v)n(e)f(seen)h(so)g(f)o(ar)f(are)
-300 8831 y(all)g(generic)h Fi(tr)n(ansformations)d Fm(that)i(tak)o(e)g
(a)i Ff(Company)g Fm(and)f(produce)f(a)i(ne)l(w)-300
8997 y Ff(Company)p Fm(.)89 b(It)50 b(turns)f(out)h(that)g(tw)o(o)f
(other)h(forms)h(of)f(generic)h(algorithms)-300 9163
y(are)h(important:)73 b(generic)52 b Fi(queries)g Fm(\(Section)e(4\))i
(and)f Fi(monadic)g(tr)n(ansfor)m(-)-300 9329 y(mations)i
Fm(\(Section)h(5\).)98 b(After)54 b(introducing)e(these)j(forms,)k(we)c
(pause)g(to)-300 9495 y(re\003ect)40 b(and)g(generalise)g(on)f(the)g
(ideas)h(\(Section)f(6\),)i(before)e(sho)l(wing)g(that)-300
9661 y(the)46 b(three)g(forms)g(of)g(algorithm)e(can)j(all)f(be)g(re)n
(g)o(arded)g(as)h(a)g(form)e(of)h(fold)-300 9827 y(operation)36
b(\(Section)h(7\).)46 b(Lastly)-10 b(,)38 b(we)g(return)e(to)h(the)g
(type-safe)g(cast)h(opera-)-300 9993 y(tor)e(in)h(Section)g(8.)p
-300 10457 1601 7 v -97 10580 a Fk(3)-31 10634 y Ff(concatMap)78
b(::)f(\(a->[b]\))h(->)e([a])h(->)g([b])62 b Fm(maps)h(a)f(function)
-300 10800 y(o)n(v)n(er)36 b(a)i(list)e(and)h(concatenates)h(the)f
(results.)4098 166 y Fn(4)199 b(Queries)4098 400 y Fm(Thus)41
b(f)o(ar)f(we)h(ha)m(v)n(e)g(concentrated)f(on)g(generic)h
Fi(tr)n(ansformations)p Fm(.)54 b(W)-12 b(e)41 b(re-)4098
566 y(call)c(the)g(corresponding)e(type)i(scheme:)5108
761 y Ff(forall)78 b(a.)e(Term)h(a)g(=>)f(a)h(->)g(a)4098
956 y Fm(There)38 b(is)e(a)i(second)f(interesting)e(class)j(of)e
(generic)h(programs)g(that)f(we)h(call)4098 1122 y Fi(g)o(eneric)g
(queries)p Fm(.)47 b(A)37 b(generic)g(query)g(has)g(a)h(type)f(of)g
(the)f(follo)l(wing)f(form:)5108 1318 y Ff(forall)78
b(a.)e(Term)h(a)g(=>)f(a)h(->)g(R)4098 1513 y Fm(Here)41
b Ff(R)g Fm(is)f(some)i(\002x)n(ed)e(result)g(type.)56
b(F)n(or)40 b(e)n(xample,)i(suppose)e(we)h(w)o(anted)4098
1679 y(to)28 b(compute)g(the)g(salary)g(bill)f(of)h(the)g(compan)n(y;)j
(we)e(w)o(ould)d(need)j(a)g(function)4098 1845 y(of)37
b(the)g(follo)l(wing)e(type:)4250 2040 y Ff(salaryBill)79
b(::)d(Company)i(->)f(Float)4098 2235 y Fm(Here)38 b
Ff(Float)g Fm(is)f(the)g(\002x)n(ed)g(result)g(type)f
Ff(R)p Fm(.)4098 2503 y Fe(4.1)183 b(Implementing)44
b(queries)4098 2737 y Fm(Our)31 b(general)h(approach)g(is)g(e)n(xactly)
f(the)h(same)h(as)g(before:)42 b(we)33 b(use)f(type)f(e)n(x-)4098
2903 y(tension)h(to)h(lift)e(the)i(interesting)e(part)i(of)g(the)f
(function)g(into)g(a)h(polymorphic)4098 3069 y(function;)43
b(for)g(each)g(data)g(types)g(we)g(gi)l(v)n(e)f(a)h(single)f(o)n(v)n
(erloaded)g(tra)m(v)n(ersal)4098 3235 y(function;)35
b(and)j(we)f(b)m(uild)f Ff(salaryBill)k Fm(from)d(these)h(tw)o(o)e
(pieces.)47 b(Here)38 b(is)4098 3401 y(the)f(code,)h(which)e(looks)h(v)
n(ery)f(similar)h(to)f(that)h(for)g Ff(increase)p Fm(:)4250
3596 y Ff(salaryBill)79 b(::)d(Company)i(->)f(Float)4250
3762 y(salaryBill)i(=)d(everything)j(\(+\))d(\(0)h(`mkQ`)g(billS\))4250
4000 y(billS)h(::)e(Salary)i(->)e(Float)4250 4166 y(billS)i(\(S)e(f\))h
(=)f(f)4098 4404 y Fm(The)45 b(interesting)d(part)i(of)f
Ff(salaryBill)k Fm(is)d(the)g(function)e Ff(billS)k Fm(that)d(ap-)4098
4570 y(plies)j(to)h(a)g Ff(Salary)p Fm(.)78 b(T)-12 b(o)47
b(lift)e Ff(billS)j Fm(to)f(arbitrary)e(types,)50 b(we)d(use)h
Ff(mkQ)p Fm(,)g(a)4098 4736 y(cousin)37 b(of)f Ff(mkT)p
Fm(:)4250 4931 y Ff(mkQ)77 b(::)g(\(Typeable)h(a,)f(Typeable)h(b\))4555
5097 y(=>)f(r)f(->)h(\(b)g(->)f(r\))h(->)g(a)f(->)h(r)4250
5263 y(\(r)g(`mkQ`)g(q\))g(a)f(=)h(case)g(cast)g(a)f(of)5698
5429 y(Just)i(b)152 b(->)77 b(q)f(b)5698 5595 y(Nothing)i(->)f(r)4098
5790 y Fm(That)30 b(is,)i(the)e(query)g Ff(\(r)76 b(`mkQ`)i(q\))30
b Fm(beha)m(v)n(es)h(as)g(follo)l(ws)d(when)i(applied)g(to)4098
5956 y(an)k(ar)m(gument)f Ff(a)p Fm(:)45 b(if)33 b Ff(a)p
Fm(')-8 b(s)34 b(type)f(is)g(the)h(same)h(as)f Ff(q)p
Fm(')-8 b(s)34 b(ar)m(gument)f(type,)i(use)f Ff(q)g Fm(to)4098
6122 y(interrog)o(ate)28 b(a;)j(otherwise)d(return)g(the)g(def)o(ault)g
(v)l(alue)h Ff(r)p Fm(.)44 b(T)-12 b(o)29 b(illustrate,)g(here)4098
6288 y(are)j(some)g(e)n(xamples)f(of)g(using)f Ff(mkQ)i
Fm(in)f(an)g(interacti)l(v)n(e)g(session)g(\(recall)g(that)4098
6455 y Ff(ord)38 b Fm(has)g(type)e Ff(Char)77 b(->)g(Int)p
Fm(\):)4250 6650 y Ff(Prelude>)h(\(22)f(`mkQ`)g(ord\))h('a')4250
6816 y(97)4250 6982 y(Prelude>)g(\(22)f(`mkQ`)g(ord\))h('b')4250
7148 y(98)4250 7314 y(Prelude>)g(\(22)f(`mkQ`)g(ord\))h(True)4250
7480 y(22)4098 7675 y Fm(The)35 b(ne)n(xt)e(step)i(is)f(to)g(e)n(xtend)
f(the)h Ff(Term)i Fm(class)f(with)e(a)i(function)d Ff(gmapQ)k
Fm(that)4098 7841 y(applies)h(the)g(speci\002ed)g(query)g(function)e
(and)j(mak)o(es)f(a)h(list)e(of)h(the)g(results:)4174
8036 y Ff(class)77 b(Typeable)h(a)f(=>)f(Term)i(a)e(where)4327
8202 y(gmapT)h(::)g(\(forall)g(b.)g(Term)g(b)f(=>)h(b)f(->)h(b\))g(->)f
(a)h(->)f(a)4327 8368 y(gmapQ)h(::)g(\(forall)g(b.)g(Term)g(b)f(=>)h(b)
f(->)h(r\))g(->)f(a)h(->)f([r])4098 8563 y Fm(The)38
b(instances)f(of)g Ff(gmapQ)h Fm(are)g(as)g(simple)f(as)h(those)e(for)h
Ff(gmapT)p Fm(:)4174 8758 y Ff(instance)78 b(Term)f(Employee)h(where)
4327 8924 y(gmapT)f(=)f(...)h(as)g(before)g(...)4327
9090 y(gmapQ)g(f)f(\(E)h(p)f(s\))h(=)f([f)h(p,)g(f)f(s])4174
9328 y(instance)i(Term)f(a)g(=>)f(Term)h([a])g(where)4327
9494 y(gmapT)g(=)f(...)h(as)g(before)g(...)4327 9660
y(gmapQ)g(f)f([])382 b(=)76 b([])4327 9826 y(gmapQ)h(f)f(\(x:xs\))i(=)e
([f)h(x,)g(f)f(xs])4174 10064 y(instance)i(Term)f(Bool)g(where)4327
10230 y(gmapT)g(x)f(=)h(...)g(as)f(before)i(...)4327
10396 y(gmapQ)f(x)f(=)h([])4098 10634 y Fm(Just)35 b(as)g(with)f
Ff(gmapT)p Fm(,)j(notice)d(that)g(there)h(is)g(no)g(recursion)f(in)-6
b(v)m(olv)n(ed)33 b(\(it)h(is)h(a)4098 10800 y(one-layer)i(operator\),)
f(and)h(that)g(the)g(function)e(has)j(a)f(rank-2)g(type.)p
eop
%%Page: 5 5
5 4 bop -300 166 a Fm(No)l(w)48 b(we)h(can)f(use)h Ff(gmapQ)g
Fm(to)f(b)m(uild)e(the)i Ff(everything)j Fm(combinator)c(that)-300
332 y(performs)35 b(the)g(recursi)l(v)n(e)g(tra)m(v)n(ersal.)45
b(Lik)o(e)35 b(an)n(y)g(fold,)g(it)g(needs)h(an)f(operator)-300
498 y Ff(k)j Fm(to)e(combine)h(results)g(from)g(dif)l(ferent)f
(sub-trees:)-148 693 y Ff(--)77 b(Summarise)h(all)f(nodes)g(in)g
(top-down,)h(left-to-right)-148 859 y(everything)h(::)d(Term)h(a)691
1025 y(=>)f(\(r)h(->)g(r)f(->)h(r\))691 1191 y(->)f(\(forall)i(a.)f
(Term)g(a)f(=>)h(a)f(->)h(r\))691 1357 y(->)f(a)h(->)f(r)-148
1523 y(everything)j(k)d(f)h(x)81 1689 y(=)f(foldl)i(k)e(\(f)h(x\))f
(\(gmapQ)i(\(everything)h(k)d(f\))h(x\))-300 1885 y Fm(Here)40
b(we)f(see)h(that)f Ff(everything)i Fm(processes)f(the)f(children)f(of)
h Ff(x)p Fm(,)h(gi)l(ving)e(a)-300 2051 y(list)27 b(of)h(results;)i
(and)f(then)e(combines)i(those)e(results)h(using)f(the)h(ordinary)f
(list)-300 2217 y(function)38 b Ff(foldl)p Fm(,)j(with)d(the)i
(operator)e Ff(k)i Fm(as)g(the)f(combiner)-8 b(.)53 b(The)40
b Ff(\(f)76 b(x\))40 b Fm(is)-300 2383 y(the)30 b(result)g(of)h
(applying)d(the)j(query)f(to)g Ff(x)h Fm(itself,)g(and)g(that)f(result)
g(is)g(included)-300 2549 y(in)37 b(the)g Ff(foldl)p
Fm(.)47 b(And)37 b(that)g(concludes)g(the)f(de\002nition)g(of)h
Ff(salaryBill)p Fm(.)-300 2798 y Fe(4.2)183 b(Other)45
b(queries)-300 3032 y Fm(By)58 b(changing)f(the)h(query)f(function)f
(and)i(combining)f(operator)g(we)i(can)-300 3198 y(easily)48
b(query)f(for)h(a)g(single)f(v)l(alue)i(rather)e(than)h(combining)e(v)l
(alues)i(from)-300 3364 y(all)c(nodes)g(in)f(the)h(tree.)68
b(F)n(or)44 b(e)n(xample,)i(here)f(is)f(ho)l(w)g(to)f(e)n(xtract)h(a)h
(named)-300 3530 y(department)37 b(from)g(the)g(compan)n(y)f(data)i
(structure:)-148 3725 y Ff(find)77 b(::)g(Name)g(->)g(Company)h(->)e
(Maybe)h(Dept)-148 3891 y(find)g(n)g(=)f(everything)j(orElse)e
(\(Nothing)h(`mkQ`)f(findD)h(n\))-148 4119 y(findD)g(::)e(String)i(->)e
(Dept)i(->)e(Maybe)h(Dept)-148 4285 y(findD)h(n)e(d@\(D)h(n')g(_)f(_\))
310 4452 y(|)g(n)h(==)f(n')229 b(=)77 b(Just)g(d)310
4618 y(|)f(otherwise)i(=)f(Nothing)-148 4846 y(orElse)h(::)f(Maybe)g(a)
f(->)h(Maybe)g(a)g(->)f(Maybe)i(a)-148 5012 y(x)f(`orElse`)h(y)e(=)h
(case)g(x)f(of)1148 5178 y(Just)h(_)153 b(->)76 b(x)1148
5344 y(Nothing)i(->)e(y)-300 5572 y Fm(The)57 b(use)h(of)e
Ff(foldl)i Fm(in)f Ff(everything)i Fm(means)f(that)e
Ff(find)i Fm(will)e(\002nd)g(the)-300 5738 y(leftmost,)40
b(shallo)l(west)g(department)f(with)g(the)h(speci\002ed)h(name.)56
b(It)39 b(is)h(easy)-300 5904 y(to)59 b(mak)o(e)h(v)l(ariants)f(of)g
Ff(everything)i Fm(that)e(w)o(ould)f(\002nd)h(the)g(right-most,)-300
6070 y(deepest,)35 b(or)f(whate)l(v)n(er)-8 b(.)45 b(Laziness)35
b(plays)f(a)h(role)e(here:)45 b(once)34 b(a)h(department)-300
6236 y(of)i(the)g(speci\002ed)g(name)h(has)g(been)g(found,)e(tra)m(v)n
(ersal)h(will)e(cease.)-300 6602 y Fn(5)199 b(Monadic)49
b(transf)-5 b(ormation)-300 6836 y Fm(As)33 b(well)e(as)i
(transformations)e(\(Section)g(3\))h(and)h(queries)f(\(Section)f(4\))h
(there)-300 7002 y(is)e(a)h(third)f(useful)f(form)i(of)f(generic)g
(algorithm,)h(namely)g(a)g Fi(monadic)e(tr)n(ans-)-300
7168 y(formation)p Fm(.)53 b(F)n(or)40 b(e)n(xample,)h(suppose)f(we)g
(w)o(anted)g(to)f(process)i(a)g Ff(Company)-300 7334
y Fm(structure)e(discarding)g(the)g(old)h Ff(Salary)h
Fm(v)l(alues,)g(and)f(\002lling)e(in)i(ne)l(w)g(ones)-300
7500 y(by)46 b(looking)f(up)i(the)f(emplo)o(yee')-8 b(s)47
b(name)g(in)g(an)g(e)n(xternal)f(database.)76 b(That)-300
7666 y(means)31 b(there)f(is)g(input/output)c(in)-6 b(v)m(olv)n(ed,)30
b(so)g(the)f(function)g(must)h(ha)m(v)n(e)g(type)-148
7861 y Ff(lookupSalaries)80 b(::)c(Company)i(->)f(IO)f(Company)-300
8056 y Fm(This)58 b(type)f(does)i(not)e(\002t)h(the)f(scheme)j(for)d
(generic)h(transformations)f(or)-300 8222 y(queries,)35
b(so)g(we)h(ha)m(v)n(e)f(to)f(re-run)g(the)h(same)h(de)l(v)n(elopment)e
(one)h(more)g(time.)-300 8388 y(First,)45 b(we)g(need)f(a)h(function)d
Ff(mkM)j Fm(to)e(construct)g(basic)i(monadic)e(transfor)m(-)-300
8554 y(mations:)-148 8749 y Ff(mkM)77 b(::)g(\(Typeable)h(a,)f
(Typeable)h(b,)462 8915 y(Typeable)g(\(m)f(a\),)g(Typeable)g(\(m)g
(b\),)462 9081 y(Monad)g(m\))157 9247 y(=>)g(\(b)g(->)f(m)h(b\))f(->)h
(a)f(->)h(m)f(a)-148 9414 y(mkM)h(f)g(=)f(case)h(cast)g(f)g(of)615
9580 y(Just)g(g)152 b(->)77 b(g)615 9746 y(Nothing)g(->)g(return)-300
9941 y Fm(The)52 b(type)e(of)h Ff(mkM)h Fm(looks)e(some)l(what)h(scary)
-10 b(,)56 b(b)m(ut)50 b(it)g(simply)h(e)n(xplains)f(all)-300
10107 y(the)66 b(type-representation)f(constraints)g(that)g(are)j
(needed)e(for)g(type-safe)-300 10273 y(cast.)61 b(Then)43
b(we)f(need)g(to)g(e)n(xtend)f(once)i(more)f(the)g(class)g
Ff(Term)h Fm(to)f(support)-300 10439 y(monadic)37 b(tra)m(v)n(ersal:)
-148 10634 y Ff(class)78 b(Typeable)g(a)e(=>)h(Term)g(a)f(where)5
10800 y(gmapT)h(::)g(...)g(as)f(before)i(...)4403 166
y(gmapQ)f(::)g(...)g(as)f(before)i(...)4403 404 y(gmapM)f(::)g(Monad)g
(m)4860 570 y(=>)g(\(forall)g(b.)g(Term)g(b)g(=>)f(b)h(->)f(m)h(b\))
4860 736 y(->)g(a)f(->)h(m)f(a)4098 974 y Fm(The)67 b(instances)f(for)f
Ff(gmapM)i Fm(are)g(just)e(as)i(simple)f(as)h(before;)79
b(the)n(y)66 b(use)4098 1140 y(Hask)o(ell')-8 b(s)36
b Ff(do)i Fm(notation)d(for)i(monadic)g(composition:)4250
1335 y Ff(instance)78 b(Term)f(Employee)h(where)4403
1501 y(...)4403 1667 y(gmapM)f(f)g(\(E)f(p)h(s\))f(=)h(do)f(p')h(<-)g
(f)f(p)6003 1833 y(s')h(<-)g(f)f(s)6003 1999 y(return)i(\(E)e(p')h
(s'\))4250 2237 y(instance)h(Term)f(a)g(=>)f(Term)i([a])e(where)4403
2403 y(...)4403 2569 y(gmapM)h(f)g([])381 b(=)76 b(return)i([])4403
2735 y(gmapM)f(f)g(\(x:xs\))g(=)f(do)h(x')153 b(<-)77
b(f)f(x)5927 2902 y(xs')h(<-)g(f)f(xs)5927 3068 y(return)i(\(x':xs'\))
4098 3306 y Fm(No)l(w)37 b(we)h(can)g(mak)o(e)f(an)g
Ff(everywhereM)j Fm(combinator:)4250 3501 y Ff(everywhereM)79
b(::)e(\(Monad)g(m,)g(Term)g(a\))5165 3667 y(=>)g(\(forall)g(b.)g(Term)
g(b)f(=>)h(b)g(->)f(m)h(b\))5165 3833 y(->)g(a)f(->)h(m)f(a)4250
3999 y(everywhereM)j(f)d(x)h(=)f(do)h(x')g(<-)f(gmapM)h(\(everywhereM)i
(f\))e(x)5851 4165 y(f)f(x')4098 4360 y Fm(Finally)-10
b(,)37 b(we)g(can)h(write)e Ff(lookupSalaries)41 b Fm(as)d(follo)l(ws:)
4250 4555 y Ff(lookupSalaries)80 b(=)c(everywhereM)j(\(mkM)e(lookupE\))
4250 4793 y(lookupE)h(::)f(Employee)h(->)e(IO)h(Employee)4250
4959 y(lookupE)h(\(E)f(p@\(P)g(n)f(_\))h(_\))4403 5125
y(=)f(do)h({)f(s)h(<-)f(dbLookup)i(n;)f(return)g(\(E)g(p)g(s\))f(})4250
5457 y(dbLookup)i(::)f(Name)g(->)g(IO)f(Salary)4250 5623
y(--)h(Lookup)h(the)e(person)i(in)f(the)f(external)i(database)4098
5861 y Fm(The)51 b(ob)n(vious)e(question)g(is)i(this:)71
b(will)49 b(each)j(ne)l(w)f(application)e(require)h(a)4098
6027 y(ne)l(w)38 b(v)l(ariant)f(of)h Ff(gmap)p Fm(?)49
b(W)-12 b(e)39 b(discuss)e(that)g(in)h(Section)f(7.)48
b(Meanwhile,)38 b(we)4098 6193 y(content)g(ourselv)n(es)g(with)f(tw)o
(o)g(observ)l(ations.)50 b(First,)38 b Ff(gmapT)i Fm(is)e(just)g(a)h
(spe-)4098 6359 y(cial)47 b(case)i(of)e Ff(gmapM)p Fm(,)i(using)e(the)g
(identity)f(monad.)77 b(\(In)47 b(f)o(act,)j Ff(gmapQ)f
Fm(can)4098 6525 y(also)k(be)h(encoded)f(using)f Ff(gmapM)p
Fm(,)j(although)d(not)g(so)h(directly)-10 b(.\))94 b(Second,)4098
6691 y(one)44 b(might)g(w)o(onder)f(whether)g(we)i(need)g(a)g(monadic)f
(form)g(of)g Ff(gmapQ)p Fm(,)i(by)4098 6857 y(analogy)35
b(with)g Ff(gmapT)p Fm(/)p Ff(gmapM)p Fm(.)k(No,)d(we)h(do)f(not:)44
b(a)37 b(monadic)f Fi(query)g Fm(is)g(just)4098 7023
y(a)31 b(special)g(case)h(of)e(an)g(ordinary)f(query)-10
b(.)44 b(T)-12 b(o)31 b(see)h(that,)f(we)g(need)g(only)e(recog-)4098
7190 y(nise)38 b(that)g Ff(Maybe)i Fm(is)e(a)h(monad,)g(so)f(the)h
Ff(find)g Fm(operation)e(of)h(Section)g(4.2)g(is)4098
7356 y(really)f(performing)e(a)j(monadic)f(query)-10
b(.)4098 7760 y Fn(6)199 b(Re\002nements)50 b(and)f(r)l(e\003ections)
4098 7994 y Fm(Ha)m(ving)29 b(introduced)e(the)j(basics,)h(we)f(pause)g
(to)f(re\003ect)h(on)f(the)g(ideas)h(a)g(little)4098
8160 y(and)37 b(to)g(mak)o(e)g(some)h(modest)f(generalisations.)4098
8428 y Fe(6.1)183 b(An)45 b(aside)h(about)f(types)4098
8662 y Fm(It)35 b(is)h(w)o(orth)e(noticing)g(that)h(the)h(type)f(of)g
Ff(everywhere)k Fm(could)c(equi)l(v)l(alently)4098 8828
y(be)i(written)f(thus:)4250 9023 y Ff(everywhere)79 b(::)d(\(forall)i
(b.)f(Term)g(b)f(=>)h(b)f(->)h(b\))5089 9189 y(->)f(\(forall)i(a.)f
(Term)g(a)f(=>)h(a)f(->)h(a\))4098 9384 y Fm(by)52 b(mo)n(ving)f(the)h
(implicit)e Ff(forall)78 b(a)52 b Fm(inw)o(ards.)91 b(The)53
b(nice)f(thing)f(about)4098 9551 y(writing)h(it)h(this)h(w)o(ay)f(is)h
(that)g(it)f(becomes)i(clear)g(that)e Ff(everywhere)k
Fm(is)d(a)4098 9717 y(generic-transformation)35 b(transformer)-8
b(.)45 b(W)-12 b(e)38 b(might)e(e)l(v)n(en)i(write)e(this:)4250
9912 y Ff(type)77 b(GenericT)h(=)f(forall)g(a.)g(Term)g(a)f(=>)h(a)g
(->)f(a)4250 10078 y(everywhere)j(::)d(GenericT)i(->)f(GenericT)4098
10273 y Fm(The)32 b(same)g(approach)f(gi)l(v)n(es)g(a)h(more)g
(perspicuous)e(type)h(for)f Ff(everything)p Fm(:)4250
10468 y Ff(type)77 b(GenericQ)h(r)f(=)f(forall)i(a.)e(Term)h(a)g(=>)g
(a)f(->)h(r)4250 10634 y(everything)i(::)d(\(r)h(->)g(r)f(->)h(r\))5089
10800 y(->)f(GerericQ)i(r)f(->)f(GerericQ)i(r)p eop
%%Page: 6 6
6 5 bop -300 166 a Fm(From)37 b(a)h(type-theoretic)e(point)g(of)h(vie)l
(w)-10 b(,)38 b(these)f(type)g(signatures)g(are)h(iden-)-300
332 y(tical)56 b(to)h(the)g(original)e(ones,)62 b(and)57
b(GHC)g(supports)e(such)i(isomorphisms)-300 498 y(directly)-10
b(.)113 b(In)59 b(particular)-6 b(,)64 b(GHC)59 b(allo)l(ws)h(a)g
Ff(forall)h Fm(in)e Ff(type)h Fm(synon)n(ym)-300 664
y(declarations)46 b(\(such)g(as)h Ff(GenericT)p Fm(\))h(and)e(allo)l
(ws)g(a)h Ff(forall)h Fm(to)e(the)g(right)-300 830 y(of)c(a)h(function)
d(arro)l(w)i(\(which)f(happens)i(when)f(the)g(type)f(synon)n(ym)g(is)h
(e)n(x-)-300 996 y(panded\).)-300 1277 y Fe(6.2)183 b(Richer)45
b(tra)-5 b(v)n(ersals)-300 1511 y Fm(Sometimes)59 b(we)f(need)g(to)g
(combine)g(generic)g(queries)g(and)g(transforma-)-300
1677 y(tions.)104 b(F)n(or)56 b(e)n(xample,)62 b(suppose)57
b(we)g(w)o(ant)e(to)i(increase)g(the)f(salaries)i(of)-300
1843 y(e)l(v)n(eryone)33 b(in)g(a)h(named)g(department,)g(lea)m(ving)e
(e)l(v)n(eryone)i(else')-8 b(s)33 b(salary)h(un-)-300
2009 y(changed.)57 b(The)41 b(main)g(function)e(is)h(a)i(generic)e
(transformation,)g Ff(incrOne)p Fm(,)-300 2175 y(b)m(ut)c(it)h(uses)g
(the)g(services)h(of)f(a)h(generic)f(query)f Ff(isDept)p
Fm(:)-148 2370 y Ff(incrOne)78 b(::)f(Name)g(->)f(Float)i(->)e
(GenericT)-148 2536 y(incrOne)i(n)f(k)f(a)157 2702 y(|)h(isDept)g(n)g
(a)f(=)g(increase)i(k)f(a)157 2868 y(|)g(otherwise)154
b(=)76 b(gmapT)i(\(incrOne)g(d)e(k\))h(a)-148 3112 y(isDept)h(::)f
(Name)g(->)f(GenericQ)i(Bool)-148 3278 y(isDept)g(n)e(=)h(False)g
(`mkQ`)g(isDeptD)h(n)-148 3523 y(isDeptD)g(::)f(Name)g(->)f(Dept)i(->)e
(Bool)-148 3689 y(isDeptD)i(n)f(\(D)f(n')h(_)f(_\))h(=)f(n==n')-300
3933 y(incrOne)39 b Fm(\002rst)d(tests)h(its)f(ar)m(gument)h(to)f(see)i
(whether)e(it)g(is)h(the)g(tar)m(geted)f(de-)-300 4099
y(partment)g(b)m(ut,)h(because)h Ff(incrOne)h Fm(is)e(a)h
Fi(g)o(eneric)e Fm(transformation,)g(it)g(must)-300 4265
y(use)g(a)h(generic)f(query)-10 b(,)36 b Ff(isDept)h
Fm(to)f(mak)o(e)g(the)g(test.)45 b(The)37 b(latter)e(is)h(b)m(uilt)e
(just)-300 4431 y(as)h(before)g(using)e Ff(mkQ)p Fm(.)j(Returning)c(to)
i Ff(incrOne)p Fm(,)j(if)d(the)h(test)f(returns)g Ff(True)p
Fm(,)-300 4597 y(we)44 b(call)f Ff(increase)j Fm(\(from)d(Section)f
(3\))i(on)f(the)g(department)2967 4543 y Fk(4)3033 4597
y Fm(;)j(otherwise)-300 4763 y(we)38 b(apply)e Ff(incrOne)j
Fm(recursi)l(v)n(ely)d(to)h(the)g(children.)-300 4995
y(In)78 b(this)f(case)j(we)e(did)f(not)h(use)g(one)g(of)g(our)g(tra)m
(v)n(ersal)f(combinators)-300 5161 y(\()p Ff(everything)p
Fm(,)64 b Ff(everywhere)p Fm(,)h(etc.\))106 b(to)56 b(do)g(the)h(job;)
66 b(it)56 b(turned)g(out)g(to)-300 5327 y(be)g(more)g(con)-6
b(v)n(enient)55 b(to)g(write)g(the)h(recursion)f(e)n(xplicitly)-10
b(.)100 b(This)56 b(is)f(yet)-300 5493 y(another)45 b(e)n(xample)h(of)f
(the)g(bene\002t)h(of)f(k)o(eeping)f(the)i(recursion)e(out)h(of)g(the)
-300 5660 y(de\002nition)35 b(of)i(the)g Ff(gmap)h Fm(functions.)-300
5940 y Fe(6.3)183 b(Identifying)44 b(the)h(inter)m(esting)g(cases)-300
6174 y Fm(Our)i(generic)g(programming)g(technique)f(encourages)i
(\002ne)g(type)f(distinc-)-300 6340 y(tions)e(via)i(algebraic)f(data)h
(types)f(as)i(opposed)d(to)i(anon)n(ymous)e(sums)i(and)-300
6506 y(products.)d(The)33 b(speci\002c)g(data)g(types)f(usually)f(serv)
n(e)i(for)f(the)g(identi\002cation)-300 6672 y(of)38
b(interesting)e(cases)j(in)e(a)i(generic)e(algorithm.)47
b(F)n(or)38 b(e)n(xample,)g(we)h(used)f(a)-300 6838 y(separate)g(data)f
(type)g(for)g Ff(Salary)p Fm(:)-148 7034 y Ff(data)77
b(Salary)h(=)e(S)h(Float)-300 7229 y Fm(If)47 b(we)h(had)g(instead)f
(used)h(an)g(ordinary)e Ff(Float)j Fm(instead)e(of)g
Ff(Salary)p Fm(,)52 b(and)-300 7395 y(if)39 b(the)f Ff(Person)j
Fm(type)d(also)h(included)f(a)i Ff(Float)g Fm(\(the)f(person')-8
b(s)38 b(height,)g(per)m(-)-300 7561 y(haps\))31 b(the)f
Ff(increase)j Fm(of)e(Section)f(3)h(might)f(end)g(up)h(increasing)f(e)l
(v)n(eryones)-300 7727 y(height)36 b(as)i(well)e(as)i(their)f(salary!)
-300 7959 y(If)46 b(this)g(happens,)j(one)e(solution)d(is)j(to)f(add)g
(more)h(type)f(distinctions,)h(i.e.,)-300 8125 y(declarations)61
b(of)h(datatypes)g(and)g(ne)l(wtypes)g(as)h(opposed)e(to)h(type)g(syn-)
-300 8291 y(on)n(yms.)115 b(Another)58 b(is)i(simply)f(to)h(include)f
(some)i(more)f(conte)n(xt)f(to)g(the)-300 8457 y(program)46
b(in)g(terms)h(of)g(the)f(intercepted)g(patterns.)74
b(Thus,)50 b(instead)c(of)g(us-)-300 8623 y(ing)55 b
Ff(mkT)i Fm(to)f(b)m(uild)e(special)i(case)i(for)d Ff(Float)p
Fm(,)63 b(b)m(uild)54 b(a)j(special)f(case)i(for)-300
8789 y Ff(Employee)p Fm(:)-148 8985 y Ff(increase)78
b(k)f(=)f(everywhere)j(\(mkT)e(\(incE)g(k\)\))-148 9229
y(incE)g(::)g(Float)g(->)g(Employee)h(->)f(Employee)-148
9395 y(incS)g(k)g(\(E)g(p)f(s\))h(=)f(E)g(p)h(\(s)g(*)f(\(1+k\)\))-300
9639 y Fm(There)33 b(is)f(a)h(dual)f(problem,)h(which)e(is)i
(persuading)e(the)h(tra)m(v)n(ersal)g(functions)-300
9805 y(to)d Fi(stop)p Fm(.)43 b(The)30 b(programmer)g(might)e(w)o(ant)h
(to)g(cut)h(of)l(f)f(tra)m(v)n(ersal)g(e)n(xplicitly)e(at)-300
9971 y(certain)j(kinds)g(of)g(nodes.)45 b(In)30 b(the)g(case)i(of)f(a)g
(transformation,)f(such)h(cut-of)l(fs)-300 10137 y(are)38
b(useful)f(to)h(restrict)e(the)i(e)n(xtent)f(of)g(changes)h(in)g(the)f
(tree.)48 b(F)n(or)38 b(e)n(xample,)p -300 10291 1601
7 v -97 10414 a Fk(4)-31 10468 y Fm(Actually)-10 b(,)62
b(Section)57 b(3)g(g)o(a)m(v)n(e)h(a)g(monomorphic)e(type)h(to)g
Ff(increase)p Fm(,)-300 10634 y(whereas)44 b(we)g(need)f(it)g(to)f(ha)m
(v)n(e)i(a)f(generic)h(type)e(here,)k(so)d(we)h(w)o(ould)d(ha)m(v)n(e)
-300 10800 y(to)c(generalise)g(its)f(type)h(signature.)4098
166 y(we)h(could)g(further)e(parameterise)j Ff(everywhere)h
Fm(by)e(a)g(generic)g(query)g(that)4098 332 y(returns)e
Ff(True)j Fm(if)d(the)h(tra)m(v)n(ersal)g(should)f(not)g(visit)g(the)h
(sub-tree:)4250 527 y Ff(everywhereBut)79 b(::)e(GenericQ)h(Bool)5317
693 y(->)f(GenericT)h(->)f(GenericT)4250 859 y(everywhereBut)i(q)e(f)f
(x)4403 1025 y(|)g(q)h(x)533 b(=)77 b(x)4403 1191 y(|)f(otherwise)i(=)f
(f)f(\(gmapT)i(\(everywhereBut)h(q)d(f\))h(x\))4250 1425
y(increase)h(k)f(=)f(everywhereBut)j(names)e(\(mkT)h(\(incS)f(k\)\))
4250 1659 y(names)h(::)e(GenericQ)i(Bool)4250 1825 y(names)g(=)e(False)
h(`mkQ`)h(isName)4250 2058 y(isName)g(::)f(String)g(->)g(Bool)4250
2224 y(isName)h(n)e(=)h(True)4098 2458 y Fm(Writing)31
b(such)h(\223stop)g(conditions\224)f(is)i(useful)f(not)f(only)h(to)g
(restrict)f(the)i(co)n(v-)4098 2624 y(erage)39 b(of)f(tra)m(v)n(ersal,)
h(b)m(ut)f(also)g(to)g(a)m(v)m(oid)g(\223fruitless)f(tra)m(v)n
(ersal\224.)51 b(F)n(or)38 b(e)n(xam-)4098 2790 y(ple,)45
b(the)e Ff(increase)i Fm(function)c(will)h(unnecessarily)h(tra)m(v)n
(erse)g(e)l(v)n(ery)g(char)m(-)4098 2956 y(acter)56 b(of)e(the)h
(department')-8 b(s)55 b(name,)61 b(and)55 b(also)g(of)f(each)j
(person')-8 b(s)54 b(name.)4098 3122 y(\(In)i(Hask)o(ell,)61
b(a)d Ff(String)g Fm(is)e(just)g(a)h(list)f(of)g Ff(Char)p
Fm(.\))106 b(From)57 b(the)f(point)g(of)4098 3288 y(vie)l(w)39
b(of)g(the)g(generic)g(function,)f(it)g(is)h(entirely)f(possible)g
(that)g(there)h(might)4098 3454 y(be)55 b(a)f Ff(Salary)i
Fm(b)m(uried)d(inside)h(the)g(name.)98 b(Writing)53 b(ef)l(\002cienc)n
(y-directed)4098 3620 y(stop)f(conditions)e(is)i(undoubtedly)e
(tiresome,)57 b(and)52 b(is)h(a)g(shortcoming)e(of)4098
3786 y(our)h(approach.)91 b(It)52 b(can)g(only)f(be)i(a)m(v)m(oided)e
(by)h(an)h(analysis)e(of)h(the)g(data-)4098 3952 y(type)c(structure,)j
(which)d(is)g(certainly)g(feasible,)j(b)m(ut)d(only)f(with)h(compiler)
4098 4118 y(support.)4098 4378 y Fe(6.4)183 b(Compound)44
b(type)i(extension)4098 4612 y Fm(Continuing)37 b(the)i(same)i(e)n
(xample,)g(what)f(if)f(there)h(happened)g(to)f(be)h(tw)o(o)f(or)4098
4778 y(more)30 b(uninteresting)d(types,)k(that)e(we)h(w)o(anted)f(to)g
(refrain)g(from)g(tra)m(v)n(ersing?)4098 4944 y(Then)40
b(we)g(w)o(ould)f(need)h(a)g(generic)g(query)f(that)h(returned)f
Ff(True)i Fm(for)e(an)n(y)h(of)4098 5110 y(those)h(types,)g(and)g
Ff(False)h Fm(otherwise.)57 b(Compound)39 b(type)i(e)n(xtensions)e(lik)
o(e)4098 5276 y(this)d(are)i(the)f(topic)f(of)h(this)f(section.)4098
5509 y(The)55 b(general)f(question)f(is)i(this:)79 b(gi)l(v)n(en)53
b(a)i(generic)g(query)-10 b(,)59 b(ho)l(w)54 b(can)h(we)4098
5675 y(e)n(xtend)37 b(it)f(with)g(a)i(ne)l(w)f(type-speci\002c)g(case?)
48 b(W)-12 b(e)38 b(need)g Ff(extQ)p Fm(,)g(a)g(cousin)f(of)4098
5841 y Ff(mkQ)p Fm(:)4250 6036 y Ff(extQ)77 b(::)g(\(Typeable)h(a,)f
(Typeable)h(b\))4708 6202 y(=>)e(\(a)h(->)g(r\))f(->)h(\(b)g(->)f(r\))h
(->)f(\(a)h(->)g(r\))4250 6368 y(\(q)g(`extQ`)h(f\))e(a)h(=)f(case)h
(cast)g(a)g(of)5698 6534 y(Just)h(b)152 b(->)77 b(f)f(b)5698
6700 y(Nothing)i(->)f(q)f(a)4098 6895 y Fm(W)-12 b(e)39
b(can)h(no)l(w)f(b)m(uild)e(a)i(generic)g(query)f(that)g(has)i
(arbitrarily)c(man)n(y)j(special)4098 7061 y(cases)h(simply)d(by)h
(composing)g Ff(extQ)p Fm(.)i(There)f(are)g(similar)e(type-e)n
(xtension)4098 7227 y(functions,)57 b Ff(extT)e Fm(and)f
Ff(extM)p Fm(,)h(that)e(allo)l(w)g(a)i(generic)f(transformation)e(to)
4098 7393 y(ha)m(v)n(e)37 b(an)h(arbitrary)e(number)g(of)h
(type-speci\002c)g(cases.)4098 7626 y(Here)45 b(is)g(a)g(more)g
(interesting)e(e)n(xample.)70 b(Suppose)44 b(we)i(w)o(ant)e(to)g
(generate)4098 7792 y(an)36 b(association)f(list,)h(gi)l(ving)e(the)h
(total)g(head-count)g(for)g(each)i(department:)4250 7987
y Ff(headCount)79 b(::)d(Company)i(->)f([\(Name,Int\)])4250
8153 y(headCount)i(c)d(=)g(fst)h(\(hc)g(c\))4250 8387
y(type)g(HcInfo)h(=)e(\([\(Name,Int\)],)k(Int\))4250
8620 y(hc)d(::)g(GenericQ)h(HcInfo)4098 8854 y Fm(The)39
b(main)g(generic)f(function,)g Ff(hc)p Fm(,)i(returns)d(an)i
Ff(HcInfo)p Fm(;)h(that)e(is,)h(a)g(pair)g(of)4098 9020
y(the)e(desired)h(association)f(list)f(together)h(with)f(the)i(total)e
(head)i(count)f(of)g(the)4098 9186 y(sub-tree.)71 b(\(Returning)44
b(a)i(pair)f(in)g(this)g(w)o(ay)g(is)g(just)g(the)g(standard)g(tupling)
4098 9352 y(design)40 b(pattern,)h(nothing)d(to)i(do)g(with)g(generic)g
(programming.\))55 b(First)40 b(we)4098 9518 y(de\002ne)29
b(the)g(the)g(type-speci\002c)f(cases)j(for)d(the)h(tw)o(o)e(types)i
Ff(Dept)h Fm(and)f Ff(Person)4098 9684 y Fm(of)37 b(interest:)4250
9879 y Ff(hcD)77 b(::)g(Dept)g(->)g([HcInfo])h(->)e(HcInfo)4250
10045 y(hcD)h(\(D)g(d)f(_)h(us\))g(kids)g(=)f(\(\(d,n\):l,)i(n\))4631
10211 y(where)4784 10377 y(\(l,n\))f(=)g(addResults)h(kids)4250
10611 y(hcP)f(::)g(Person)g(->)g([HcInfo])h(->)f(HcInfo)4250
10777 y(hcP)g(p)g(_)f(=)h(\([],)g(1\))p eop
%%Page: 7 7
7 6 bop -148 166 a Ff(addResults)79 b(::)d([HcInfo])i(->)f(HcInfo)-148
332 y(addResults)i(rs)d(=)h(\(concat)h(\(map)f(fst)f(rs\),)1148
498 y(sum)306 b(\(map)77 b(snd)f(rs\)\))-300 827 y Fm(Each)35
b(of)f(them)g(tak)o(es)h(a)f(list)g(of)f Ff(HcInfo)p
Fm(,)k(the)d(head-count)g(information)e(for)-300 993
y(the)47 b(child)g(nodes)h(\(irrele)l(v)l(ant)e(for)h(a)h
Ff(Person)p Fm(\),)k(and)c(the)f(node)h(itself,)h(and)-300
1159 y(b)m(uilds)h(the)i(head-count)f(information)f(for)h(the)h(node.)
90 b(F)n(or)51 b(a)h(person)g(we)-300 1325 y(return)32
b(a)i(head-count)e(of)g(1)h(and)g(an)h(empty)e(list)g(of)h
(departments;)h(while)e(for)-300 1491 y(a)39 b(department)f(we)h(add)g
(the)f(department)g(to)g(the)g(list)g(of)g(sub-departments,)-300
1657 y(plus)e(one)h(for)f(the)h(manager)g(herself.)46
b(No)l(w)37 b(we)g(can)h(combine)f(these)g(func-)-300
1823 y(tions)f(using)g(a)i(ne)l(w)g(tra)m(v)n(ersal)e(combinator)g
Ff(queryUp)p Fm(:)-148 2018 y Ff(queryUp)78 b(::)f(\(forall)g(a.)g
(Term)g(a)g(=>)f(a)h(->)f([r])h(->)g(r\))462 2184 y(->)g(GenericQ)h(r)
-148 2350 y(queryUp)g(f)f(x)f(=)g(f)h(x)f(\(gmapQ)i(\(queryUp)g(f\))e
(x\))-148 2679 y(hc)h(::)g(GenericQ)h(HcInfo)-148 2845
y(hc)f(=)f(queryUp)i(\(hcG)f(`extQ`)h(hcP)f(`extQ`)g(hcD\))-148
3173 y(hcG)g(::)g(Term)g(a)f(=>)h(a)f(->)h([HcInfo])h(->)f(HcInfo)-148
3340 y(hcG)g(node)g(kids)g(=)g(addResults)h(kids)-300
3668 y Fm(Here)44 b Ff(queryUp)i Fm(\002rst)e(deals)g(with)f(the)g
(children)g(\(via)h(the)g(call)f(to)h Ff(gmapQ)p Fm(\),)-300
3834 y(and)d(then)f(applies)g(the)g(speci\002ed)h(function)e(to)h(the)g
(node)h Ff(x)g Fm(and)f(the)h(query)-300 4000 y(results)33
b(of)g(the)g(children.)44 b(The)34 b(main)f(function,)g
Ff(hc)p Fm(,)i(calls)e Ff(queryUp)i Fm(with)e(a)-300
4166 y(function)j(formed)h(from)h(a)g(generic)f(case)i
Ff(hcG)p Fm(,)g(with)e(tw)o(o)f(type)h(e)n(xtensions)-300
4332 y(for)44 b Ff(hcP)h Fm(and)g Ff(hcD)p Fm(.)g(As)g(an)f(aside,)j
(we)e(are)g(using)f(generic)g(queries)g(with)g(a)-300
4498 y(higher)m(-order)35 b(result)i(type)f(here,)i(namely)g
Ff([r]->r)p Fm(.)-300 4948 y Fe(6.5)183 b(Strange)45
b(types)-300 5182 y Fm(Programming)54 b(languages)i(lik)o(e)e(ML)h(and)
h(Hask)o(ell)e(permit)h(rather)g(free-)-300 5348 y(wheeling)f(data)g
(type)g(de\002nitions.)97 b(Algebraic)54 b(data)h(types)f(can)h(be)g
(mu-)-300 5514 y(tually)60 b(recursi)l(v)n(e,)68 b(parameterised)62
b(\(perhaps)f(o)n(v)n(er)g(higher)m(-kinded)e(type)-300
5680 y(v)l(ariables\),)44 b(and)e(their)g(recursion)f(can)i(be)g
(non-uniform.)60 b(Here)43 b(are)g(some)-300 5846 y(typical)36
b(e)n(xamples)i(\(the)e(last)h(one)g(is)h(tak)o(en)e(from)h([3)o(]\):)
-224 6041 y Ff(data)77 b(Rose)g(a)g(=)f(MkR)h(a)f([Rose)i(a])-224
6208 y(data)f(Flip)g(a)g(b)f(=)h(Nil)f(|)h(Cons)g(a)f(\(Flip)i(b)e(a\))
-224 6536 y(data)h(E)g(v)229 b(=)76 b(Var)h(v)f(|)h(App)g(\(E)f(v\))h
(\(E)f(v\))h(|)g(Lam)f(\(E)h(\(Inc)g(v\)\))-224 6702
y(data)g(Inc)g(v)g(=)f(Zero)h(|)f(Succ)i(v)-300 7031
y Fm(F)n(or)32 b(all)h(of)f(these)h(the)g Ff(Term)g Fm(instance)g
(declaration)f(follo)l(w)f(the)i(usual)f(form.)-300 7197
y(F)n(or)37 b(e)n(xample,)g(here)h(is)f(the)g Ff(Term)h
Fm(instance)f(for)g Ff(Rose)p Fm(:)-148 7392 y Ff(instance)78
b(Term)f(a)g(=>)f(Term)i(\(Rose)f(a\))f(where)5 7558
y(gmapT)h(f)g(\(MkR)g(a)f(rs\))h(=)f(MkR)h(\(f)g(a\))f(\(f)h(rs\))5
7724 y(gmapQ)g(f)g(\(MkR)g(a)f(rs\))h(=)f([f)h(a,)g(f)f(rs])5
7890 y(gmapM)h(f)g(\(MkR)g(a)f(rs\))h(=)f(do)h(a')153
b(<-)76 b(f)h(a)1834 8056 y(rs')g(<-)f(f)h(rs)1834 8222
y(return)g(\(MkR)h(a')e(rs'\))-300 8417 y Fm(Components)44
b(of)h(algebraic)h(data)f(types)g(can)h(also)g(in)-6
b(v)m(olv)n(e)44 b(local)h(quanti-)-300 8583 y(\002ers)38
b(and)f(function)e(types.)46 b(The)37 b(former)g(do)g(not)f
(necessitate)i(an)n(y)e(speci\002c)-300 8749 y(treatment.)76
b(As)47 b(for)f(the)h(latter)-6 b(,)49 b(there)e(is)g(of)g(course)g(no)
g(e)n(xtensional)f(w)o(ay)-300 8915 y(to)35 b(tra)m(v)n(erse)h(into)f
(function)f(v)l(alues)i(unless)g(we)g(meant)h(to)e(tra)m(v)n(erse)h
(into)e(the)-300 9081 y(source)47 b(code)g(of)g(functions.)74
b(Ho)l(we)l(v)n(er)-6 b(,)50 b(encountering)45 b(functions)g(in)h(the)
-300 9247 y(course)38 b(of)g(tra)m(v)n(ersal)g(does)g(not)f(pose)h(an)n
(y)g(challenge.)49 b(W)-12 b(e)39 b(can)g(treat)f(func-)-300
9414 y(tions)e(as)i(atomic)f(data)g(types,)g(once)h(and)f(for)g(all,)g
(as)h(sho)l(wn)f(here:)-148 9609 y Ff(instance)78 b(Term)f(\(a)g(->)g
(b\))f(where)5 9775 y(gmapT)h(f)g(x)f(=)g(x)5 9941 y(gmapQ)h(f)g(x)f(=)
g([])5 10107 y(gmapM)h(f)g(x)f(=)g(return)i(x)-300 10302
y Fm(T)-12 b(ype-safe)40 b(cast)g(copes)g(with)f(all)g(these)h(strange)
f(types)g(as)h(well)f(because)i(it)-300 10468 y(is)49
b(not)f(at)h(all)g(sensiti)l(v)n(e)g(to)f(the)h(structure)f(of)h(the)g
(datatype)f(components.)-300 10634 y(The)41 b Ff(Typeable)i
Fm(instances)d(deal)h(with)e(the)i Fi(names)f Fm(of)g(the)h(datatypes,)
g(and)-300 10800 y(the)c(names)h(of)f(their)f(parameter)i(types)f(or)g
(type)f(constructors.)4098 166 y Fn(7)199 b(Generalising)51
b Fd(gmap)4098 400 y Fm(W)-12 b(e)33 b(ha)m(v)n(e)f(seen)h(three)g(dif)
l(ferent)e(maps,)j Ff(gmapT)p Fm(,)g Ff(gmapQ)p Fm(,)g(and)e
Ff(gmapM)p Fm(.)i(The)n(y)4098 566 y(clearly)e(ha)m(v)n(e)g(a)g(lot)f
(in)g(common,)j(and)e(ha)m(v)n(e)f(a)i(rich)e(algebra.)45
b(F)n(or)31 b(e)n(xample:)5418 822 y Ff(gmapT)77 b(id)166
b Fc(=)h Ff(id)4732 988 y(gmapT)77 b(f)f(.)h(gmapT)g(g)166
b Fc(=)h Ff(gmapT)77 b(\(f)f(.)h(g\))4732 1154 y(gmapQ)g(f)f(.)h(gmapT)
g(g)166 b Fc(=)h Ff(gmapQ)77 b(\(f)f(.)h(g\))4098 1412
y Fm(T)-12 b(w)o(o)49 b(ob)n(vious)f(questions)g(are)i(these:)71
b(\(a\))50 b(might)e(a)i(ne)l(w)g(application)e(re-)4098
1579 y(quire)h(a)h(ne)l(w)g(sort)f(of)g Ff(gmap)p Fm(?)85
b(\(b\))49 b(can)h(we)g(capture)f(all)g(three)h(as)g(special)4098
1745 y(cases)39 b(of)e(a)g(more)h(general)f(combinator?)4098
1977 y(So)g(f)o(ar)g(as)h(\(a\))f(is)g(concerned,)h(an)n(y)f(generic)g
(function)e(must)i(ha)m(v)n(e)h(type)5399 2233 y Ff(Term)77
b(a)f(=>)h(a)f(->)38 b Fi(F)13 b Fc(\()p Ff(a)p Fc(\))4098
2490 y Fm(for)68 b(some)g(type-le)l(v)n(el)f(function)g
Fi(F)12 b Fm(.)140 b(W)-12 b(e)69 b(restrict)e(ourselv)n(es)g(to)h
(type-)4098 2656 y(polymorphic)37 b(functions)g Fi(F)13
b Fm(;)40 b(that)e(is,)h Fi(F)52 b Fm(can)40 b(return)e(a)h(result)f
(in)-6 b(v)m(olving)36 b Ff(a)p Fm(,)4098 2822 y(b)m(ut)41
b(cannot)h(beha)m(v)n(e)h(dif)l(ferently)d(depending)h(on)h
Ff(a)p Fm(')-8 b(s)43 b(\(type\))e(v)l(alue.)62 b(Then)4098
2988 y(we)48 b(can)g(see)g(that)f Fi(F)60 b Fm(can)48
b(be)f(the)h(identity)d(function)g(\(yielding)g(a)j(generic)4098
3154 y(transformation\),)h(ignore)e Ff(a)i Fm(\(yielding)c(a)k
(query\),)h(or)e(return)f(some)i(com-)4098 3320 y(pound)54
b(type)i(in)-6 b(v)m(olving)52 b Ff(a)p Fm(.)103 b(In)55
b(the)h(latter)e(case,)62 b(we)57 b(vie)l(w)e Fi(F)13
b Fc(\()p Ff(a)p Fc(\))56 b Fm(as)g(the)4098 3486 y(application)f(of)h
(a)i(parameterised)f(type)f(constructor)-8 b(.)104 b(W)-12
b(e)57 b(co)n(v)n(ered)f(the)4098 3652 y(case)35 b(of)d(a)i(monad)f
(via)g Ff(gmapM)h Fm(b)m(ut)f(we)g(lack)h(co)n(v)n(erage)f(for)f(other)
h(type)f(con-)4098 3818 y(structors.)45 b(So)38 b(indeed,)f(a)g
(generic)h(function)d(with)h(a)i(type)e(of)h(the)g(form)5337
4013 y Ff(Term)77 b(a)f(=>)h(a)f(->)h(\(a,a\))4098 4208
y Fm(is)37 b(not)f(e)n(xpressible)h(by)g(an)n(y)g(of)f(our)h
Ff(gmap)h Fm(functions.)4098 4441 y(But)k(all)g(is)h(not)f(lost:)56
b(the)42 b(answer)h(to)g(question)e(\(b\))h(is)h(\223yes\224.)64
b(It)42 b(turns)g(out)4098 4607 y(that)e(all)g(the)g(generic)h(maps)g
(we)g(ha)m(v)n(e)f(seen)i(are)f(just)e(special)i(instances)g(of)4098
4773 y(a)g(more)g(fundamental)f(scheme,)j(namely)d(a)h(fold)f(o)n(v)n
(er)f(constructor)g(appli-)4098 4939 y(cations.)63 b(At)43
b(one)g(le)l(v)n(el)f(this)g(comes)i(as)g(no)e(surprise:)57
b(from)42 b(dealing)g(with)4098 5105 y(folds)52 b(for)h(lists)f(and)h
(more)g(arbitrary)f(datatypes)h([22)o(],)k(it)c(is)g(kno)l(wn)f(that)
4098 5271 y(mapping)45 b(can)i(be)f(re)n(g)o(arded)g(as)h(a)g(form)f
(of)f(folding.)72 b(Ho)l(we)l(v)n(er)-6 b(,)48 b Fi(it)e(is)g(ab-)4098
5437 y(solutely)37 b(not)f(str)n(aightforwar)-6 b(d)35
b(to)i(g)o(ener)n(alise)g(the)g(map-is-a-fold)e(idea)i(to)4098
5603 y(the)g(g)o(eneric)f(setting)p Fm(,)g(because)i(one)f(usually)f(e)
n(xpresses)h(map)h(as)f(a)h(fold)e(by)4098 5769 y(instantiating)e(the)j
(fold')-8 b(s)36 b(ar)m(guments)h(in)g(a)h(data-type-speci\002c)e(w)o
(ay)-10 b(.)4098 6002 y(In)57 b(this)g(section)g(we)h(sho)l(w)g(that)f
(by)g(writing)e(fold)i(in)g(a)h(rather)g(cunning)4098
6168 y(w)o(ay)g(it)g(is)g(ne)l(v)n(ertheless)h(possible)e(to)h(e)n
(xpress)h(v)l(arious)f(maps)h(in)f(terms)4098 6334 y(of)48
b(a)h(single)f(fold)f(in)h(a)i(generic)e(setting.)79
b(Before)49 b(di)l(ving)e(in,)k(we)e(remark)4098 6500
y(that)39 b(this)f(section)h(need)g(not)g(concern)g(the)g(application)f
(programmer:)50 b(our)4098 6666 y(three)39 b Ff(gmap)p
Fm(s)i(ha)m(v)n(e)f(been)g(carefully)f(chosen)g(to)g(match)h(a)h(v)n
(ery)e(lar)m(ge)g(class)4098 6832 y(of)e(applications)e(directly)-10
b(.)4098 7081 y Fe(7.1)183 b(The)45 b(generic)h(f)-5
b(old)4098 7315 y Fm(W)-12 b(e)50 b(re)l(vise)f(the)f(class)i
Ff(Term)g Fm(for)e(the)h(last)f(time,)53 b(adding)47
b(a)j(ne)l(w)f(operator)4098 7481 y Ff(gfoldl)p Fm(.)84
b(W)-12 b(e)49 b(will)f(be)i(able)f(to)f(de\002ne)i(all)f(three)g
Ff(gmap)h Fm(operators)e(using)4098 7647 y Ff(gfoldl)34
b Fm(b)m(ut)d(we)i(choose)g(to)f(lea)m(v)n(e)g(them)h(as)g(methods)f
(of)g(the)g(class.)45 b(Doing)4098 7813 y(so)53 b(means)h(that)e(when)h
(gi)l(ving)e(an)i(instance)g(for)f Ff(Term)i Fm(the)e(programmer)4098
7979 y(may)-10 b(,)66 b(if)59 b(she)h(wishes,)66 b(de\002ne)60
b Ff(gmapT)h Fm(etc.)f(directly)-10 b(,)65 b(as)60 b(we)g(ha)m(v)n(e)f
(done)4098 8145 y(earlier)37 b(in)g(the)g(paper)-8 b(.)4174
8340 y Ff(class)77 b(Typeable)h(a)f(=>)f(Term)i(a)152
b(where)4250 8506 y(gmapT)78 b(::)e(\(forall)i(b.)f(Term)g(b)f(=>)h(b)f
(->)h(b\))g(->)f(a)h(->)f(a)4250 8672 y(gmapQ)i(::)e(\(forall)i(b.)f
(Term)g(b)f(=>)h(b)f(->)h(r\))g(->)f(a)h(->)f([r])4250
8839 y(gmapM)i(::)e(Monad)i(m)4708 9005 y(=>)e(\(forall)i(b.)f(Term)g
(b)f(=>)h(b)f(->)h(m)f(b\))h(->)g(a)f(->)h(m)f(a)4250
9224 y(gfoldl)i(::)f(\(forall)g(a)g(b.)f(Term)h(a)g(=>)f(w)h(\(a)g(->)f
(b\))6537 9390 y(->)g(a)h(->)g(w)f(b\))4784 9556 y(->)h(\(forall)g(g.)g
(g)f(->)h(w)f(g\))4784 9722 y(->)h(a)f(->)h(w)f(a)4098
9941 y Fm(T)-5 b(rying)41 b(to)h(understand)g(the)g(type)g(of)h
Ff(gfoldl)h Fm(directly)d(can)i(lead)g(to)f(brain)4098
10107 y(damage.)53 b(It)38 b(is)h(easier)h(to)e(see)i(what)f(the)g
(instances)g(look)e(lik)o(e.)51 b(Here)40 b(is)e(the)4098
10273 y(instance)f(for)g(the)g(types)f Ff(Employee)k
Fm(and)d Ff(SubUnit)p Fm(:)4250 10468 y Ff(instance)78
b(Term)f(SubUnit)h(where)4403 10634 y(gfoldl)f(k)g(z)f(\(PU)h(p\))g(=)f
(z)h(PU)f(`k`)h(p)4403 10800 y(gfoldl)g(k)g(z)f(\(DU)h(d\))g(=)f(z)h
(DU)f(`k`)h(d)p eop
%%Page: 8 8
8 7 bop -148 166 a Ff(instance)78 b(Term)f(Employee)h(where)5
332 y(gfoldl)f(k)g(z)f(\(E)h(p)f(s\))h(=)f(\(z)h(E)f(`k`)h(p\))g(`k`)g
(s)-300 552 y Fm(Notice)45 b(that)g Fi(the)g(constructor)g(itself)66
b Fm(\()p Ff(E)p Fm(,)47 b(or)e Ff(PU)h Fm(etc.\))72
b(is)45 b(passed)h(to)f(the)h Ff(z)-300 718 y Fm(function)29
b(as)i(a)f(base)h(case;)j(this)29 b(is)h(the)h(k)o(e)n(y)e(dif)l
(ference)i(from)f(a)g(v)l(anilla)g(fold,)-300 884 y(and)45
b(is)f(essential)h(to)f(generic)h(de\002nitions)e(of)h
Ff(gmapT)i Fm(etc.)g(using)d Ff(gfoldl)p Fm(.)-300 1050
y(In)37 b(particular:)935 1292 y Ff(gfoldl)78 b(\($\))f(id)e
Fi(x)109 b Fc(=)f Fi(x)-300 1533 y Fm(That)52 b(is,)j(instantiating)49
b Ff(z)k Fm(to)e(the)g(identity)f(function,)k(and)e Ff(k)g
Fm(to)f(function)-300 1699 y(application)34 b Ff(\($\))j
Fm(simply)d(reb)m(uilds)h(the)g(input)g(structure.)45
b(That)36 b(is)f(wh)o(y)h(we)-300 1865 y(chose)f(a)g(left-associati)l
(v)n(e)e(fold:)43 b(because)36 b(it)e(matches)h(the)f(left-associati)l
(v)n(e)-300 2031 y(structure)i(of)h(function)f(application.)-300
2280 y Fe(7.2)183 b(Using)45 b Fb(gfoldl)-300 2514 y
Fm(W)-12 b(e)38 b(will)e(no)l(w)h(sho)l(w)g(that)f Ff(gmapT)j
Fm(and)e(friends)g(are)g(just)g(special)g(instances)-300
2680 y(of)h Ff(gfoldl)p Fm(.)51 b(That)38 b(idea)h(is)f(f)o(amiliar)f
(from)h(the)g(w)o(orld)e(of)i(lists,)g(where)g Ff(map)-300
2846 y Fm(can)44 b(be)g(de\002ned)f(in)g(terms)h(of)f
Ff(foldr)p Fm(.)67 b(Looking)42 b(at)i(an)f(instance)h(helps)f(to)-300
3012 y(mak)o(e)38 b(the)f(point:)-148 3207 y Ff(gmapT)78
b(f)305 b(\(E)76 b(p)h(s\))f(=)h(E)f(\(f)h(p\))g(\(f)f(s\))-148
3373 y(gfoldl)i(k)e(z)h(\(E)f(p)h(s\))f(=)h(\(z)g(E)f(`k`)h(p\))f(`k`)h
(s)-300 3568 y Fm(Ho)l(w)55 b(can)h(we)f(instantiate)f
Ff(k)h Fm(and)h Ff(z)f Fm(so)g(that)g Ff(gfoldl)h Fm(will)e(beha)m(v)n
(e)h(lik)o(e)-300 3734 y Ff(gmapT)p Fm(?)e(W)-12 b(e)52
b(need)f Ff(z)h Fm(to)f(be)g(the)g(identity)e(function,)54
b(while)c Ff(k)i Fm(should)e(be)-300 3900 y(de\002ned)f(to)f(apply)f
Ff(f)i Fm(to)f(its)g(second)h(ar)m(gument,)i(and)e(then)f(apply)g(its)f
(\002rst)-300 4067 y(ar)m(gument)37 b(to)g(the)g(result:)-148
4262 y Ff(gmapT)78 b(f)e(=)h(gfoldl)g(k)f(id)462 4428
y(where)615 4594 y(k)g(c)g(x)h(=)f(c)h(\(f)f(x\))-300
4789 y Fm(Operationally)29 b(this)g(is)i(perfect,)h(b)m(ut)e(the)g
(types)g(are)i(not)d(quite)h(right.)43 b Ff(gmapT)-300
4955 y Fm(returns)38 b(a)i(v)l(alue)g(of)e(type)h Ff(a)h
Fm(while)e Ff(gfoldl)j Fm(returns)d(a)i Ff(\(w)77 b(a\))p
Fm(.)53 b(W)-12 b(e)40 b(w)o(ould)-300 5121 y(lik)o(e)k(to)h
(instantiate)f Ff(w)i Fm(to)f(the)h(identity)d(function)h(\(at)h(the)g
(type)g(le)l(v)n(el\),)j(ob-)-300 5287 y(taining)35 b(the)i(follo)l
(wing)e(specialised)i(type)g(for)g Ff(gfoldl)p Fm(:)-148
5482 y Ff(gfoldl)78 b(::)f(\(forall)g(a)g(b.)f(Term)h(a)g(=>)f(\(a)h
(->)g(b\))2139 5648 y(->)f(a)h(->)g(b\))386 5814 y(->)g(\(forall)g(g.)g
(g)f(->)h(g\))386 5980 y(->)g(a)f(->)h(a)-300 6175 y
Fm(Ho)l(we)l(v)n(er)-6 b(,)70 b(functions)62 b(at)h(the)g(type)g(le)l
(v)n(el)f(mak)o(e)i(type)f(inference)g(much)-300 6341
y(harder)-6 b(,)58 b(and)c(in)f(particular)-6 b(,)57
b(Hask)o(ell)c(does)g(not)g(ha)m(v)n(e)h(them.)96 b(The)54
b(solu-)-300 6507 y(tion)48 b(is)h(to)g(instantiate)f
Ff(w)h Fm(to)g(the)g(type)g(constructor)f Ff(ID)i Fm(accompanied)g(by)
-300 6673 y(some)38 b(wrapping)e(and)h(unwrapping:)-148
6869 y Ff(newtype)78 b(ID)f(x)f(=)h(ID)f(x)-148 7089
y(unID)h(::)g(ID)g(a)f(->)h(a)-148 7255 y(unID)g(\(ID)g(x\))g(=)f(x)
-148 7475 y(gmapT)i(f)e(x)h(=)f(unID)h(\(gfoldl)h(k)e(ID)h(x\))5
7641 y(where)157 7807 y(k)g(\(ID)g(c\))f(x)h(=)f(ID)h(\(c)f(\(f)h
(x\)\))-300 8027 y Fm(The)30 b Ff(ID)g Fm(constructor)-6
b(,)30 b(and)f(its)g(deconstructor)f Ff(unID)j Fm(are)f(operationally)d
(no-)-300 8193 y(ops,)32 b(b)m(ut)e(the)n(y)g(serv)n(e)h(to)f(tell)g
(the)h(type)f(check)o(er)h(what)g(to)f(do.)44 b(The)31
b(encoding)-300 8359 y(of)44 b Ff(gmapM)h Fm(is)f(v)n(ery)f(similar)g
(to)h(the)g(one)g(for)f Ff(gmapT)p Fm(.)j(W)-12 b(e)44
b(use)h Ff(do)f Fm(notation)-300 8525 y(instead)39 b(of)h(nested)f
(function)f(application.)53 b(The)40 b(type)f(of)g Ff(gmapM)i
Fm(does)f(not)-300 8691 y(require)j(an)n(y)h(wrapping)e(because)j(the)f
(monad)g(type)f(constructor)f(directly)-300 8857 y(serv)n(es)c(for)e
(the)h(parameter)h Ff(w)p Fm(.)47 b(That)37 b(is:)-148
9052 y Ff(gmapM)78 b(f)e(=)h(gfoldl)g(k)f(return)5 9218
y(where)157 9384 y(k)h(c)f(x)h(=)f(do)h(c')f(<-)h(c)996
9551 y(x')f(<-)h(f)f(x)996 9717 y(return)h(\(c')g(x'\))-300
9912 y Fm(The)56 b(last)g(one,)k Ff(gmapQ)p Fm(,)d(is)f(a)g(little)e
(more)i(trick)n(y)e(because)j(the)e(structure)-300 10078
y(processed)h(by)f Ff(gfoldl)i Fm(is)f(left-associati)l(v)n(e,)j
(whereas)d(the)g(structure)f(of)-300 10244 y(the)37 b(list)f(returned)g
(by)h Ff(gmapQ)i Fm(is)e(right-associati)l(v)n(e.)44
b(F)n(or)37 b(e)n(xample:)-148 10439 y Ff(gmapQ)78 b(f)305
b(\(E)76 b(p)h(s\))f(=)h(f)f(p)h(:)f(\(f)h(s)f(:)h([]\))-148
10605 y(gfoldl)h(k)e(z)h(\(E)f(p)h(s\))f(=)h(\(z)g(E)f(`k`)h(p\))f(`k`)
h(s)-300 10800 y Fm(There)38 b(is)f(a)h(standard)e(w)o(ay)h(to)g(solv)n
(e)f(this,)h(using)f(higher)m(-order)f(functions:)4250
166 y Ff(gmapQ)78 b(f)e(=)h(gfoldl)g(k)f(\(const)i(id\))f([])4403
332 y(where)4555 498 y(k)g(c)f(x)h(rs)f(=)h(c)f(\(f)h(x)f(:)h(rs\))4098
693 y Fm(Ho)l(we)l(v)n(er)-6 b(,)58 b(ag)o(ain)c(we)g(must)g(do)f(some)
h(tiresome)g(type-wrapping)d(to)i(e)n(x-)4098 859 y(plain)36
b(to)h(the)g(type)g(inference)g(engine)g(wh)o(y)g(this)f(de\002nition)f
(is)i(OK:)4250 1054 y Ff(newtype)78 b(Q)f(r)f(a)g(=)h(Q)f(\([r]->[r]\))
4250 1220 y(unQ)h(\(Q)g(f\))g(=)f(f)4250 1455 y(gmapQ)i(f)e(x)h(=)f
(unQ)h(\(gfoldl)h(k)e(\(const)h(\(Q)g(id\)\))g(x\))g([])4403
1621 y(where)4555 1787 y(k)g(\(Q)f(c\))h(x)f(=)h(Q)f(\(\\rs)h(->)g(c)f
(\(f)h(x)f(:)h(rs\)\))4098 2021 y Fm(Notice)36 b(that)g
Ff(\(Q)76 b(r\))37 b Fm(is)g(a)g(constant)e(function)g(at)h(the)h(type)
e(le)l(v)n(el;)h(it)g(ignores)4098 2187 y(its)42 b(second)h(parameter)g
Ff(a)p Fm(.)64 b(Wh)o(y?)f(Because)43 b(a)g(query)g(returns)e(a)j(type)
e(that)4098 2353 y(is)37 b(independent)f(of)h(the)g(type)f(of)h(the)g
(ar)m(gument)g(data)h(structure.)4098 2613 y Fe(7.3)183
b(Summary)4098 2848 y Fm(W)-12 b(e)49 b(contend)e(that)h(one-layer)f
(folding)f(is)i(the)g(fundamental)f(w)o(ay)h(to)f(per)m(-)4098
3014 y(form)41 b(term)f(tra)m(v)n(ersal)h(in)f(our)g(frame)l(w)o(ork.)
57 b(This)41 b(section)f(has)h(sho)l(wn)g(that)4098 3180
y(the)i Ff(gmap)i Fm(functions)d(can)j(all)e(be)h(de\002ned)g(in)f
(terms)h(of)f(a)h(single)f(function)4098 3346 y Ff(gfoldl)p
Fm(.)68 b(Lest)45 b(the)e(in)-6 b(v)m(olv)n(ed)42 b(type-wrapping)g
(seems)j(onerous,)g(we)g(note)4098 3512 y(that)c(it)g(occurs)h
Fi(only)f Fm(in)g(the)g(de\002nitions)f(of)h(the)g Ff(gmap)i
Fm(functions)d(in)h(terms)4098 3678 y(of)52 b Ff(gfoldl)p
Fm(.)95 b(The)54 b(programmer)e(need)h(ne)l(v)n(er)g(encounter)f(it.)93
b(The)53 b Ff(gmap)4098 3844 y Fm(de\002nitions)42 b(in)h(terms)h(of)f
Ff(gfoldl)i Fm(might)e(not)f(be)i(v)n(ery)f(ef)l(\002cient)h(because)
4098 4010 y(the)n(y)39 b(in)-6 b(v)m(olv)n(e)37 b(some)j(additional)d
(amount)i(of)g(higher)m(-order)e(functions.)51 b(So)4098
4176 y(the)32 b(programmer)h(or)f(the)g(implementor)g(of)g(the)g
(language)g(e)n(xtension)g(has)h(a)4098 4342 y(choice.)49
b(Either)37 b(the)h Ff(gmap)g Fm(operators)g(are)g(de\002ned)g
(directly)e(per)i(datatype,)4098 4508 y(or)60 b(the)n(y)f(are)i
(de\002ned)f(in)f(terms)i(of)e Ff(gfoldl)j Fm(once)e(and)g(for)g(all)g
(via)f(the)4098 4674 y(sho)l(wn)37 b(\223def)o(ault\224)f
(declarations.)4098 5062 y Fn(8)199 b(T)-15 b(ype-safe)50
b(cast)4098 5297 y Fm(Our)42 b(entire)f(approach)h(is)g(predicated)g
(on)g(the)g(a)m(v)l(ailability)e(of)i(a)g(type-safe)4098
5463 y(cast)50 b(operator)-6 b(,)52 b(which)d(in)g(turn)g(is)g(closely)
g(related)h(to)f(intensional)f(poly-)4098 5629 y(morphism)41
b(and)i(dynamic)f(typing.)59 b(W)-12 b(e)43 b(will)e(discuss)h(such)g
(related)g(w)o(ork)4098 5795 y(in)29 b(Section)g(9.3.)44
b(In)29 b(f)o(act,)i(it)e(is)g(well-kno)l(wn)f(folk)h(lore)g(in)g(the)g
(Hask)o(ell)g(com-)4098 5961 y(munity)40 b(that)g(much)h(of)f(the)h
(functionality)d(of)i Ff(cast)i Fm(can)f(be)g(programmed)4098
6127 y(in)55 b(standard)g(Hask)o(ell.)100 b(Strangely)-10
b(,)59 b(there)c(is)g(no)g(published)f(description)4098
6293 y(of)47 b(this)g(trick,)j(so)d(we)h(re)l(vie)l(w)g(it)f(here,)k
(gi)l(ving)46 b(an)i(encoding)f(that)g(can)h(be)4098
6459 y(re)n(g)o(arded)37 b(as)h(a)g(reference)g(implementation.)4098
6720 y Fe(8.1)183 b(The)45 b Fb(Typeable)d Fe(class)4098
6954 y Fm(The)36 b(k)o(e)n(y)e(idea)i(is)f(to)g(re\002ne)g(the)g(type)g
(class)h Ff(Typeable)p Fm(,)i(which)d(w)o(as)g(pre)l(vi-)4098
7120 y(ously)h(assumed)i(to)f(be)g(abstract,)h(as)g(follo)l(ws:)4250
7315 y Ff(class)78 b(Typeable)g(a)e(where)4403 7481 y(typeOf)h(::)g(a)f
(->)h(TypeRep)4098 7676 y Fm(The)45 b(o)n(v)n(erloaded)f(operation)f
Ff(typeOf)k Fm(tak)o(es)d(a)i(v)l(alue)f(and)g(returns)f(a)h(run-)4098
7842 y(time)31 b(representation)f(of)h(its)g(type.)44
b(Here)31 b(is)g(one)h(possible)e(implementation)4098
8008 y(of)37 b(the)g Ff(TypeRep)i Fm(type,)e(and)g(some)h(instances:)
4250 8203 y Ff(data)77 b(TypeRep)h(=)f(TR)f(String)i([TypeRep])4250
8437 y(instance)g(Typeable)g(Int)f(where)4403 8603 y(typeOf)g(x)g(=)f
(TR)h("Prelude.Int")i([])4250 8837 y(instance)f(Typeable)g(Bool)f
(where)4403 9003 y(typeOf)g(x)g(=)f(TR)h("Prelude.Bool")i([])4250
9238 y(instance)f(Typeable)g(a)f(=>)f(Typeable)i([a])f(where)4403
9404 y(typeOf)g(x)g(=)f(TR)h("Prelude.List")i([typeOf)f(\(get)f(x\)])
5089 9570 y(where)5241 9736 y(get)g(::)g([a])g(->)f(a)5241
9902 y(get)h(=)f(undefined)4250 10136 y(instance)i(\(Typeable)g(a,)f
(Typeable)h(b\))4708 10302 y(=>)e(Typeable)i(\(a->b\))g(where)4403
10468 y(typeOf)f(f)g(=)f(TR)h("Prelude.->")i([typeOf)e(\(getArg)h(f\),)
6537 10634 y(typeOf)f(\(getRes)h(f\)])5089 10800 y(where)p
eop
%%Page: 9 9
9 8 bop 843 166 a Ff(getArg)78 b(::)e(\(a->b\))i(->)e(a)843
332 y(getArg)i(=)e(undefined)843 570 y(getRes)i(::)e(\(a->b\))i(->)e(b)
843 736 y(getRes)i(=)e(undefined)-300 974 y Fm(Notice)39
b(that)g Ff(typeOf)i Fi(ne)n(ver)g(e)n(valuates)e(its)g(ar)-6
b(gument)p Fm(.)54 b(In)39 b(particular)-6 b(,)39 b(the)-300
1140 y(call)f Ff(\(get)77 b(x\))38 b Fm(in)g(the)f(list)g(instance)h
(will)e(ne)l(v)n(er)i(be)g(e)l(v)l(aluated)3027 1085
y Fk(5)3094 1140 y Fm(;)g(it)f(simply)-300 1306 y(serv)n(es)h(as)f(a)h
(proxy)-10 b(,)37 b(telling)e(the)i(compiler)g(the)g(type)g(at)g(which)
f(to)h(instanti-)-300 1472 y(ate)k(the)g(recursi)l(v)n(e)f(call)h(of)g
Ff(typeOf)p Fm(,)i(namely)e(to)f(the)h(element)g(type)f(of)g(the)-300
1638 y(list.)46 b(If)37 b(Hask)o(ell)f(had)i(e)n(xplicit)d(type)i(ar)m
(guments,)h Ff(typeOf)h Fm(could)d(dispense)-300 1804
y(with)31 b(its)g(v)l(alue)h(ar)m(gument,)i(with)c(its)i(calls)g(using)
f(type)g(application)g(alone.)3636 1750 y Fk(6)-300 2072
y Fe(8.2)183 b(De\002ning)44 b Fb(cast)g Fe(using)h Fb(typeOf)-300
2306 y Fm(T)-12 b(ype-safe)60 b(cast)g(is)g(easy)g(to)f(implement)g(gi)
l(v)n(en)g Ff(typeOf)p Fm(,)67 b(plus)59 b(a)h(small)-300
2472 y(Hask)o(ell)36 b(e)n(xtension:)-148 2667 y Ff(cast)77
b(::)g(\(Typeable)h(a,)f(Typeable)h(b\))e(=>)h(a)g(->)f(Maybe)h(b)-148
2833 y(cast)g(x)g(=)f(r)386 2999 y(where)538 3165 y(r)h(=)f(if)h
(typeOf)g(x)g(==)f(typeOf)i(\(get)f(r\))843 3331 y(then)g(Just)g
(\(unsafeCoerce)i(x\))843 3497 y(else)e(Nothing)538 3735
y(get)g(::)g(Maybe)g(a)g(->)f(a)538 3901 y(get)h(x)g(=)f(undefined)-300
4139 y Fm(Here)42 b(we)f(check)h(whether)f(the)g(ar)m(gument)g
Ff(x)h Fm(and)f(result)f Ff(r)i Fm(ha)m(v)n(e)f(the)g(same)-300
4305 y(type)47 b(representation,)i(and)e(if)g(so)g(coerce)h(the)f(one)g
(into)f(the)h(other)-8 b(.)76 b(Here,)-300 4471 y Ff(unsafeCoerce)40
b Fm(is)d(an)g(e)n(xtension)f(to)h(Hask)o(ell,)g(with)f(the)h(follo)l
(wing)e(type:)-148 4666 y Ff(unsafeCoerce)79 b(::)e(a)f(->)h(b)-300
4861 y Fm(It)33 b(is)h(easy)h(to)e(implement:)44 b(operationally)32
b(it)h(is)h(just)f(the)h(identity)e(function.)-300 5027
y(It)48 b(is,)k(of)d(course,)j(just)c(as)h(unsafe)g(as)h(its)e(name)h
(implies,)j(and)c(we)i(do)e(not)-300 5193 y(adv)m(ocate)41
b(its)f(wide-spread)g(use.)58 b(Rather)-6 b(,)41 b(we)g(re)n(g)o(ard)g
Ff(unsafeCoerce)j Fm(as)-300 5359 y(an)31 b(implementation)f(de)l(vice)
h(to)g(implement)f(a)i(safe)g(feature)f(\()p Ff(cast)p
Fm(\);)i(man)n(y)-300 5525 y(language)k(implementations)e(contain)i(a)h
(similar)e(trap-door)-8 b(.)-300 5793 y Fe(8.3)183 b(What)45
b(a)h(mess?)-300 6027 y Fm(At)41 b(this)g(point)f(the)i(reader)g(may)g
(be)g(inclined)e(to)h(thro)l(w)g(up)g(his)h(hands)f(and)-300
6193 y(declare)56 b(that)f(if)f(this)h(paper)g(requires)g
Ff(unsafeCoerce)p Fm(,)63 b(and)55 b Ff(instance)-300
6359 y Fm(declarations)38 b(with)g(magic)h(strings)e(that)h(must)h(be)g
(distinct,)e(then)i(it)e(has)j(no)-300 6525 y(place)49
b(in)f(a)h(language)g(lik)o(e)e(Hask)o(ell.)80 b(But)48
b(note)g(that)g(the)h(abo)n(v)n(e)f(scheme)-300 6691
y(is)43 b(meant)g(by)f(us)h(as)h(a)f(reference)h(implementation)d(as)i
(opposed)f(to)h(a)g(pro-)-300 6857 y(gramming)37 b(technique.)-300
7090 y(That)58 b(is,)64 b(the)58 b(compiler)f(should)g(pro)n(vide)g
(direct)g(support)g(for)h(the)f(class)-300 7256 y Ff(Typeable)p
Fm(,)e(so)49 b(that)g(its)g(instance)g(for)g(each)i(data)e(type)g(is)g
(automatically)-300 7422 y(generated)54 b(by)g(the)g(compiler)-8
b(.)97 b(The)55 b(programmer)f(does)g(not)g(instantiate)-300
7588 y(the)f(class)g(him-)f(or)h(herself.)93 b(Furthermore,)56
b Ff(cast)e Fm(should)d(be)i(pro)n(vided)-300 7754 y(as)48
b(a)f(primiti)l(v)n(e)e(\227)i(it)g(may)g(be)g Fi(implemented)j
Fm(inside)c(the)g(system)i(library)-300 7920 y(with)e(some)i(kind)d(of)
i(lo)l(w-le)l(v)n(el)f(coercion,)k(b)m(ut)c(that)g(is)h(in)-6
b(visible)45 b(to)h(\(and)-300 8086 y(inaccessible)54
b(to\))e(the)h(application)f(programmer)-8 b(.)95 b(W)-6
b(ith)52 b(this)h(de)n(gree)h(of)-300 8252 y(compiler)37
b(support,)f(the)h(system)g(is)g(indeed)g(type-safe.)-300
8485 y(So)49 b(this)f(section)g(does)h(not)f(present)h(a)g(programming)
f(technique)g(for)g(the)-300 8651 y(user)-8 b(.)123 b(Rather)-6
b(,)68 b(it)62 b(sho)l(ws)h(that)f(compiler)g(support)f(for)h
Ff(cast)h Fm(does)g(not)-300 8817 y(require)70 b(some)i(mysterious)e
(\002ddling)g(with)g(runtime)g(data)h(representa-)-300
8983 y(tions.)131 b(Instead,)73 b(some)l(what)66 b(surprisingly)-10
b(,)71 b(it)65 b(can)h(be)g(cleanly)g(imple-)-300 9149
y(mented)56 b(using)e(Hask)o(ell')-8 b(s)54 b(type-class)i(frame)l(w)o
(ork)f(with)f(some)i(readily-)-300 9315 y(generated)50
b(simple)g(instance)g(declarations.)85 b(Furthermore,)54
b(albeit)49 b(as)i(an)-300 9481 y(unsa)m(v)m(oury)56
b(stop-g)o(ap)h(measure,)64 b(it)56 b(is)i(a)f(real)h(adv)l(antage)g
(to)f(be)g(able)h(to)-300 9647 y(prototype)53 b(the)j(system)g(without)
d(requiring)g(an)n(y)j(compiler)e(support)g(e)n(x-)-300
9813 y(cept)37 b Ff(unsafeCoerce)p Fm(.)p -300 9942 1601
7 v -97 10064 a Fk(5)-31 10119 y Fm(The)h(v)l(alue)f
Ff(undefined)i Fm(has)f(type)f Ff(forall)77 b(a.a)38
b Fm(in)f(Hask)o(ell.)-97 10248 y Fk(6)-31 10302 y Fm(GHC)49
b(supports)f(scoped)h(type)g(v)l(ariables,)j(so)e(a)f(nicer)g(w)o(ay)g
(to)g(write)-300 10468 y(the)37 b(list)f(instance)h(of)g
Ff(typeOf)i Fm(is)e(this:)62 10634 y Ff(TR)77 b("Prelude.List")i
([typeOf)f(\(undefined)g(::)f(a\)])4098 166 y Fm(One)42
b(might)f(w)o(orry)f(about)i(ef)l(\002cienc)n(y)-10 b(,)44
b(because)f Ff(cast)g Fm(in)-6 b(v)m(olv)n(es)40 b(compar)m(-)4098
332 y(ing)g Ff(TypeRep)i Fm(data)f(structures.)55 b(That)41
b(cost,)h(ho)l(we)l(v)n(er)-6 b(,)42 b(is)e(not)g(fundamen-)4098
498 y(tal.)49 b(The)39 b Ff(TypeRep)h Fm(structures)e(can)h(readily)e
(be)i(hash-consed)f(\(especially)4098 664 y(if)h(there)g(is)h(direct)f
(compiler)g(support\))f(so)h(that)g(the)n(y)g(can)h(be)g(compared)g(in)
4098 830 y(constant)47 b(time.)78 b(Ag)o(ain,)51 b(this)c(is)g(the)h(b)
m(usiness)f(of)h(the)g(library)e(writer)h(\(or)4098 996
y(e)l(v)n(en)38 b(compiler)e(implementor\))g(not)g(the)h(application)f
(programmer)-8 b(.)4098 1391 y Fn(9)199 b(Alter)m(nati)n(v)n(e)52
b(appr)l(oaches)4098 1625 y Fm(Generic)33 b(programming)e(has)i(recei)l
(v)n(ed)f(a)h(great)g(deal)f(of)g(attention,)g(and)h(we)4098
1791 y(re)l(vie)l(w)40 b(the)g(w)o(ork)e(of)i(others)f(in)g(this)g
(section.)54 b(Before)40 b(we)g(do,)g(it)f(is)h(w)o(orth)4098
1957 y(mentioning)i(that)h(one)h(v)n(ery)f(brutal)g(approach)g(to)h
(generic)f(programming)4098 2123 y(lies)37 b(readily)f(to)h(hand,)g
(namely)g Fi(using)g(a)g(univer)o(sal)f(data)g(type)p
Fm(,)i(such)f(as:)4250 2318 y Ff(data)77 b(Univ)h(=)e(I)g(Int)h(|)g(S)f
(String)i(|)e(...)h(etc.)g(...)5013 2484 y(|)f(B)g(ConstrName)j([Univ])
4250 2650 y(type)e(ConstrName)i(=)d(String)4098 2845
y Fm(A)43 b(generic)f(program)g(w)o(orks)g(by)g(\(a\))g(con)-6
b(v)n(erting)41 b(\(embedding\))g(the)i(input)4098 3011
y(data)52 b(structure)f(to)g Ff(Univ)p Fm(,)57 b(\(b\))51
b(tra)m(v)n(ersing)f(the)i(uni)l(v)n(ersal)f(data)h(structure,)4098
3178 y(and)43 b(\(c\))f(con)-6 b(v)n(erting)41 b(\(projecting\))g(the)h
(result)g(back)h(to)f(the)h(original)d(type.)4098 3344
y(This)46 b(approach)g(has)h(the)f(merit)g(of)g(simplicity)-10
b(,)47 b(b)m(ut)e(it)h(is)g(inef)l(\002cient,)i(and)4098
3510 y(\(w)o(orse\))55 b(completely)h(untyped.)103 b(In)56
b(step)g(\(b\))g(there)g(is)h(no)e(static)i(check)4098
3676 y(that,)36 b(when)h(matching)e(on)h(a)h(constructor)e(named)i
Ff("Person")p Fm(,)i(the)d(correct)4098 3842 y(number)46
b(or)h(type)f(of)g(\002elds)h(are)g(matched.)75 b(There)48
b(are)f(w)o(ays)f(to)g(impro)n(v)n(e)4098 4008 y(the)30
b(type)g(safety)g(and)g(ef)l(\002cienc)n(y)h(of)e(this)h(approach;)i
(for)d(e)n(xample,)j(one)f(can)4098 4174 y(use)37 b(an)g(abstract)f
(datatype)g(for)g(generic)g(functions)f(to)h(separate)h(typed)f(and)
4098 4340 y(untyped)55 b(code)i([17)o(].)104 b(Ho)l(we)l(v)n(er)-6
b(,)62 b(we)57 b(concentrate)f(on)h(statically-typed)4098
4506 y(approaches)38 b(in)e(the)h(rest)g(of)g(this)f(section.)4098
4770 y Fe(9.1)183 b(Rank-2)45 b(types)4098 5004 y Fm(The)k(Hindle)n
(y-Milner)c(type)j(system)g(is)g(gracefully)f(balanced)i(on)e(a)i(cusp)
4098 5170 y(between)39 b(e)n(xpressi)l(v)n(eness)h(and)f(decidability)
-10 b(.)50 b(A)40 b(polymorphic)d(type)i(may)4098 5336
y(be)45 b(quanti\002ed)f(only)g(at)h(the)f(outermost)g(le)l(v)n(el)g
(\227)i(this)e(is)h(called)f(a)i Fi(r)n(ank-1)4098 5502
y(type)f Fm(\227)h(b)m(ut)f(in)g(e)n(xchange)g(a)h(type)f(inference)g
(engine)g(can)h(\002nd)f(the)g(most)4098 5668 y(general)c(type)f(for)g
(an)n(y)g(typeable)g(program,)i(without)c(the)j(aid)f(of)g(an)n(y)h
(type)4098 5834 y(annotations)35 b(whatsoe)l(v)n(er)-8
b(.)4098 6066 y(Ne)l(v)n(ertheless,)43 b(higher)m(-rank)o(ed)c(types)j
(are)g(occasionally)f(useful.)59 b(A)41 b(good)4098 6232
y(e)n(xample)35 b(is)f(the)h(type)f(of)g Ff(build)p Fm(,)j(the)d
(list-production)d(combinator)i(that)h(is)4098 6398 y(central)j(to)g
(the)g(short-cut)e(deforestation)h(technique)g([6].)46
b(Its)37 b(type)g(is:)4250 6594 y Ff(build)78 b(::)e(forall)i(a.)e
(\(forall)i(b.)f(\(a->b->b\))h(->)f(b)f(->)h(b\))5470
6760 y(->)f([a])4098 6955 y Fm(Another)27 b(e)n(xample)i(is)f
Ff(runST)p Fm(,)i(the)e(combinator)g(that)g(encapsulates)g(a)h(state-)
4098 7121 y(ful)36 b(computation)g(in)h(a)g(pure)g(function)f([19)o(]:)
4250 7316 y Ff(runST)78 b(::)e(forall)i(a.)e(\(forall)i(s.)f(ST)f(s)h
(a\))g(->)f(a)4098 7511 y Fm(It)47 b(is)g(well)g(kno)l(wn)f(that)h
(type)g(inference)g(for)g(programs)g(that)g(use)g(higher)m(-)4098
7677 y(rank)o(ed)28 b(types)h(is)g(intractable)f([16)o(].)43
b(Ne)l(v)n(ertheless,)32 b(it)c(is)h(not)f(only)f(tractable)4098
7843 y(b)m(ut)64 b(easy)h(if)e(suf)l(\002cient)h(type)g(annotations)f
(are)i(gi)l(v)n(en)e([24].)127 b(The)65 b(tw)o(o)4098
8009 y(Hask)o(ell)38 b(implementations)g(GHC)h(and)g(Hugs)g(support)f
(data)i(constructors)4098 8175 y(with)30 b(rank-2)h(types;)h(the)f
(type)g(inference)h(problem)e(is)h(easier)h(here)g(because)4098
8341 y(the)46 b(data)g(constructor)e(itself)h(acts)i(as)g(a)f(type)g
(annotation.)71 b(Ho)l(we)l(v)n(er)46 b(that)4098 8507
y(w)o(ould)e(be)h(v)n(ery)g(incon)-6 b(v)n(enient)43
b(here:)63 b Ff(gmapT)46 b Fm(is)f(not)g(a)h(data)f(constructor)-6
b(,)4098 8673 y(and)37 b(it)g(w)o(ould)e(require)i(tiresome)g
(unwrapping)e(to)h(mak)o(e)i(it)e(so.)4098 8906 y(So)53
b(in)g(f)o(act)f(GHC)h(uses)h(a)f(type)g(inference)g(algorithm)e(that)i
(permits)f(an)n(y)4098 9072 y(function)c(to)i(ha)m(v)n(e)g(a)h(type)f
(of)g(arbitrary-rank)e(type,)53 b(pro)n(vided)c(suf)l(\002cient)4098
9238 y(type)35 b(annotations)f(are)i(gi)l(v)n(en.)45
b(The)37 b(details)e(are)h(be)n(yond)e(the)i(scope)g(of)f(this)4098
9404 y(paper)-6 b(,)58 b(b)m(ut)53 b(are)i(gi)l(v)n(en)e(in)g([31)o(].)
96 b(W)-12 b(e)55 b(belie)l(v)n(e)e(that)h(the)f Ff(gmap)i
Fm(f)o(amily)e(of)4098 9570 y(functions)43 b(of)l(fers)i(further)f(e)l
(vidence)i(of)f(the)g(usefulness)f(of)h(rank-2)g(types)4098
9736 y(in)37 b(practical)f(programming.)4098 10000 y
Fe(9.2)183 b(Generic)45 b(tra)-5 b(v)n(ersal)4098 10234
y Fa(P)-13 b(olytypic)41 b(pr)-7 b(o)n(gr)n(amming)4098
10468 y Fm(The)58 b(core)f(idea)g(underlying)e(polytypic)g(programming)
h([15)o(,)i(14)o(,)g(10)o(])f(is)4098 10634 y(to)43 b(de\002ne)g(a)h
(generic)f(function)e(by)i(induction)d(on)j(the)g(structure)f(of)h(an)g
(ar)m(-)4098 10800 y(gument)48 b(type)g(or)h(the)f(result)g(type)g(of)h
(a)g(function.)79 b(Induction)47 b(is)h(usually)p eop
%%Page: 10 10
10 9 bop -300 166 a Fm(supported)31 b(by)g(a)i(corresponding)d
(language)i(e)n(xtension:)41 b(the)32 b(function)e(def-)-300
332 y(inition)35 b(has)j(cases)h(for)e(sums,)h(products,)f(and)h
(others.)47 b(This)37 b(approach)g(ini-)-300 498 y(tially)f(leads)i(to)
f Fi(pur)-6 b(ely)p Fm(-generic)38 b(functions;)d(that)i(is,)h(ones)g
(dri)l(v)n(en)e(entirely)-300 664 y(by)41 b(the)h(structure)f(of)g(the)
g(type.)60 b(Examples)42 b(include)f(serialisation)f(and)i(its)-300
830 y(in)-6 b(v)n(erse,)46 b(comparison)d(operations,)i(and)f(hashing.)
66 b(Unfortunately)-10 b(,)44 b(these)-300 996 y(are)35
b(just)e(about)h(the)g Fi(only)g Fm(purely-generic)e(operations,)i(and)
h(our)e(o)l(wn)h(vie)l(w)-300 1162 y(is)j(that)g(purely-generic)e
(programming)h(is)h(too)g(restricti)l(v)n(e)f(to)g(be)i(useful.)-300
1395 y(Thus)h(moti)l(v)l(ated,)g(customisation)e(of)h(generic)h
(programs)f(is)h(addressed)g(in)-300 1561 y(the)51 b(Generic)g(Hask)o
(ell)f(program.)88 b(In)50 b([4],)55 b(techniques)50
b(are)i(discussed)f(to)-300 1727 y(e)n(xtend)58 b(a)h(polytypic)d
(function)g(with)h(cases)j(for)e(a)h(particular)e(construc-)-300
1893 y(tor)e(or)h(a)h(type.)103 b(Generic)56 b(Hask)o(ell)g(is)g(a)g(v)
n(ery)g(substantial)f(e)n(xtension)g(to)-300 2059 y(Hask)o(ell,)36
b(whereas)h(our)f(proposal)g(is)g(much)h(more)g(lightweight)c(and)k
(better)-300 2225 y(inte)n(grated)k(with)g(ordinary)g(functional)g
(programming.)61 b(Furthermore,)44 b(in)-300 2391 y(Generic)38
b(Hask)o(ell,)g(a)h(generic)f(function)e(is)i(not)f(a)h(\002rst-class)g
(citizen.)49 b(That)-300 2557 y(is,)58 b(one)53 b(cannot)g(write)g
(generic)g(functions)f(operating)g(on)h(other)g(generic)-300
2723 y(functions,)36 b(as)i(our)e(tra)m(v)n(ersal)h(combinators)f
(\(e.g.,)i Ff(everywhere)p Fm(\))h(require.)-300 2889
y(Also,)61 b(\(run-time)54 b(and)i(nominal\))f(type-safe)h(cast)h(is)f
(alien)g(to)f(polytypic)-300 3055 y(programming.)74 b(Using)46
b(techniques)g(such)g(as)i(those)e(in)g([4],)j(one)e(can)g
Fi(en-)-300 3221 y(code)38 b Fm(tra)m(v)n(ersals)e(as)i(opposed)f(to)f
(using)g(our)h(combinator)f(style.)-300 3454 y(Deri)l(v)l(able)43
b(type)f(classes)h([11])f(is)g(another)g(e)n(xtension)g(of)g(Hask)o
(ell)g(to)g(sup-)-300 3620 y(port)c(generic)h(programming.)50
b(The)40 b(idea)f(here)g(is)g(that)f(a)i(generic)f(function)-300
3786 y(is)44 b(just)e(a)j(template)e(that)g(speci\002es)i(ho)l(w)e(to)g
(generate)h(an)g Ff(instance)i Fm(dec-)-300 3952 y(laration)52
b(for)h(the)h(generic)f(function)f(for)h(each)h(data)g(type.)95
b(It)53 b(is)g(easy)i(to)-300 4118 y(o)n(v)n(er)m(-ride)e(this)h
(template)h(for)g(speci\002c)g(types.)100 b(Ag)o(ain,)59
b(deri)l(v)l(able)c(type-)-300 4284 y(classes)37 b(are)g(oriented)d(to)
l(w)o(ards)h(structural)g(induction)f(\(not)g(nominal)h(anal-)-300
4450 y(ysis\))46 b(o)n(v)n(er)f(types;)50 b(recursion)c(is)g(b)m(uilt)e
(into)h(each)i(generic)g(function;)h(and)-300 4616 y(each)60
b(ne)l(w)f(generic)g(function)f(requires)g(a)i(ne)l(w)f(class.)113
b(Deri)l(v)l(able)59 b(type)-300 4782 y(classes)h(\(combined)d(with)h
(rank-2)f(types\))h(are)h(suf)l(\002cient)g(to)f(de\002ne)g(the)-300
4948 y Ff(gmap)f Fm(f)o(amily)d(of)i(functions)e(or)h(the)h
Ff(gfoldl)h Fm(function,)i(with)c(a)h(modest)-300 5114
y(amount)43 b(of)g(encoding.)64 b(Ho)l(we)l(v)n(er)-6
b(,)45 b(deri)l(v)l(able)e(type)g(classes)i(are)f(not)e(suit-)-300
5280 y(able)i(to)g(de\002ne)h(our)e(nominal)g(type)h(case)i(because)f
(of)f(their)f(bias)h(to)l(w)o(ards)-300 5446 y(structural)36
b(induction.)-300 5716 y Fa(Gener)n(alised)k(folds)-300
5950 y Fm(It)i(is)g(a)g(well-established)f(idea)h(that)f(maps)i(and)f
(folds)f(can)i(be)g(de\002ned)f(for)-300 6116 y(all)47
b(kinds)g(of)h(datatypes,)i(e)l(v)n(en)e(for)f(systems)h(of)g
(datatypes)f([22)o(,)i(29)o(,)f(23].)-300 6282 y(The)30
b(inherent)e(assumption)h(is)g(here)h(that)f(recursion)f(into)g
(compound)h(terms)-300 6448 y(is)48 b(performed)g Fi(by)g(the)g(fold)f
(oper)n(ation)g(itself)p Fm(.)78 b(This)48 b(sets)h(this)e(idea)h
(apart)-300 6614 y(from)42 b(our)h(simpler)f(and)h(yet)f(more)h
(general)g(approach)g(where)g(layer)m(-wise)-300 6780
y(tra)m(v)n(ersal)i(is)g(f)o(a)m(v)m(oured.)71 b(This)46
b(w)o(ay)-10 b(,)47 b(we)g(allo)l(w)e(the)g(programmer)g(to)g(wire)-300
6946 y(up)g(recursion)f(in)h(an)n(y)g(w)o(ay)f(that)h(is)g(found)f(con)
-6 b(v)n(enient.)69 b(Besides)45 b(the)g(an-)-300 7112
y(ticipated)h(recursion,)j(generalised)e(folds)f(suf)l(fer)h(from)g
(another)f(problem)-300 7278 y(articulated)39 b(in)h([18)o(]:)51
b(if)40 b(lar)m(ger)g(systems)g(of)g(datatypes)g(are)g(considered,)h
(it)-300 7444 y(is)g(impractical)f(to)h(enumerate)g(all)g(the)g
(ingredients)e(for)i(folding)d(by)j(hand.)-300 7610 y(In)51
b(ef)l(fect,)56 b(this)50 b(is)h(another)g(instance)g(of)g
(boilerplate:)73 b(most)51 b(ingredients)-300 7777 y(follo)l(w)c(a)i
(certain)f(scheme,)k(only)47 b(fe)l(w)i(ingredients)e(should)g(be)h
(pro)n(vided)-300 7943 y(by)38 b(the)h(programmer)-8
b(.)51 b(T)-12 b(o)39 b(this)f(end,)i Fi(updatable)d
Fm(fold)h(algebras)h(were)g(pro-)-300 8109 y(posed)60
b(in)f([18].)115 b(The)60 b(present)g(de)l(v)n(elopment)f(generalises)h
(\(updatable\))-300 8275 y(generalised)38 b(folds)f(in)h(se)l(v)n(eral)
g(dimensions.)49 b(Firstly)-10 b(,)37 b(type)h(e)n(xtension)f(can)-300
8441 y(operate)50 b(at)h(the)f(type)g(le)l(v)n(el)g(whereas)h(fold)e
(algebras)h(are)h(updated)f(at)g(the)-300 8607 y(constructor)g(le)l(v)n
(el.)90 b(Secondly)-10 b(,)56 b(generic)c(tra)m(v)n(ersal)f(allo)l(ws)g
(to)g(de\002ne)i(all)-300 8773 y(kinds)59 b(of)g(tra)m(v)n(ersal)g
(schemes)i(as)f(opposed)f(to)g(simple)g(catamorphic)h(or)-300
8939 y(paramorphic)34 b(fold.)44 b(Thirdly)-10 b(,)34
b(the)g(fold)g(algebra)g(approach)g(suf)l(fers)h(from)f(a)-300
9105 y(closed-w)o(orld)k(assumption;)i(adding)f(ne)l(w)i(data)f(types)g
(is)g(not)g(straightfor)m(-)-300 9271 y(w)o(ard.)46 b(No)37
b(such)g(assumption)f(is)h(present)g(in)g(our)g(present)f(de)l(v)n
(elopment.)-300 9541 y Fa(The)42 b(non-r)-6 b(ecur)n(sive)39
b(map)j(tric)m(k)-300 9775 y Fm(The)53 b(non-recursi)l(v)n(e)e(map)i
(trick)e(\(introduced)f(in)i(Sections)g(3.2)g(and)g(3.3\))-300
9941 y(has)68 b(been)g(kno)l(wn)f(in)h(the)f(functional)f(programming)h
(community)g(for)-300 10107 y(some)31 b(time,)h(e.g.,)i(in)c(the)g
(sense)i(of)e(programming)f(with)h(functors)f([22)o(,)i(28].)-300
10273 y(In)d(this)g(approach,)i(for)e(e)l(v)n(ery)h(recursi)l(v)n(e)f
(data)g(type,)j Ff(Tree)e Fm(say)-10 b(,)31 b(one)e(de\002nes)-300
10439 y(an)37 b(auxiliary)f(type,)h Ff(Tree')i Fm(that)d(is)h(the)g
(functor)f(for)h Ff(Tree)p Fm(:)-148 10634 y Ff(data)77
b(Tree)h(a)305 b(=)76 b(Leaf)h(a)g(|)f(Fork)h(\(Tree)g(a\))g(\(Tree)g
(a\))-148 10800 y(data)g(Tree')h(t)e(a)h(=)f(Leaf')h(a)g(|)f(Fork')h(t)
g(t)4098 166 y Fm(No)l(w)37 b(the)g(follo)l(wing)e(type)i(isomorphism)e
(holds:)5132 451 y Ff(Tree')77 b(\(Tree)h(a\))e(a)71
b Fh(\021)g Ff(Tree)77 b(a)4098 736 y Fm(Recursi)l(v)n(e)51
b(tra)m(v)n(ersals)f(can)h(then)g(be)g(de\002ned)f(as)i(recursi)l(v)n
(e)f(functions)e(in)4098 902 y(terms)e(of)f(a)h(one-layer)f(functorial)
f Ff(map)p Fm(.)75 b(T)-12 b(o)47 b(use)f(this)g(approach)g(directly)
4098 1068 y(for)40 b(practical)h(programming,)g(one)g(needs)g(to)f
(write)g(functions)g(to)g(con)-6 b(v)n(ert)4098 1234
y(to)38 b(and)g(from)g(between)h(these)g(the)f(abo)n(v)n(e)g
(isomorphic)f(types,)h(and)h(the)f(sit-)4098 1400 y(uation)f(becomes)j
(noticeably)e(more)g(complicated)h(when)f(there)h(are)g(man)n(y)4098
1566 y(mutually-recursi)l(v)n(e)44 b(types)h(in)-6 b(v)m(olv)n(ed)44
b([32,)i(28)o(],)j(and)d(breaks)g(do)l(wn)f(alto-)4098
1732 y(gether)37 b(when)g(the)g(recursion)f(is)h(non-uniform)e([25)o
(]:)4250 1927 y Ff(data)77 b(Seq)g(a)g(=)f(Nil)h(|)f(Cons)i(a)e(Seq)h
(\(a,a\))4098 2122 y Fm(In)51 b(contrast,)j(our)c(approach)h(does)h
(not)e(require)g(an)i(auxiliary)d(data)i(type,)4098 2288
y(w)o(orks)46 b(\002ne)i(for)f(arbitrary)f(datatypes.)76
b(and)48 b(it)e(also)i(copes)f(with)g(systems)4098 2454
y(of)39 b(mutually)f(recursi)l(v)n(e)h(datatypes.)53
b(This)39 b(is)g(a)h(major)f(impro)n(v)n(ement)f(o)n(v)n(er)4098
2620 y(pre)l(vious)d(w)o(ork,)g(and)h(this)f(mak)o(es)h(the)f
(technique)g(more)h(lik)o(ely)e(to)h(be)h(used)4098 2786
y(in)43 b(practice.)67 b(In)44 b(an)g(untyped)f(setting,)h(the)g(idea)g
(to)f(map)i(o)n(v)n(er)e(the)h(imme-)4098 2952 y(diate)53
b(children)g(of)g(a)h(term)g(is)g(rather)f(straightforw)o(ard,)i(e.g.,)
k(in)53 b(Prolog.)4098 3118 y(Indeed,)36 b(it)e(seems)i(that)f(a)g(v)n
(ery)g(similar)f(technique)g(has)h(been)h(used)f(in)f(Lisp)4098
3284 y(community)i(already)h(for)g(quite)f(some)i(time.)6497
3230 y Fk(7)4098 3517 y Fm(The)55 b(idea)f(of)g(b)m(uilding)e(a)j
(library)e(of)h(combinators)f(that)h(f)o(acilitate)f(\002rst-)4098
3683 y(class)59 b(tree-tra)m(v)n(ersal)e Fi(str)n(ate)-6
b(gies)57 b Fm(\(e.g.)108 b(top-do)l(wn,)62 b(bottom-up,)f(repeat-)4098
3849 y(until,)g(leftmost-\002rst,)g(etc.\))106 b(in)57
b(terms)g(of)g(one-layer)g(tra)m(v)n(ersal)f(steps)h(is)4098
4015 y(also)51 b(well)g(established)g(in)g(the)g(term-re)l(writing)e
(community)-10 b(.)89 b(This)51 b(idea)4098 4181 y(has)33
b(seen)h(a)g(\003urry)e(of)g(recent)i(acti)l(vity)-10
b(.)44 b(There)33 b(are)h(three)f(main)g(approaches)4098
4347 y(to)38 b(the)g(combinator)f(style.)50 b(One)38
b(is)g(to)g(de\002ne)h(a)g(ne)l(w)g(language)f(for)g(strate-)4098
4513 y(gic)h(programming.)53 b(A)40 b(prime)f(e)n(xample)h(is)g(the)f
(untyped)g(language)g(Strat-)4098 4679 y(e)n(go)f([33].)51
b(Another)37 b(approach)i(that)f(can)h(also)g(be)f(used)h(to)f(support)
g(strate-)4098 4845 y(gies)60 b(in)f(an)h(e)n(xisting)e(functional)g
(language)i(is)g(to)f(transform)g(the)h(input)4098 5011
y(data)67 b(into)e(a)i(single)f(uni)l(v)n(ersal)g(data)h(type,)73
b(and)67 b(write)f(generic)h(strate-)4098 5177 y(gies)47
b(o)n(v)n(er)g(that)g(uni)l(v)n(ersal)f(data)i(type;)j(a)d(good)f(e)n
(xample)g(is)h(the)f(HaXML)4098 5343 y(combinator)k(library)h([35)o(].)
93 b(Y)-15 b(et)52 b(another)g(approach)h(that)e(w)o(orks)h(partic-)
4098 5509 y(ularly)47 b(well)h(with)f(functional)f(programming)h(is)h
(to)f(model)h(strate)n(gies)g(as)4098 5675 y(abstract)g(datatypes.)77
b(The)48 b(implementations)e(of)h(the)h(strate)n(gy)f(combina-)4098
5841 y(tors)f(can)h(then)f(hide)h(some)g(encoding)f(needed)h(to)f
(present)g(\223strate)n(gies)h(as)4098 6007 y(functions\224)52
b(to)h(the)h(programmer)-8 b(.)95 b(This)54 b(approach)f(underlies)g
(the)g Fi(Str)n(a-)4098 6173 y(funski)c Fm(programme.)5231
6119 y Fk(8)5383 6173 y Fm(All)h(these)g(streams)h(of)f(w)o(ork)f
(describe)h(a)g(rich)g(li-)4098 6340 y(brary)32 b(of)g(strate)n(gy)f
(combinators.)44 b(Our)32 b(ne)l(w)h(contrib)m(ution)c(is)j
Fi(to)g(show)g(how)4098 6506 y(the)g(str)n(ate)-6 b(gic-combinator)30
b(appr)-7 b(oac)n(h)32 b(to)g(tr)n(aver)o(sal)f(can)i(be)g(smoothly)e
(ac-)4098 6672 y(commodated)36 b(in)h(a)g(typed)h(functional)c(langua)o
(g)o(e)o(,)h(wher)-6 b(e)38 b(term)g(tr)n(aver)o(sals)4098
6838 y(ar)-6 b(e)32 b(or)-6 b(dinary)31 b(functions)f(on)h(the)g(user)m
(-de\002ned)h(data)e(types)p Fm(.)45 b(Also,)32 b(the)g(em-)4098
7004 y(plo)o(yment)39 b(of)h(rank-2)g(types)g(and)h(the)g
(identi\002cation)d(of)i(the)h(fundamental)4098 7170
y(folding)g(operator)h(impro)n(v)n(es)g(on)h(the)f(encodings)h(and)g
(combinator)f(suites)4098 7336 y(in)37 b(pre)l(vious)f(w)o(ork.)4098
7587 y Fa(The)42 b(visitor)e(pattern)4098 7821 y Fm(In)55
b(object-oriented)d(programming,)59 b(the)54 b Fi(visitor)g(pattern)g
Fm(is)h(the)g(classic)4098 7988 y(incarnation)c(of)i(recursi)l(v)n(e)f
(tra)m(v)n(ersal.)93 b(In)53 b(f)o(act,)j(though,)g(an)d(instance)g(of)
4098 8154 y(the)44 b(visitor)f(pattern)h(is)g(rather)g(lik)o(e)g(the)g
(problematic)f Ff(increase)k Fm(that)d(we)4098 8320 y(started)j(with)f
(in)h(Section)g(2:)66 b(the)47 b(visitor)f(requires)h(a)h(case)h(for)e
(each)h(data)4098 8486 y(type)42 b(\(say)-10 b(,)45 b(class\),)g(and)e
(the)f(tra)m(v)n(ersal)h(is)f(mix)n(ed)g(up)h(with)e(the)i(processing)
4098 8652 y(to)f(be)h(done)f(to)h(each)g(node)f([26].)63
b(Man)n(y)42 b(v)l(ariations)f(on)i(the)f(basic)h(visitor)4098
8818 y(pattern)31 b(ha)m(v)n(e)h(been)g(proposed.)44
b(P)n(alsber)m(g)32 b(suggests)f(a)i(more)f(generic)g(alter)m(-)4098
8984 y(nati)l(v)n(e,)j(the)g Ff(Walkabout)i Fm(class,)f(based)g(on)e
(re\003ection;)h(its)f(performance)h(is)4098 9150 y(poor)-6
b(,)47 b(and)e(P)n(alsber)m(g)g(of)l(fers)g(an)g(interesting)f
(discussion)g(of)g(other)h(design)4098 9316 y(choices)57
b([26)o(].)106 b(A)57 b(generati)l(v)n(e)f(approach)h(to)f(\003e)n
(xible)g(support)g(for)g(pro-)4098 9482 y(gramming)d(with)g(visitors)g
(is)g(suggested)h(by)f(V)-9 b(isser)54 b([34])g(accompanied)4098
9648 y(with)j(a)h(discussion)f(of)h(other)f(generati)l(v)n(e)h
(approaches.)109 b(Gi)l(v)n(en)57 b(a)h(class)4098 9814
y(hierarch)o(y)-10 b(,)53 b(an)d(interf)o(ace)f(for)g(visitor)f
(combinators)g(is)i(instantiated)e(v)n(ery)4098 9980
y(much)38 b(in)g(the)g(style)f(of)h(strate)n(gic)g(programming)e(\(see)
j(abo)n(v)n(e\).)49 b(Node)38 b(pro-)4098 10146 y(cessing)29
b(and)g(recursi)l(v)n(e)g(tra)m(v)n(ersal)f(is)h(ef)l(fecti)l(v)n(ely)f
(separated,)k(and)c(arbitrary)4098 10312 y(tra)m(v)n(ersal)37
b(schemes)h(can)g(be)g(de\002ned.)p 4098 10442 1601 7
v 4301 10562 a Fk(7)4367 10617 y Fm(Personal)f(communication)f(Ale)n(x)
h(Aik)o(en.)4301 10746 y Fk(8)4367 10800 y Ff
(http://www.cs.vu.nl/Strafunski)p eop
%%Page: 11 11
11 10 bop -300 166 a Fm(Lieberherr')-8 b(s)49 b(et)i(al.)-10
b(')i(s)49 b Fi(adaptive)g(pr)-7 b(o)o(gr)n(amming)48
b Fm(of)l(fers)h(a)i(high-le)l(v)n(el)d(ap-)-300 332
y(proach)35 b(to)g(tra)m(v)n(ersal)g(of)g(object)g(structures)f([21)o
(])i(when)f(compared)h(to)e(visi-)-300 498 y(tors.)44
b(This)32 b(style)f(assumes)i(primiti)l(v)n(es)e(to)g(specify)h(pieces)
g(of)g(computation)-300 664 y(to)39 b(be)g(performed)g(along)g(paths)g
(that)g(are)h(constrained)e(by)h(starting)f(nodes,)-300
830 y(nodes)32 b(to)h(be)f(passed,)j(nodes)d(to)g(be)h(by-passed,)h
(and)f(nodes)f(to)g(be)h(reached.)-300 996 y(Adapti)l(v)n(e)h(programs)
h(are)h(typically)d(implemented)i(by)g(a)h(language)f(e)n(xten-)-300
1162 y(sion,)i(a)h(re\003ection-based)e(API,)i(or)f(by)f(compilation)g
(to)g(a)i(visitor)-8 b(.)-300 1443 y Fe(9.3)183 b(T)-14
b(ype-safe)46 b(cast)-300 1677 y Fm(There)36 b(are)g(tw)o(o)e(main)h(w)
o(ays)g(to)g(implement)g(type-safe)g(cast,)i(each)f(with)e(an)-300
1843 y(e)n(xtensi)l(v)n(e)j(literature:)44 b(intensional)35
b(type)i(analysis;)f(or)h(dynamic)g(typing.)-300 2076
y(Intensional)31 b(type)i(analysis)g(enables)g(one)g(to)g(write)f
(functions)g(that)g(depend)-300 2242 y(on)46 b(the)g(\(run-time\))f
(type)g(of)h(a)h(v)l(alue)93 b([8,)46 b(37].)74 b(T)-12
b(o)46 b(this)g(end,)j(one)d(uses)h(a)-300 2408 y Ff(typecase)54
b Fm(construct)d(to)h(e)n(xamine)g(the)g(actual)g(structure)f(of)h(a)h
(type)e(pa-)-300 2574 y(rameter)41 b(or)f(the)g(type)g(of)f(a)i
(polymorphic)d(entity)-10 b(,)41 b(with)e Ff(case)i Fm(alternati)l(v)n
(es)-300 2740 y(for)c(sums,)h(products,)f(function)f(types,)i(and)f
(basic)h(datatypes.)47 b(This)38 b(struc-)-300 2906 y(tural)32
b(type)g(analysis)h(can)h(also)e(be)i(performed)e(recursi)l(v)n(ely)g
(\(as)i(opposed)e(to)-300 3072 y(mere)39 b(one-le)l(v)n(el)e(type)h
(case\).)50 b(Checking)37 b(for)h(type)f(equality)g(is)h(a)h(standard)
-300 3238 y(e)n(xample,)f(and)e(so)h(looks)f(lik)o(e)g(a)h(promising)f
(base)h(for)f(a)i(type-safe)f(cast,)h(as)-300 3404 y(W)-12
b(eirich)37 b(sho)l(ws)g([36)o(].)-300 3637 y(There)44
b(are)g(tw)o(o)f(dif)l(\002culties.)64 b(First,)45 b(adding)e
(intensional)e(polymorphism)-300 3803 y(to)d(the)g(language)g(is)g(a)g
(highly)f(non-tri)l(vial)e(step.)50 b(Second,)39 b(and)f(e)l(v)n(en)h
(more)-300 3969 y(seriously)-10 b(,)53 b(all)d(the)f(w)o(ork)g(on)h
(intensional)e(polymorphism)g(is)i(geared)h(to-)-300
4135 y(w)o(ards)g Fi(structur)n(al)f Fm(type)h(analysis,)j(whereas)f
(our)d(setting)g(absolutely)g(re-)-300 4301 y(quires)33
b Fi(nominal)f Fm(type)h(analysis)h(\(cf.)g([7)o(]\).)46
b(F)n(or)33 b(e)n(xample,)i(these)f(tw)o(o)f(types)-300
4467 y(are)38 b(structurally)d(equal,)i(b)m(ut)g(not)f(nominally)f
(equal:)-148 4662 y Ff(data)77 b(Person)h(=)e(P)h(String)g(Float)154
b(--)76 b(Name)i(and)e(height)-148 4828 y(data)h(Dog)306
b(=)76 b(D)h(String)g(Float)154 b(--)76 b(Name)i(and)e(weight)-300
5023 y Fm(W)-12 b(e)49 b(should)e(not)h(treat)g(a)h Ff(Person)h
Fm(lik)o(e)e(a)h Ff(Dog)g Fm(\227)g(or)f(at)h(least)g(we)f(should)-300
5189 y(allo)l(w)37 b(them)g(to)g(be)g(distinguished.)-300
5422 y(There)44 b(is)f(a)h(great)f(deal)h(of)f(e)n(xcellent)g(research)
h(on)f(introducing)e Fi(dynamic)-300 5588 y(types)32
b Fm(into)f(a)i(statically-typed)c(language;)k(for)f(e)n(xample)64
b([1)o(,)33 b(2,)f(20].)44 b(Ho)l(w-)-300 5754 y(e)l(v)n(er)-6
b(,)39 b(it)f(addresses)h(a)g(more)f(general)g(question)f(than)h(we)h
(do,)f(and)g(is)h(there-)-300 5920 y(fore)55 b(much)h(more)f
(complicated)g(than)g(necessary)i(for)d(our)h(purpose.)101
b(In)-300 6086 y(particular)-6 b(,)57 b(we)d(do)g(not)f(need)h(the)g
(type)f Ff(Dynamic)p Fm(,)60 b(which)53 b(is)h(central)g(to)-300
6252 y(dynamic-typing)43 b(systems,)49 b(and)d(hence)h(we)f(do)f(not)g
(need)i Ff(typecase)g Fm(ei-)-300 6418 y(ther)-6 b(,)37
b(the)g(principal)f(language)h(construct)f(underlying)f(dynamic)i
(typing.)-300 6650 y(The)g(class)h Ff(Typeable)g Fm(and)f(the)g
Ff(unsafeCoerce)i Fm(function,)c(are)j(the)e(foun-)-300
6816 y(dation)c(of)h(the)g Ff(Dynamic)i Fm(library)-10
b(,)34 b(which)e(has)i(been)g(a)g(standard)e(part)h(of)g(the)-300
6982 y(Hugs)46 b(and)g(GHC)h(distrib)m(utions)42 b(for)k(se)l(v)n(eral)
h(years.)75 b(Ho)l(we)l(v)n(er)-6 b(,)49 b(it)d(seems)-300
7148 y(that)41 b(the)f(material)i(of)e(Section)h(8)g(has)h(ne)l(v)n(er)
f(appeared)h(in)e(print.)57 b(The)42 b(k)o(e)n(y)-300
7314 y(idea)55 b(\002rst)g(appeared)h(in)f(an)g(1990)g(email)g(from)g
(one)g(of)g(the)h(current)e(au-)-300 7480 y(thors)32
b(to)g(the)g(\(closed\))h Ff(fplanc)h Fm(mailing)e(list)f([27)o(],)j
(later)f(forw)o(arded)e(to)h(the)-300 7646 y(\(open\))44
b(Hask)o(ell)f(mailing)h(list)f([12)o(].)69 b(The)45
b Ff(cast)g Fm(function)e(is)h(not)g(so)h(well)-300 7813
y(kno)l(wn,)c(ho)l(we)l(v)n(er;)h(the)f(\002rst)f(reference)i(we)f(can)
g(trace)h(w)o(as)e(a)i(message)g(to)-300 7979 y(the)37
b(Hask)o(ell)f(mailing)g(list)h(from)f(Henderson)h([9].)-300
8407 y Fn(10)199 b(Concluding)49 b(r)l(emarks)-300 8641
y Fm(W)-12 b(e)45 b(ha)m(v)n(e)f(presented)h(a)g(practical)f(design)f
(pattern)h(for)g(generic)g(program-)-300 8807 y(ming)34
b(in)f(a)i(typed)e(functional)f(setting.)44 b(This)34
b(pattern)g(encourages)g(the)g(pro-)-300 8974 y(grammer)c(to)g(a)m(v)m
(oid)f(the)g(implementation)f(of)i(tiresome)f(and)h(maintenance-)-300
9140 y(intensi)l(v)n(e)54 b(boilerplate)f(code)j(that)e(is)h(typically)
e(needed)i(to)g(recurse)g(into)-300 9306 y(comple)n(x)e(data)g
(structures.)94 b(This)53 b(pattern)f(is)h(rele)l(v)l(ant)h(for)e(XML)i
(docu-)-300 9472 y(ment)k(processing,)k(language)c(implementation,)j
(softw)o(are)c(re)l(v)n(erse)h(and)-300 9638 y(re-engineering.)99
b(Our)54 b(approach)h(is)g(simple)g(to)g(understand)f(because)i(it)-300
9804 y(only)e(in)-6 b(v)m(olv)n(es)54 b(tw)o(o)g(designated)g(concepts)
h(of)g(one-layer)g(tra)m(v)n(ersal)f(and)-300 9970 y(type)65
b(cast.)131 b(Our)65 b(approach)g(is)g(general)g(because)i(it)d(does)i
(not)e(restrict)-300 10136 y(the)48 b(datatypes)g(subject)g(to)f(tra)m
(v)n(ersal,)k(and)e(it)e(allo)l(ws)h(to)g(de\002ne)g(arbitrary)-300
10302 y(tra)m(v)n(ersal)66 b(schemes)i(\227)f(reusable)f(ones)h(b)m(ut)
e(also)i(application-speci\002c)-300 10468 y(ones.)105
b(Language)57 b(support)e(for)h(the)h(design)f(pattern)g(w)o(as)h(sho)l
(wn)f(to)g(be)-300 10634 y(simple.)104 b(The)58 b(approach)e(tak)o(es)g
(adv)l(antage)h(of)g(research)g(to)f(put)g(rank-2)-300
10800 y(type)37 b(systems)g(to)g(w)o(ork.)4098 166 y
Fa(P)-13 b(erformance)4098 400 y Fm(Our)63 b(benchmarks)h(sho)l(w)g
(that)f(generic)h(programs)f(are)i(reasonably)e(ef-)4098
566 y(\002cient)71 b(\(see)h(also)f(the)g(accompan)n(ying)g(softw)o
(are)f(distrib)m(ution\).)145 b(The)4098 732 y(generic)72
b(program)g(for)g(salary)h(increase,)82 b(for)72 b(e)n(xample,)82
b(is)73 b(3.5)f(times)4098 898 y(slo)l(wer)4526 844 y
Fk(9)4625 898 y Fm(than)32 b(the)h(normal)f(hand-coded)g(program.)44
b(The)34 b(dominant)d(cause)4098 1064 y(of)39 b(this)g(penalty)g(is)g
(our)g(sub-optimal)f(encoding)h(technique)f(for)h(type-safe)4098
1230 y(cast.)87 b(Recall)51 b(that)f(generic)g(tra)m(v)n(ersals)g
(perform)g(a)h(comparison)f(of)h(type)4098 1396 y(representations)57
b(for)h(e)l(v)n(ery)g(encountered)f(node)h(at)h(run-time.)108
b(So)58 b(it)f(is)4098 1562 y(crucial)51 b(to)f(mak)o(e)h(type)f
(representations)g(v)n(ery)h(ef)l(\002cient,)j(preferably)c(via)4098
1729 y(b)m(uilt-in)33 b(support.)45 b(A)36 b(hand-written)e(solution)g
(does)i(not)g(in)-6 b(v)m(olv)n(e)34 b(an)n(y)i(such)4098
1895 y(checks.)103 b(The)56 b(abo)n(v)n(e)f(f)o(actor)g(is)h(also)f
(caused)i(by)e(the)h(f)o(act)f(that)g(generic)4098 2061
y(tra)m(v)n(ersal)48 b(schemes)i(are)f(not)f(accessible)h(to)f(a)h
(number)f(of)h(optimisations)4098 2227 y(which)h(are)h(a)m(v)l(ailable)
g(for)f(hard-wired)g(solutions.)84 b(This)51 b(is)g(because)g(the)4098
2393 y Ff(gmap)57 b Fm(f)o(amily)d(relies)i(on)f(the)g
Ff(Term)i Fm(class)f(and)g(higher)m(-order)d(style.)102
b(Fi-)4098 2559 y(nally)-10 b(,)36 b(recall)f(that)g(generic)h(tra)m(v)
n(ersals)f(tend)g(to)g(tra)m(v)n(erse)g(more)h(nodes)g(than)4098
2725 y(necessary)i(if)f(e)n(xtra)g(precautions)f(are)i(omitted)e(to)g
(stop)h(recursion.)4098 2990 y Fa(P)-13 b(er)n(spective)4098
3224 y Fm(W)h(e)40 b(are)g(currently)f(in)-6 b(v)n(estig)o(ating)37
b(options)g(to)i(support)f(the)i(k)o(e)n(y)f(combina-)4098
3390 y(tors)h Ff(cast)i Fm(and)f Ff(gfoldl)h Fm(\(or)e(the)g
Ff(gmap)i Fm(f)o(amily\))e(ef)l(\002ciently)g(by)g(the)h(GHC)4098
3556 y(compiler)29 b(for)g(Hask)o(ell.)43 b(Such)30 b(a)g(nati)l(v)n(e)
f(implementation)f(will)h(remo)n(v)n(e)g(the)4098 3722
y(penalty)g(related)h(to)g(the)f(comparison)h(of)g(type)f
(representations,)i(and)f(it)f(will)4098 3888 y(render)47
b(e)n(xternal)f(generati)l(v)n(e)h(tool)e(support)h(unnecessary)-10
b(.)76 b(As)47 b(the)g(paper)4098 4055 y(discusses,)g(such)e(b)m
(uilt-in)d(support)i(is)g(not)g(hard)h(to)f(pro)n(vide,)i(b)m(ut)e
(there)g(is)4098 4221 y(some)e(design)e(space)i(to)e(e)n(xplore.)57
b(W)-12 b(e)42 b(are)f(also)g(w)o(orking)e(on)i(automating)4098
4387 y(the)32 b(deri)l(v)l(ation)e(of)i(stop)f(conditions)e(for)i(tra)m
(v)n(ersals)h(based)g(on)g(reachability)4098 4553 y(properties)38
b(of)g(the)g(recursi)l(v)n(e)h(tra)m(v)n(ersal)f(schemes)i(and)f(the)g
(tra)m(v)n(ersed)f(data)4098 4719 y(structure.)58 b(W)-12
b(e)41 b(en)-6 b(visage)42 b(that)e(a)i(template-based)f(approach)g
([30)o(])g(can)h(be)4098 4885 y(used)37 b(to)g(deri)l(v)n(e)g
(optimised)f(tra)m(v)n(ersals)g(at)i(compile)e(time.)4098
5316 y Fn(Ackno)n(wledgements)4098 5550 y Fm(W)-12 b(e)52
b(thank)e(Nick)h(Benton,)i(Robert)d(Ennals,)55 b(Barry)50
b(Jay)-10 b(,)56 b(Johan)51 b(Jeuring,)4098 5716 y(Ralf)e(Hinze,)k(T)
-12 b(on)n(y)49 b(Hoare,)k(Simon)d(Marlo)l(w)-10 b(,)52
b(Riccardo)e(Pucella,)j(Colin)4098 5882 y(Runciman,)32
b(Joost)e(V)-9 b(isser)j(,)32 b(and)f(Stephanie)f(W)-12
b(eirich)30 b(for)g(v)n(ery)g(helpful)f(dis-)4098 6048
y(cussions)37 b(and)g(feedback)h(on)e(earlier)h(drafts)g(of)g(this)f
(paper)-8 b(.)4098 6446 y Fn(11)199 b(Refer)l(ences)4173
6647 y Fm([1])82 b(M.)52 b(Abadi,)j(L.)d(Cardelli,)i(B.)e(Pierce,)k
(and)51 b(G.)h(Plotkin.)98 b(Dynamic)4430 6813 y(typing)48
b(in)h(a)i(statically-typed)c(language.)94 b(In)49 b
Fi(16th)g(A)l(CM)h(Confer)m(-)4430 6979 y(ence)i(on)e(Principles)g(of)g
(Pr)-7 b(o)o(gr)n(amming)49 b(Langua)o(g)o(es)p Fm(,)j(pages)f(213\226)
4430 7145 y(227,)37 b(Jan.)h(1989.)4173 7344 y([2])82
b(M.)59 b(Abadi,)64 b(L.)59 b(Cardelli,)k(B.)c(Pierce,)65
b(and)58 b(D.)h(Remy)-10 b(.)123 b(Dynamic)4430 7511
y(typing)35 b(in)h(polymorphic)e(languages.)53 b(In)36
b Fi(Pr)-7 b(oceedings)38 b(of)e(the)g(1992)4430 7677
y(A)l(CM)53 b(W)-14 b(orkshop)53 b(on)f(ML)h(and)f(its)g(Applications)p
Fm(,)i(pages)f(92\226103,)4430 7843 y(San)38 b(Francisco,)f(June)h
(1992.)4173 8042 y([3])82 b(R.)67 b(Bird)e(and)h(R.)h(P)n(aterson.)147
b(De)66 b(Bruijn)f(notation)f(as)j(a)g(nested)4430 8208
y(datatype.)106 b Fi(J)l(ournal)53 b(of)g(Functional)f(Pr)-7
b(o)o(gr)n(amming)p Fm(,)57 b(9\(1\):77\22691,)4430 8374
y(Jan.)38 b(1999.)4173 8573 y([4])82 b(D.)64 b(Clark)o(e)f(and)g(A.)h
(L)5691 8572 y(\250)5679 8573 y(oh.)139 b(Generic)63
b(Hask)o(ell,)70 b(Speci\002cally)-10 b(.)139 b(In)4430
8739 y(J.)29 b(Gibbons)e(and)h(J.)h(Jeuring,)g(editors,)h
Fi(Pr)-7 b(oc.)29 b(of)f(the)g(IFIP)g(TC2)g(W)-14 b(ork-)4430
8905 y(ing)40 b(Confer)-6 b(ence)41 b(on)g(Generic)g(Pr)-7
b(o)o(gr)n(amming)p Fm(.)39 b(Kluwer)h(Academic)4430
9071 y(Publishers,)c(2002.)53 b(T)-12 b(o)38 b(appear)-8
b(.)4173 9271 y([5])82 b Fi(A)l(CM)37 b(Confer)-6 b(ence)37
b(on)f(Functional)f(Pr)-7 b(o)o(gr)n(amming)34 b(and)i(Computer)4430
9437 y(Ar)-6 b(c)n(hitectur)g(e)54 b(\(FPCA)-6 b('93\))p
Fm(,)57 b(Cophenhagen,)f(1993.)d(A)-6 b(CM.)104 b(ISBN)4430
9603 y(0-89791-595-X.)4173 9802 y([6])82 b(A.)32 b(Gill,)g(J.)h
(Launchb)m(ury)-10 b(,)33 b(and)f(S.)g(Pe)n(yton)f(Jones.)43
b(A)32 b(short)f(cut)h(to)f(de-)4430 9968 y(forestation.)66
b(In)41 b(FPCA93)g([5],)i(pages)f(223\226232.)66 b(ISBN)41
b(0-89791-)4430 10134 y(595-X.)p 4098 10291 1601 7 v
4301 10414 a Fk(9)4367 10468 y Fm(T)-10 b(est)44 b(en)-6
b(vironment:)59 b(Linux-i386,)44 b(Pentium)g(III,)g(512)g(MB,)h(256)e
(KB)4098 10634 y(cache,)55 b(Thinkpad)50 b(A22p,)j(GHC)d(5.04)h(with)e
(optimisation)f(package)j(en-)4098 10800 y(abled.)p eop
%%Page: 12 12
12 11 bop -225 166 a Fm([7])82 b(N.)62 b(Gle)l(w)-10
b(.)131 b(T)-12 b(ype)61 b(dispatch)f(for)h(named)h(hierarchical)e
(types.)131 b(In)32 332 y Fi(Pr)-7 b(oceedings)34 b(of)f(the)g(F)-16
b(ourth)33 b(A)l(CM)g(SIGPLAN)h(International)c(Con-)32
498 y(fer)-6 b(ence)39 b(on)e(Functional)f(Pr)-7 b(o)o(gr)n(amming)36
b(\(ICFP'99\))p Fm(,)h(v)m(olume)g(34.9)32 664 y(of)44
b Fi(A)l(CM)h(Sigplan)d(Notices)p Fm(,)k(pages)f(172\226182,)f(N.Y)-19
b(.,)47 b(Sept.)89 b(27\22629)32 830 y(1999.)37 b(A)-6
b(CM)36 b(Press.)-225 1029 y([8])82 b(R.)43 b(Harper)g(and)f(G.)h
(Morrisett.)70 b(Compiling)40 b(polymorphism)h(using)32
1196 y(intensional)28 b(type)i(analysis.)38 b(In)30 b
Fi(22nd)f(A)l(CM)h(Symposium)f(on)h(Princi-)32 1362 y(ples)38
b(of)f(Pr)-7 b(o)o(gr)n(amming)36 b(Langua)o(g)o(es)f(\(POPL)-6
b('95\))p Fm(,)38 b(pages)h(130\226141.)32 1528 y(A)-6
b(CM,)37 b(Jan.)h(1995.)-225 1727 y([9])82 b(F)-12 b(.)49
b(Henderson.)88 b(Dynamic)48 b(type)f(class)i(casts)f(proposal.)88
b(Email)48 b(to)32 1893 y(the)37 b Ff(haskell)i Fm(mailing)d(list,)g
(Oct.)i(1999.)-300 2092 y([10])82 b(R.)43 b(Hinze.)71
b(A)43 b(Ne)l(w)g(Approach)f(to)g(Generic)h(Functional)e(Program-)32
2258 y(ming.)129 b(In)61 b(T)-11 b(.)62 b(Reps,)67 b(editor)-6
b(,)66 b Fi(Pr)-7 b(oceedings)61 b(of)g(the)f(27th)g(Annual)32
2424 y(A)l(CM)k(SIGPLAN-SIGA)l(CT)e(Symposium)g(on)h(Principles)g(of)g
(Pr)-7 b(o-)32 2590 y(gr)n(amming)59 b(Langua)o(g)o(es,)66
b(Boston,)h(Massac)n(husetts,)g(J)-5 b(anuary)61 b(19-)32
2756 y(21)p Fm(,)37 b(pages)h(119\226132,)e(Jan.)h(2000.)-300
2956 y([11])82 b(R.)58 b(Hinze)f(and)h(S.)g(Pe)n(yton)f(Jones.)119
b(Deri)l(v)l(able)57 b(type)g(classes.)121 b(In)32 3122
y(G.)34 b(Hutton,)f(editor)-6 b(,)33 b Fi(Pr)-7 b(oceedings)34
b(of)e(the)h(2000)g(Hask)o(ell)f(W)-14 b(orkshop,)32
3288 y(Montr)-6 b(eal)p Fm(,)62 b(number)56 b(NO)-6 b(TTCS-TR-00-1)55
b(in)h(T)-10 b(echnical)57 b(Reports,)32 3454 y(Sept.)37
b(2000.)-300 3653 y([12])82 b(P)-17 b(.)38 b(Hudak.)52
b(Phil')-8 b(s)35 b(proposal)g(for)h(restricted)g(type)g(classes.)54
b(Email)37 b(to)32 3819 y(the)g Ff(haskell)i Fm(mailing)d(list,)g(June)
i(1991.)-300 4018 y([13])82 b(R.)38 b(Hughes,)g(editor)-8
b(.)54 b Fi(A)l(CM)38 b(Confer)-6 b(ence)38 b(on)f(Functional)f(Pr)-7
b(o)o(gr)n(am-)32 4184 y(ming)44 b(and)g(Computer)g(Ar)-6
b(c)n(hitectur)g(e)46 b(\(FPCA)-6 b('91\))p Fm(,)47 b(v)m(olume)d(523)h
(of)32 4350 y Fi(Lectur)-6 b(e)51 b(Notes)f(in)g(Computer)f(Science)p
Fm(,)54 b(Boston,)f(1991.)c(Springer)32 4516 y(V)-17
b(erlag.)-300 4716 y([14])82 b(P)-17 b(.)48 b(Jansson)f(and)g(J.)g
(Jeuring.)84 b(PolyP)47 b(-)f(a)i(polytypic)c(programming)32
4882 y(language)31 b(e)n(xtension.)40 b(In)31 b Fi(24th)f(A)l(CM)h
(Symposium)f(on)h(Principles)g(of)32 5048 y(Pr)-7 b(o)o(gr)n(amming)47
b(Langua)o(g)o(es)g(\(POPL)-6 b('97\))p Fm(,)52 b(pages)d(470\226482,)h
(P)n(aris,)32 5214 y(Jan.)38 b(1997.)f(A)-6 b(CM.)-300
5413 y([15])82 b(J.)d(Jeuring)f(and)g(P)-17 b(.)79 b(Jansson.)186
b(Polytypic)77 b(programming.)185 b(In)32 5579 y(J.)65
b(Launchb)m(ury)-10 b(,)72 b(E.)66 b(Meijer)-6 b(,)71
b(and)65 b(T)-11 b(.)65 b(Sheard,)73 b(editors,)e Fi(2nd)64
b(Int.)32 5745 y(Sc)n(hool)33 b(on)i(Advanced)g(Functional)e(Pr)-7
b(o)o(gr)n(amming)o(,)33 b(Olympia,)i(W)-9 b(A,)32 5911
y(USA,)30 b(26\22630)f(A)m(ug)h(1996)p Fm(,)h(v)m(olume)e(1129)g(of)h
Fi(Lectur)-6 b(e)31 b(Notes)f(in)f(Com-)32 6077 y(puter)37
b(Science)p Fm(,)h(pages)g(68\226114.)e(Springer)m(-V)-17
b(erlag,)36 b(Berlin,)g(1996.)-300 6276 y([16])82 b(A.)56
b(Kfoury)-10 b(.)112 b(T)-12 b(ype)56 b(reconstruction)e(in)h(\002nite)
h(rank)f(fragments)h(of)32 6443 y(second-order)31 b(lambda)g(calculus.)
41 b Fi(Information)28 b(and)j(Computation)p Fm(,)32
6609 y(98\(2\):228\226257,)j(June)j(1992.)-300 6808 y([17])82
b(R.)59 b(L)327 6807 y(\250)319 6808 y(ammel)g(and)g(J.)g(V)-9
b(isser)h(.)122 b(T)-12 b(yped)58 b(Combinators)f(for)h(Generic)32
6974 y(T)-5 b(ra)m(v)n(ersal.)40 b(In)30 b Fi(Pr)-7 b(oc.)32
b(Pr)n(actical)e(Aspects)h(of)f(Declar)n(ative)g(Pr)-7
b(o)o(gr)n(am-)32 7140 y(ming)62 b(P)-13 b(ADL)63 b(2002)p
Fm(,)69 b(v)m(olume)62 b(2257)g(of)h Fi(LNCS)p Fm(,)f(pages)i
(137\226154.)32 7306 y(Springer)m(-V)-17 b(erlag,)36
b(Jan.)i(2002.)-300 7505 y([18])82 b(R.)52 b(L)320 7504
y(\250)312 7505 y(ammel,)58 b(J.)53 b(V)-9 b(isser)j(,)56
b(and)c(J.)h(K)-5 b(ort.)101 b(Dealing)51 b(with)g(Lar)m(ge)i(Ba-)32
7671 y(nanas.)k(In)38 b(J.)g(Jeuring,)g(editor)-6 b(,)38
b Fi(Pr)-7 b(oceedings)38 b(of)g(WGP'2000,)g(T)-14 b(ec)n(h-)32
7837 y(nical)36 b(Report,)i(Univer)o(siteit)d(Utr)-6
b(ec)n(ht)p Fm(,)38 b(pages)f(46\22659,)g(July)f(2000.)-300
8037 y([19])82 b(J.)33 b(Launchb)m(ury)f(and)g(S.)h(Pe)n(yton)f(Jones.)
44 b(State)32 b(in)g(Hask)o(ell.)43 b Fi(Lisp)32 b(and)32
8203 y(Symbolic)k(Computation)p Fm(,)e(8\(4\):293\226342,)h(Dec.)j
(1995.)-300 8402 y([20])82 b(X.)38 b(Lero)o(y)e(and)h(M.)h(Maun)n(y)-10
b(.)54 b(Dynamics)37 b(in)g(ML.)54 b(In)37 b(Hughes)g([13)o(].)-300
8601 y([21])82 b(K.)d(Lieberherr)-8 b(.)188 b Fi(Adaptive)78
b(Object-Oriented)f(Softwar)-6 b(e:)129 b(The)32 8767
y(Demeter)52 b(Method)f(with)f(Pr)-7 b(opa)o(gation)49
b(P)-12 b(atterns)p Fm(.)99 b(PWS)52 b(Publish-)32 8933
y(ing)36 b(Compan)n(y)-10 b(,)37 b(Boston,)f(1996.)-300
9132 y([22])82 b(E.)59 b(Meijer)-6 b(,)64 b(M.)59 b(F)n(okking)o(a,)k
(and)58 b(R.)h(P)n(aterson.)122 b(Functional)57 b(Pro-)32
9298 y(gramming)77 b(with)f(Bananas,)88 b(Lenses,)h(En)-6
b(v)n(elopes,)87 b(and)77 b(Barbed)32 9465 y(W)-6 b(ire.)54
b(In)37 b(Hughes)g([13)o(],)g(pages)h(124\226144.)-300
9664 y([23])82 b(E.)64 b(Meijer)e(and)h(J.)h(Jeuring.)135
b(Mer)m(ging)62 b(Monads)h(and)g(F)n(olds)f(for)32 9830
y(Functional)33 b(Programming.)48 b(In)34 b(J.)i(Jeuring)d(and)i(E.)h
(Meijer)-6 b(,)35 b(editors,)32 9996 y Fi(Advanced)52
b(Functional)e(Pr)-7 b(o)o(gr)n(amming)p Fm(,)54 b(v)m(olume)d(925)g
(of)g Fi(Lectur)-6 b(e)32 10162 y(Notes)39 b(in)g(Computer)g(Science)p
Fm(,)i(pages)f(228\226266.)e(Springer)h(V)-17 b(erlag,)32
10328 y(1995.)4098 166 y([24])82 b(M.)39 b(Odersk)n(y)f(and)h(K.)g(L)
5720 165 y(\250)5712 166 y(aufer)-8 b(.)59 b(Putting)37
b(type)h(annotations)f(to)h(w)o(ork.)4430 332 y(In)d
Fi(23r)-6 b(d)36 b(A)l(CM)g(Symposium)e(on)i(Principles)f(of)g(Pr)-7
b(o)o(gr)n(amming)34 b(Lan-)4430 498 y(gua)o(g)o(es)h(\(POPL)-6
b('96\))p Fm(,)36 b(pages)h(54\22667.)e(A)-6 b(CM,)36
b(St)g(Petersb)m(ur)m(g)f(Beach,)4430 664 y(Florida,)h(Jan.)i(1996.)
4098 863 y([25])82 b(C.)56 b(Okasaki.)112 b Fi(Pur)-6
b(ely)57 b(functional)c(data)h(structur)-6 b(es)p Fm(.)113
b(Cambridge)4430 1029 y(Uni)l(v)n(ersity)35 b(Press,)j(1998.)4098
1229 y([26])82 b(J.)43 b(P)n(alsber)m(g)g(and)g(B.)g(Jay)-10
b(.)73 b(The)43 b(essence)h(of)f(the)f(visitor)f(pattern.)72
b(In)4430 1395 y Fi(Pr)-7 b(oceedings)58 b(22nd)e(Annual)g
(International)e(Computer)i(Softwar)-6 b(e)4430 1561
y(and)60 b(Applications)e(Confer)-6 b(ence)61 b(\(COMPSA)l(C'98\))p
Fm(,)66 b(pages)61 b(9\22615,)4430 1727 y(Aug.)37 b(1998.)4098
1926 y([27])82 b(S.)d(Pe)n(yton)e(Jones.)184 b(Restricted)77
b(o)n(v)n(erloading.)182 b(Email)78 b(to)f(the)4430 2092
y Ff(fplangc)39 b Fm(mailing)d(list,)g(Dec.)j(1990.)4098
2291 y([28])82 b(T)-11 b(.)50 b(Sheard.)93 b(Generic)49
b(uni\002cation)f(via)h(T)-12 b(w)o(o-Le)l(v)n(el)49
b(types)g(and)g(pa-)4430 2457 y(rameterized)c(modules.)77
b(In)44 b Fi(A)l(CM)g(SIGPLAN)h(International)c(Con-)4430
2623 y(fer)-6 b(ence)51 b(on)e(Functional)f(Pr)-7 b(o)o(gr)n(amming)48
b(\(ICFP'01\))p Fm(,)k(v)m(olume)d(36,)4430 2790 y(10)h(of)g
Fi(A)l(CM)g(SIGPLAN)g(notices)p Fm(,)j(pages)e(86\22697,)h(Florence,)i
(Sept.)4430 2956 y(2001.)37 b(A)-6 b(CM.)4098 3155 y([29])82
b(T)-11 b(.)40 b(Sheard)g(and)f(L.)i(Fe)n(g)o(aras.)62
b(A)40 b(fold)e(for)h(all)g(seasons.)63 b(In)39 b(FPCA93)4430
3321 y([5)o(],)f(pages)g(233\226242.)52 b(ISBN)37 b(0-89791-595-X.)4098
3520 y([30])82 b(T)-11 b(.)42 b(Sheard)f(and)f(S.)i(Pe)n(yton)e(Jones.)
65 b(T)-10 b(emplate)41 b(meta-programming)4430 3686
y(for)57 b(Hask)o(ell.)117 b(In)57 b(M.)h(Chakra)m(v)l(arty)-10
b(,)62 b(editor)-6 b(,)61 b Fi(Pr)-7 b(oceedings)58 b(of)e(the)4430
3852 y(2002)36 b(Hask)o(ell)h(W)-14 b(orkshop,)38 b(Pittsb)m(ur)-6
b(gh)p Fm(,)36 b(Oct.)h(2002.)4098 4051 y([31])82 b(M.)44
b(Shields)e(and)i(S.)g(Pe)n(yton)e(Jones.)74 b(Putting)41
b(\223putting)h(type)h(anno-)4430 4218 y(tations)36 b(to)h(w)o(ork\224)
f(to)g(w)o(ork.)53 b(In)37 b(preparation,)f(2002.)4098
4417 y([32])82 b(S.)35 b(Swierstra,)h(P)-17 b(.)36 b(Alcocer)-6
b(,)35 b(and)g(J.)h(Sarai)l(v)l(a.)50 b(Designing)33
b(and)i(imple-)4430 4583 y(menting)f(combinator)g(languages.)50
b(In)35 b(S.)h(Swierstra,)f(P)-17 b(.)36 b(Henriques,)4430
4749 y(and)46 b(J.)i(Oli)l(v)n(eira,)g(editors,)g Fi(Advanced)f
(Functional)d(Pr)-7 b(o)o(gr)n(amming)o(,)4430 4915 y(Thir)h(d)35
b(International)d(Sc)n(hool,)i(AFP)i('98)p Fm(,)g(v)m(olume)e(1608)g
(of)h Fi(Lectur)-6 b(e)4430 5081 y(Notes)40 b(in)f(Computer)g(Science)p
Fm(,)j(pages)f(150\226206,)e(Brag)o(a,)j(Portug)o(al,)4430
5247 y(Sept.)37 b(1999.)g(Springer)f(V)-17 b(erlag.)4098
5446 y([33])82 b(E.)46 b(V)-9 b(isser)j(,)48 b(Z.-e.-A.)e(Benaissa,)i
(and)e(A.)f(T)-12 b(olmach.)80 b(Building)43 b(pro-)4430
5612 y(gram)73 b(optimizers)f(with)f(re)l(writing)g(strate)n(gies.)168
b(In)72 b Fi(A)l(CM)h(SIG-)4430 5778 y(PLAN)40 b(International)d
(Confer)-6 b(ence)40 b(on)f(Functional)f(Pr)-7 b(o)o(gr)n(amming)4430
5944 y(\(ICFP'98\))p Fm(,)55 b(v)m(olume)d(34\(1\))f(of)h
Fi(A)l(CM)g(SIGPLAN)g(Notices)p Fm(,)k(pages)4430 6110
y(13\22626,)36 b(Baltimore,)h(1998.)f(A)-6 b(CM.)4098
6310 y([34])82 b(J.)74 b(V)-9 b(isser)h(.)170 b(V)-9
b(isitor)72 b(combination)g(and)i(tra)m(v)n(ersal)f(control.)169
b(In)4430 6476 y Fi(OOPSLA)78 b(2001)f(Confer)-6 b(ence)79
b(Pr)-7 b(oceedings:)128 b(Object-Oriented)4430 6642
y(Pr)-7 b(o)o(gr)n(amming)54 b(Systems,)61 b(Langua)o(g)o(es,)e(and)d
(Applications)p Fm(.)e(A)-6 b(CM)4430 6808 y(Press,)38
b(2001.)4098 7007 y([35])82 b(M.)56 b(W)-12 b(allace)56
b(and)f(C.)h(Runciman.)111 b(Hask)o(ell)55 b(and)g(XML:)g(Generic)4430
7173 y(combinators)101 b(or)h(type-based)g(translation.)260
b(In)102 b Fi(A)l(CM)g(SIG-)4430 7339 y(PLAN)40 b(International)d
(Confer)-6 b(ence)40 b(on)f(Functional)f(Pr)-7 b(o)o(gr)n(amming)4430
7505 y(\(ICFP'99\))p Fm(,)36 b(pages)i(148\226159,)e(P)n(aris,)h(Sept.)
h(1999.)e(A)-6 b(CM.)4098 7704 y([36])82 b(S.)44 b(W)-12
b(eirich.)74 b(T)-12 b(ype-safe)44 b(cast.)74 b(In)43
b Fi(A)l(CM)h(SIGPLAN)f(International)4430 7870 y(Confer)-6
b(ence)68 b(on)f(Functional)e(Pr)-7 b(o)o(gr)n(amming)66
b(\(ICFP'00\))p Fm(,)74 b(pages)4430 8037 y(58\22667,)36
b(Montreal,)h(Sept.)g(2000.)g(A)-6 b(CM.)4098 8236 y([37])82
b(S.)46 b(W)-12 b(eirich.)80 b(Higher)m(-order)44 b(intensional)g(type)
h(analysis.)80 b(In)45 b(D.)h(L.)4430 8402 y(M)4571 8401
y(\264)4563 8402 y(etayer)-6 b(,)43 b(editor)-6 b(,)42
b Fi(Pr)-7 b(o)o(gr)n(amming)40 b(Langua)o(g)o(es)g(and)h(Systems:)55
b(11th)4430 8568 y(Eur)-7 b(opean)33 b(Symposium)f(on)h(Pr)-7
b(o)o(gr)n(amming)32 b(\(ESOP)i(2002\),)f(Gr)-6 b(eno-)4430
8734 y(ble)o(,)40 b(F)-8 b(r)n(ance)p Fm(,)41 b(number)f(2305)f(in)g
(Lecture)i(Notes)e(in)g(Computer)g(Sci-)4430 8900 y(ence,)f(pages)g
(98\226114.)e(Springer)g(V)-17 b(erlag,)38 b(2002.)4098
9099 y([38])82 b(N.)41 b(W)-6 b(instanle)n(y)c(.)66 b(A)41
b(type-sensiti)l(v)n(e)e(preprocessor)i(for)f(Hask)o(ell.)66
b(In)4430 9265 y Fi(Glasgow)59 b(W)-14 b(orkshop)61 b(on)f(Functional)e
(Pr)-7 b(o)o(gr)n(amming)o(,)64 b(Ullapool)p Fm(,)4430
9431 y(1997.)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
